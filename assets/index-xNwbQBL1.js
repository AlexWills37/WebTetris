var qs=Object.defineProperty;var Ys=(l,e,t)=>e in l?qs(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var $t=(l,e,t)=>(Ys(l,typeof e!="symbol"?e+"":e,t),t),ea=(l,e,t)=>{if(!e.has(l))throw TypeError("Cannot "+t)};var le=(l,e,t)=>(ea(l,e,"read from private field"),t?t.call(l):e.get(l)),Ie=(l,e,t)=>{if(e.has(l))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(l):e.set(l,t)},ct=(l,e,t,r)=>(ea(l,e,"write to private field"),r?r.call(l,t):e.set(l,t),t);var ta=(l,e,t,r)=>({set _(n){ct(l,e,n,t)},get _(){return le(l,e,r)}}),Je=(l,e,t)=>(ea(l,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();class $s{constructor(){this.actionStates=new Map,this.actionStates.set("HardDrop",!1),this.actionStates.set("SoftDrop",!1),this.actionStates.set("MoveLeft",!1),this.actionStates.set("MoveRight",!1),this.actionStates.set("Hold",!1),this.actionStates.set("RotateClockwise",!1),this.actionStates.set("RotateAntiClockwise",!1),this.actionStates.set("Pause",!1),this.inputKeys=new Map,this.inputKeys.set("A","MoveLeft"),this.inputKeys.set("D","MoveRight"),this.inputKeys.set("W","HardDrop"),this.inputKeys.set("S","SoftDrop"),this.inputKeys.set("E","Hold"),this.inputKeys.set("ArrowLeft","RotateAntiClockwise"),this.inputKeys.set("J","RotateAntiClockwise"),this.inputKeys.set("ArrowRight","RotateClockwise"),this.inputKeys.set("Escape","Pause"),this.counters=new Map,this.counters.set("MoveLeft",0),this.counters.set("MoveRight",0),this.counters.set("RotateClockwise",0),this.counters.set("RotateAntiClockwise",0),this.counters.set("HardDrop",0),this.counters.set("Hold",0),this.counters.set("Pause",0)}keyToState(e){return e.length==1&&(e=e.toUpperCase()),this.inputKeys.get(e)}setInputState(e,t){let r=this.keyToState(e);r!=null&&this.actionStates.set(r,t)}getInputState(e){return this.actionStates.has(e)?this.actionStates.get(e):(console.log("ERROR: trying to access an input action that doesn't exist ("+e+"). The allowed options are:"),this.actionStates.forEach(function(t,r,n){console.log("    - "+r)}),null)}updateCounters(){for(const[e,t]of this.counters)this.getInputState(e)?this.counters.set(e,t+1):this.counters.set(e,0)}getCounter(e){return this.counters.has(e)?this.counters.get(e):(console.log("ERROR: trying to access input action that doesn't have a counter ("+e+"). The counters are:"),this.counters.forEach(function(t,r,n){console.log("    - "+r+": "+t)}),null)}}var fn,Or,mn,wr,yn,fr,Lr,gi,hs,bi,ls,Ti,fs,Ei,ms,dn,vi,zr,Bn,_i,ys,wi,ds,zn,ma,Ai,ps,pn,xi,Un,ya;const Ln=class Ln{constructor(){Ie(this,gi);Ie(this,bi);Ie(this,Ti);Ie(this,Ei);Ie(this,dn);Ie(this,zr);Ie(this,_i);Ie(this,wi);Ie(this,zn);Ie(this,Ai);Ie(this,pn);Ie(this,Un);$t(this,"numRows",21);$t(this,"graceTimerDuration",.5);$t(this,"gameTickTime",1/30);$t(this,"pieceMap",new Map);$t(this,"gameState",{isPaused:!1,gameOver:!0,gridData:new Uint32Array(this.numRows),playerPiece:null,pieceQueue:[],heldPiece:null,ghostBlocks:[[0,0],[0,0],[0,0],[0,0]],linesCleared:0,speedLevel:1});Ie(this,fn,15);Ie(this,Or,!0);Ie(this,mn,0);Ie(this,wr,-1);Ie(this,yn,0);Ie(this,fr,!1);Ie(this,Lr,!1);Je(this,dn,vi).call(this),Je(this,zr,Bn).call(this),Je(this,pn,xi).call(this),ct(this,fn,15),this.pieceMap.set("Z",1),this.pieceMap.set("S",2),this.pieceMap.set("O",3),this.pieceMap.set("J",4),this.pieceMap.set("T",5),this.pieceMap.set("I",6),this.pieceMap.set("L",7),this.gameState.isPaused=!0}get isStateChanged(){const e=le(this,Or);return ct(this,Or,!1),e}runTick(e){if(e.updateCounters(),!this.gameState.isPaused){let t=!1;if(le(this,Lr))this.animationCount==null||this.rowCount==null?(this.animationCount=0,this.rowCount=0):(this.animationCount++,this.rowCount<this.numRows&&this.animationCount%4==0?(this.clearRow(0),this.rowCount++,ct(this,Or,!0)):this.rowCount==this.numRows&&(this.rowCount++,this.gameState.gameOver=!0));else if(e.getCounter("HardDrop")==1)this.hardDropPlayerPiece(),this.finishWithPiece(),t=!0;else if(e.getCounter("Hold")==1)this.holdPiece(),t=!0;else{e.getInputState("SoftDrop")&&(t=this.tryMovePiece(0,-1)||t);let r=0;e.getCounter("RotateClockwise")==1&&(r+=1),e.getCounter("RotateAntiClockwise")==1&&(r-=1),r!=0&&(t=this.tryRotatePiece(r==1)||t);let n=0;if((e.getCounter("MoveLeft")==1||e.getCounter("MoveLeft")>5)&&(n-=1),(e.getCounter("MoveRight")==1||e.getCounter("MoveRight")>5)&&(n+=1),n!=0&&(t=this.tryMovePiece(n,0)||t),ta(this,mn)._++,le(this,mn)>=le(this,fn)){let a=!this.tryMovePiece(0,-1);t||(t=!a),ct(this,mn,0),a&&!le(this,fr)&&Je(this,_i,ys).call(this)}if(le(this,fr)&&(Je(this,wi,ds).call(this,this.gameTickTime),le(this,wr)<=0)){let a=!this.tryMovePiece(0,-1);t=!0,a&&this.finishWithPiece()}}t&&(Je(this,pn,xi).call(this),ct(this,Or,!0))}}pauseGame(e){this.gameState.isPaused=e}startNewGame(){this.gameState.gameOver=!1,this.gameState.isPaused=!1,ct(this,Lr,!1),this.animationCount=null,this.rowCount=null;for(let e=0;e<this.gameState.gridData.length;e++)this.gameState.gridData[e]=0;this.gameState.linesCleared=0,this.gameState.speedLevel=0,this.gameState.pieceQueue=[],Je(this,dn,vi).call(this),Je(this,zr,Bn).call(this),Je(this,pn,xi).call(this),Je(this,Un,ya).call(this)}tryMovePiece(e,t){let r=!0;for(let n=0;n<4&&r;n++){let a=this.gameState.playerPiece.blocks[n][0]+e,h=this.gameState.playerPiece.blocks[n][1]+t;this.isBlockHere(a,h)&&(r=!1)}return r&&(Je(this,bi,ls).call(this,e,t),e!=0&&Je(this,zn,ma).call(this),t!=0&&ct(this,fr,!1)),r}hardDropPlayerPiece(){for(;this.tryMovePiece(0,-1););}tryRotatePiece(e){let t=Je(this,Ti,fs).call(this,e);return t&&Je(this,zn,ma).call(this),t}holdPiece(){if(this.gameState.heldPiece==null)this.gameState.heldPiece=this.gameState.playerPiece.shape,Je(this,zr,Bn).call(this);else if(!this.gameState.playerPiece.wasHeld){let e=this.gameState.heldPiece;this.gameState.heldPiece=this.gameState.playerPiece.shape,this.gameState.playerPiece=new _r(e),this.gameState.playerPiece.wasHeld=!0,this.isPlayerPieceValid()||(this.gameState.playerPiece.active=!1,ct(this,Lr,!0))}}finishWithPiece(){const e=this.gameState.linesCleared;Je(this,Ei,ms).call(this),Je(this,zr,Bn).call(this),ct(this,fr,!1),Je(this,Ai,ps).call(this),this.gameState.linesCleared!=e&&Je(this,Un,ya).call(this)}clearRow(e){for(let t=e;t<this.numRows-1;t++)this.gameState.gridData[t]=this.gameState.gridData[t+1];this.gameState.gridData[this.numRows-1]=0}isBlockHere(e,t){if(e<0||t<0||e>=10||t>=this.numRows)return!0;const r=this.gameState.gridData[t],n=7<<32-(3+3*e);return(r&n)!=0}getBlockData(e,t){const r=this.gameState.gridData[t],n=32-(3+3*e),a=7<<n;return(r&a)>>>n}isPlayerPieceValid(){let e=!0;for(let t=0;t<4&&e;t++)this.isBlockHere(this.gameState.playerPiece.blocks[t][0],this.gameState.playerPiece.blocks[t][1])&&(e=!1);return e}};fn=new WeakMap,Or=new WeakMap,mn=new WeakMap,wr=new WeakMap,yn=new WeakMap,fr=new WeakMap,Lr=new WeakMap,gi=new WeakSet,hs=function(e,t,r){const a=~(7<<32-(3+3*e));this.gameState.gridData[t]&=a;const h=r<<32-(3+3*e);this.gameState.gridData[t]|=h},bi=new WeakSet,ls=function(e,t){for(let r=0;r<4;r++)this.gameState.playerPiece.blocks[r][0]+=e,this.gameState.playerPiece.blocks[r][1]+=t},Ti=new WeakSet,fs=function(e){let t=(this.gameState.playerPiece.rotationIndex+4+(e?1:-1))%4,r=[...this.gameState.playerPiece.blocks[0]],n=[];for(let _=0;_<4;_++)n.push([...this.gameState.playerPiece.blocks[_]]);let a=1,h=1;e?h=-1:a=-1;let i;for(let _=0;_<4;_++)n[_][0]-=r[0],n[_][1]-=r[1],i=n[_][0],n[_][0]=a*n[_][1],n[_][1]=h*i,n[_][0]+=r[0],n[_][1]+=r[1];let u;switch(this.gameState.playerPiece.shape){case"O":u=_r.offsets.O;break;case"I":u=_r.offsets.I;break;default:u=_r.offsets.OTHER;break}let v,d,g=!1;for(let _=0;_<5&&!g;_++){v=u[_],d=[v[this.gameState.playerPiece.rotationIndex][0]-v[t][0],v[this.gameState.playerPiece.rotationIndex][1]-v[t][1]],g=!0;for(let b=0;b<4;b++)n[b][0]+=d[0],n[b][1]+=d[1],this.isBlockHere(n[b][0],n[b][1])&&(g=!1);if(!g)for(let b=0;b<4;b++)n[b][0]-=d[0],n[b][1]-=d[1]}if(g){for(let _=0;_<4;_++)this.gameState.playerPiece.blocks[_]=[...n[_]];this.gameState.playerPiece.rotationIndex=t}return g},Ei=new WeakSet,ms=function(){let e,t,r=this.pieceMap.get(this.gameState.playerPiece.shape);for(let n=0;n<4;n++)e=this.gameState.playerPiece.blocks[n][0],t=this.gameState.playerPiece.blocks[n][1],Je(this,gi,hs).call(this,e,t,r)},dn=new WeakSet,vi=function(){let e=["O","I","T","J","L","S","Z"],t;for(let r=0;r<7;r++)t=Math.floor(Math.random()*e.length),this.gameState.pieceQueue.push(e[t]),e.splice(t,1)},zr=new WeakSet,Bn=function(){let e=this.gameState.pieceQueue[0];this.gameState.pieceQueue.splice(0,1),this.gameState.pieceQueue.length<7&&Je(this,dn,vi).call(this),delete this.gameState.playerPiece,this.gameState.playerPiece=new _r(e),this.isPlayerPieceValid()||(this.gameState.playerPiece.active=!1,ct(this,Lr,!0))},_i=new WeakSet,ys=function(){ct(this,wr,this.graceTimerDuration),ct(this,fr,!0),ct(this,yn,0)},wi=new WeakSet,ds=function(e){ct(this,wr,le(this,wr)-e)},zn=new WeakSet,ma=function(){le(this,fr)&&le(this,yn)<30&&(ct(this,wr,Math.min(le(this,wr)+.5,this.graceTimerDuration)),ta(this,yn)._++)},Ai=new WeakSet,ps=function(){for(let e=0;e<this.numRows;e++){let t=!0;for(let r=0;r<10&&t;r++)this.isBlockHere(r,e)||(t=!1);t&&(this.clearRow(e),this.gameState.linesCleared++,e--)}},pn=new WeakSet,xi=function(){for(let t=0;t<4;t++)this.gameState.ghostBlocks[t]=[...this.gameState.playerPiece.blocks[t]];let e=!1;for(;!e;){for(let t=0;t<4;t++)this.isBlockHere(this.gameState.ghostBlocks[t][0],this.gameState.ghostBlocks[t][1]-1)&&(e=!0);if(!e)for(let t=0;t<4;t++)this.gameState.ghostBlocks[t][1]-=1}},Un=new WeakSet,ya=function(){this.gameState.speedLevel=Math.min(Math.floor(this.gameState.linesCleared/10)+1,Ln.levels.max),ct(this,fn,Ln.levels[this.gameState.speedLevel])},$t(Ln,"levels",{1:15,2:14,3:13,4:12,5:11,6:10,7:9,8:7,9:5,10:3,11:1,max:11});let fa=Ln;const jt=class jt{constructor(e){this.blocks=[],this.shape=e,this.rotationIndex=0,this.active=!0,this.wasHeld=!1;let t=jt.getBaseShape(e);for(let r=0;r<4;r++)this.blocks.push([...t[r]]),this.blocks[r][0]+=3,this.blocks[r][1]+=19}static getBaseShape(e){let t;switch(e){case"O":t=jt.pieces.O;break;case"I":t=jt.pieces.I;break;case"L":t=jt.pieces.L;break;case"J":t=jt.pieces.J;break;case"T":t=jt.pieces.T;break;case"S":t=jt.pieces.S;break;case"Z":t=jt.pieces.Z;break;default:t=[[0,0],[0,0],[0,0],[0,0]]}return t}};$t(jt,"offsets",{O:[[[0,0],[0,-1],[-1,-1],[-1,0]]],I:[[[0,0],[-1,0],[-1,1],[0,1]],[[-1,0],[0,0],[1,1],[0,1]],[[2,0],[0,0],[-2,1],[0,1]],[[-1,0],[0,1],[1,0],[0,-1]],[[2,0],[0,-2],[-2,0],[0,2]]],OTHER:[[[0,0],[0,0],[0,0],[0,0]],[[0,0],[1,0],[0,0],[-1,0]],[[0,0],[1,-1],[0,0],[-1,-1]],[[0,0],[0,2],[0,0],[0,2]],[[0,0],[1,2],[0,0],[-1,2]]]}),$t(jt,"pieces",{O:[[1,0],[1,1],[2,1],[2,0]],I:[[1,0],[0,0],[2,0],[3,0]],L:[[1,0],[0,0],[2,0],[2,1]],J:[[1,0],[0,0],[0,1],[2,0]],T:[[1,0],[0,0],[2,0],[1,1]],S:[[1,0],[0,0],[1,1],[2,1]],Z:[[1,0],[2,0],[1,1],[0,1]]});let _r=jt;var Zs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},vs={exports:{}};/*!
 * @license twgl.js 5.5.4 Copyright (c) 2015, Gregg Tavares All Rights Reserved.
 * Available via the MIT license.
 * see: http://github.com/greggman/twgl.js for details
 */(function(l,e){(function(r,n){l.exports=n()})(typeof self<"u"?self:Zs,()=>(()=>{var t={"./src/attributes.js":(h,i,u)=>{function v(E){"@babel/helpers - typeof";return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},v(E)}i.__esModule=!0,i.createAttribsFromArrays=yt,i.createBufferFromArray=x,i.createBufferFromTypedArray=ge,i.createBufferInfoFromArrays=p,i.createBuffersFromArrays=I,i.getArray_=Q,i.getNumComponents_=Se,i.setAttribInfoBufferFromArray=lt,i.setAttributeDefaults_=st,i.setAttributePrefix=at;var d=b(u("./src/typedarrays.js")),g=b(u("./src/helper.js"));function _(E){if(typeof WeakMap!="function")return null;var y=new WeakMap,m=new WeakMap;return(_=function(w){return w?m:y})(E)}function b(E,y){if(!y&&E&&E.__esModule)return E;if(E===null||v(E)!="object"&&typeof E!="function")return{default:E};var m=_(y);if(m&&m.has(E))return m.get(E);var A={__proto__:null},w=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var B in E)if(B!=="default"&&Object.prototype.hasOwnProperty.call(E,B)){var k=w?Object.getOwnPropertyDescriptor(E,B):null;k&&(k.get||k.set)?Object.defineProperty(A,B,k):A[B]=E[B]}return A.default=E,m&&m.set(E,A),A}var R=35044,U=34962,ee=34963,C=34660,K=5120,J=5121,z=5122,X=5123,ne=5124,ae=5125,Ne=5126,Ae={attribPrefix:""};function at(E){Ae.attribPrefix=E}function st(E){g.copyExistingProperties(E,Ae)}function Xe(E,y,m,A,w){E.bindBuffer(y,m),E.bufferData(y,A,w||R)}function ge(E,y,m,A){if(g.isBuffer(E,y))return y;m=m||U;var w=E.createBuffer();return Xe(E,m,w,y,A),w}function G(E){return E==="indices"}function V(E){return E===Int8Array||E===Uint8Array}function Q(E){return E.length?E:E.data}var D=/coord|texture/i,be=/color|colour/i;function we(E,y){var m;if(D.test(E)?m=2:be.test(E)?m=4:m=3,y%m>0)throw new Error("Can not guess numComponents for attribute '".concat(E,"'. Tried ").concat(m," but ").concat(y," values is not evenly divisible by ").concat(m,". You should specify it."));return m}function Se(E,y,m){return E.numComponents||E.size||we(y,m||Q(E).length)}function Ge(E,y){if(d.isArrayBuffer(E))return E;if(d.isArrayBuffer(E.data))return E.data;Array.isArray(E)&&(E={data:E});var m=E.type?tt(E.type):void 0;return m||(G(y)?m=Uint16Array:m=Float32Array),new m(E.data)}function We(E){return typeof E=="number"?E:E?d.getGLTypeForTypedArrayType(E):Ne}function tt(E){return typeof E=="number"?d.getTypedArrayTypeForGLType(E):E||Float32Array}function $e(E,y){return{buffer:y.buffer,numValues:24,type:We(y.type),arrayType:tt(y.type)}}function mt(E,y){var m=y.data||y,A=tt(y.type),w=m*A.BYTES_PER_ELEMENT,B=E.createBuffer();return E.bindBuffer(U,B),E.bufferData(U,w,y.drawType||R),{buffer:B,numValues:m,type:d.getGLTypeForTypedArrayType(A),arrayType:A}}function Mt(E,y,m){var A=Ge(y,m);return{arrayType:A.constructor,buffer:ge(E,A,void 0,y.drawType),type:d.getGLTypeForTypedArray(A),numValues:0}}function yt(E,y){var m={};return Object.keys(y).forEach(function(A){if(!G(A)){var w=y[A],B=w.attrib||w.name||w.attribName||Ae.attribPrefix+A;if(w.value){if(!Array.isArray(w.value)&&!d.isArrayBuffer(w.value))throw new Error("array.value is not array or typedarray");m[B]={value:w.value}}else{var k;w.buffer&&w.buffer instanceof WebGLBuffer?k=$e:typeof w=="number"||typeof w.data=="number"?k=mt:k=Mt;var q=k(E,w,A),Y=q.buffer,ie=q.type,se=q.numValues,ue=q.arrayType,me=w.normalize!==void 0?w.normalize:V(ue),fe=Se(w,A,se);m[B]={buffer:Y,numComponents:fe,type:ie,normalize:me,stride:w.stride||0,offset:w.offset||0,divisor:w.divisor===void 0?void 0:w.divisor,drawType:w.drawType}}}}),E.bindBuffer(U,null),m}function lt(E,y,m,A){m=Ge(m),A!==void 0?(E.bindBuffer(U,y.buffer),E.bufferSubData(U,A,m)):Xe(E,U,y.buffer,m,y.drawType)}function vt(E,y){return y===K||y===J?1:y===z||y===X?2:y===ne||y===ae||y===Ne?4:0}var Ft=["position","positions","a_position"];function de(E){var y,m;for(m=0;m<Ft.length&&(y=Ft[m],!(y in E));++m);m===Ft.length&&(y=Object.keys(E)[0]);var A=E[y],w=Q(A).length;if(w===void 0)return 1;var B=Se(A,y),k=w/B;if(w%B>0)throw new Error("numComponents ".concat(B," not correct for length ").concat(w));return k}function o(E,y){var m,A;for(A=0;A<Ft.length&&(m=Ft[A],!(m in y||(m=Ae.attribPrefix+m,m in y)));++A);A===Ft.length&&(m=Object.keys(y)[0]);var w=y[m];if(!w.buffer)return 1;E.bindBuffer(U,w.buffer);var B=E.getBufferParameter(U,C);E.bindBuffer(U,null);var k=vt(E,w.type),q=B/k,Y=w.numComponents||w.size,ie=q/Y;if(ie%1!==0)throw new Error("numComponents ".concat(Y," not correct for length ").concat(length));return ie}function p(E,y,m){var A=yt(E,y),w=Object.assign({},m||{});w.attribs=Object.assign({},m?m.attribs:{},A);var B=y.indices;if(B){var k=Ge(B,"indices");w.indices=ge(E,k,ee),w.numElements=k.length,w.elementType=d.getGLTypeForTypedArray(k)}else w.numElements||(w.numElements=o(E,w.attribs));return w}function x(E,y,m){var A=m==="indices"?ee:U,w=Ge(y,m);return ge(E,w,A)}function I(E,y){var m={};return Object.keys(y).forEach(function(A){m[A]=x(E,y[A],A)}),y.indices?(m.numElements=y.indices.length,m.elementType=d.getGLTypeForTypedArray(Ge(y.indices),"indices")):m.numElements=de(y),m}},"./src/draw.js":(h,i,u)=>{function v(C){"@babel/helpers - typeof";return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(K){return typeof K}:function(K){return K&&typeof Symbol=="function"&&K.constructor===Symbol&&K!==Symbol.prototype?"symbol":typeof K},v(C)}i.__esModule=!0,i.drawBufferInfo=U,i.drawObjectList=ee;var d=_(u("./src/programs.js"));function g(C){if(typeof WeakMap!="function")return null;var K=new WeakMap,J=new WeakMap;return(g=function(X){return X?J:K})(C)}function _(C,K){if(!K&&C&&C.__esModule)return C;if(C===null||v(C)!="object"&&typeof C!="function")return{default:C};var J=g(K);if(J&&J.has(C))return J.get(C);var z={__proto__:null},X=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ne in C)if(ne!=="default"&&Object.prototype.hasOwnProperty.call(C,ne)){var ae=X?Object.getOwnPropertyDescriptor(C,ne):null;ae&&(ae.get||ae.set)?Object.defineProperty(z,ne,ae):z[ne]=C[ne]}return z.default=C,J&&J.set(C,z),z}var b=4,R=5123;function U(C,K,J,z,X,ne){J=J===void 0?b:J;var ae=K.indices,Ne=K.elementType,Ae=z===void 0?K.numElements:z;X=X===void 0?0:X,Ne||ae?ne!==void 0?C.drawElementsInstanced(J,Ae,Ne===void 0?R:K.elementType,X,ne):C.drawElements(J,Ae,Ne===void 0?R:K.elementType,X):ne!==void 0?C.drawArraysInstanced(J,X,Ae,ne):C.drawArrays(J,X,Ae)}function ee(C,K){var J=null,z=null;K.forEach(function(X){if(X.active!==!1){var ne=X.programInfo,ae=X.vertexArrayInfo||X.bufferInfo,Ne=!1,Ae=X.type===void 0?b:X.type;ne!==J&&(J=ne,C.useProgram(ne.program),Ne=!0),(Ne||ae!==z)&&(z&&z.vertexArrayObject&&!ae.vertexArrayObject&&C.bindVertexArray(null),z=ae,d.setBuffersAndAttributes(C,ne,ae)),d.setUniforms(ne,X.uniforms),U(C,ae,Ae,X.count,X.offset,X.instanceCount)}}),z&&z.vertexArrayObject&&C.bindVertexArray(null)}},"./src/framebuffers.js":(h,i,u)=>{function v(de){"@babel/helpers - typeof";return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},v(de)}i.__esModule=!0,i.bindFramebufferInfo=Ft,i.createFramebufferInfo=lt,i.resizeFramebufferInfo=vt;var d=b(u("./src/textures.js")),g=b(u("./src/helper.js"));function _(de){if(typeof WeakMap!="function")return null;var o=new WeakMap,p=new WeakMap;return(_=function(I){return I?p:o})(de)}function b(de,o){if(!o&&de&&de.__esModule)return de;if(de===null||v(de)!="object"&&typeof de!="function")return{default:de};var p=_(o);if(p&&p.has(de))return p.get(de);var x={__proto__:null},I=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var E in de)if(E!=="default"&&Object.prototype.hasOwnProperty.call(de,E)){var y=I?Object.getOwnPropertyDescriptor(de,E):null;y&&(y.get||y.set)?Object.defineProperty(x,E,y):x[E]=de[E]}return x.default=de,p&&p.set(de,x),x}var R=36160,U=36161,ee=3553,C=5121,K=6402,J=6408,z=33190,X=36012,ne=35056,ae=36013,Ne=32854,Ae=32855,at=36194,st=33189,Xe=6401,ge=36168,G=34041,V=36064,Q=36096,D=36128,be=33306,we=33071,Se=9729,Ge=[{format:J,type:C,min:Se,wrap:we},{format:G}],We={};We[G]=be,We[Xe]=D,We[ge]=D,We[K]=Q,We[st]=Q,We[z]=Q,We[X]=Q,We[ne]=be,We[ae]=be;function tt(de,o){return We[de]||We[o]}var $e={};$e[Ne]=!0,$e[Ae]=!0,$e[at]=!0,$e[G]=!0,$e[st]=!0,$e[Xe]=!0,$e[ge]=!0;function mt(de){return $e[de]}var Mt=32;function yt(de){return de>=V&&de<V+Mt}function lt(de,o,p,x){var I=R,E=de.createFramebuffer();de.bindFramebuffer(I,E),p=p||de.drawingBufferWidth,x=x||de.drawingBufferHeight,o=o||Ge;var y=[],m={framebuffer:E,attachments:[],width:p,height:x};return o.forEach(function(A,w){var B=A.attachment,k=A.samples,q=A.format,Y=A.attachmentPoint||tt(q,A.internalFormat);if(Y||(Y=V+w),yt(Y)&&y.push(Y),!B)if(k!==void 0||mt(q))B=de.createRenderbuffer(),de.bindRenderbuffer(U,B),k>1?de.renderbufferStorageMultisample(U,k,q,p,x):de.renderbufferStorage(U,q,p,x);else{var ie=Object.assign({},A);ie.width=p,ie.height=x,ie.auto===void 0&&(ie.auto=!1,ie.min=ie.min||ie.minMag||Se,ie.mag=ie.mag||ie.minMag||Se,ie.wrapS=ie.wrapS||ie.wrap||we,ie.wrapT=ie.wrapT||ie.wrap||we),B=d.createTexture(de,ie)}if(g.isRenderbuffer(de,B))de.framebufferRenderbuffer(I,Y,U,B);else if(g.isTexture(de,B))A.layer!==void 0?de.framebufferTextureLayer(I,Y,B,A.level||0,A.layer):de.framebufferTexture2D(I,Y,A.target||ee,B,A.level||0);else throw new Error("unknown attachment type");m.attachments.push(B)}),de.drawBuffers&&de.drawBuffers(y),m}function vt(de,o,p,x,I){x=x||de.drawingBufferWidth,I=I||de.drawingBufferHeight,o.width=x,o.height=I,p=p||Ge,p.forEach(function(E,y){var m=o.attachments[y],A=E.format,w=E.samples;if(w!==void 0||g.isRenderbuffer(de,m))de.bindRenderbuffer(U,m),w>1?de.renderbufferStorageMultisample(U,w,A,x,I):de.renderbufferStorage(U,A,x,I);else if(g.isTexture(de,m))d.resizeTexture(de,m,E,x,I);else throw new Error("unknown attachment type")})}function Ft(de,o,p){p=p||R,o?(de.bindFramebuffer(p,o.framebuffer),de.viewport(0,0,o.width,o.height)):(de.bindFramebuffer(p,null),de.viewport(0,0,de.drawingBufferWidth,de.drawingBufferHeight))}},"./src/helper.js":(h,i)=>{i.__esModule=!0,i.copyExistingProperties=d,i.copyNamedProperties=v,i.error=g,i.isBuffer=U,i.isRenderbuffer=ee,i.isSampler=J,i.isShader=C,i.isTexture=K,i.warn=_;function u(z){"@babel/helpers - typeof";return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(X){return typeof X}:function(X){return X&&typeof Symbol=="function"&&X.constructor===Symbol&&X!==Symbol.prototype?"symbol":typeof X},u(z)}function v(z,X,ne){z.forEach(function(ae){var Ne=X[ae];Ne!==void 0&&(ne[ae]=Ne)})}function d(z,X){Object.keys(X).forEach(function(ne){X.hasOwnProperty(ne)&&z.hasOwnProperty(ne)&&(X[ne]=z[ne])})}function g(){var z;(z=console).error.apply(z,arguments)}function _(){var z;(z=console).warn.apply(z,arguments)}var b=new Map;function R(z,X){if(!z||u(z)!=="object")return!1;var ne=b.get(X);ne||(ne=new WeakMap,b.set(X,ne));var ae=ne.get(z);if(ae===void 0){var Ne=Object.prototype.toString.call(z);ae=Ne.substring(8,Ne.length-1)===X,ne.set(z,ae)}return ae}function U(z,X){return typeof WebGLBuffer<"u"&&R(X,"WebGLBuffer")}function ee(z,X){return typeof WebGLRenderbuffer<"u"&&R(X,"WebGLRenderbuffer")}function C(z,X){return typeof WebGLShader<"u"&&R(X,"WebGLShader")}function K(z,X){return typeof WebGLTexture<"u"&&R(X,"WebGLTexture")}function J(z,X){return typeof WebGLSampler<"u"&&R(X,"WebGLSampler")}},"./src/m4.js":(h,i,u)=>{function v(o){"@babel/helpers - typeof";return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(p){return typeof p}:function(p){return p&&typeof Symbol=="function"&&p.constructor===Symbol&&p!==Symbol.prototype?"symbol":typeof p},v(o)}i.__esModule=!0,i.axisRotate=Mt,i.axisRotation=mt,i.copy=C,i.create=ee,i.frustum=Xe,i.getAxis=Ne,i.getTranslation=ae,i.identity=K,i.inverse=z,i.lookAt=Q,i.multiply=X,i.negate=U,i.ortho=st,i.perspective=at,i.rotateX=Se,i.rotateY=We,i.rotateZ=$e,i.rotationX=we,i.rotationY=Ge,i.rotationZ=tt,i.scale=lt,i.scaling=yt,i.setAxis=Ae,i.setDefaultType=R,i.setTranslation=ne,i.transformDirection=Ft,i.transformNormal=de,i.transformPoint=vt,i.translate=be,i.translation=D,i.transpose=J;var d=_(u("./src/v3.js"));function g(o){if(typeof WeakMap!="function")return null;var p=new WeakMap,x=new WeakMap;return(g=function(E){return E?x:p})(o)}function _(o,p){if(!p&&o&&o.__esModule)return o;if(o===null||v(o)!="object"&&typeof o!="function")return{default:o};var x=g(p);if(x&&x.has(o))return x.get(o);var I={__proto__:null},E=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var y in o)if(y!=="default"&&Object.prototype.hasOwnProperty.call(o,y)){var m=E?Object.getOwnPropertyDescriptor(o,y):null;m&&(m.get||m.set)?Object.defineProperty(I,y,m):I[y]=o[y]}return I.default=o,x&&x.set(o,I),I}var b=Float32Array;function R(o){var p=b;return b=o,p}function U(o,p){return p=p||new b(16),p[0]=-o[0],p[1]=-o[1],p[2]=-o[2],p[3]=-o[3],p[4]=-o[4],p[5]=-o[5],p[6]=-o[6],p[7]=-o[7],p[8]=-o[8],p[9]=-o[9],p[10]=-o[10],p[11]=-o[11],p[12]=-o[12],p[13]=-o[13],p[14]=-o[14],p[15]=-o[15],p}function ee(){return new b(16).fill(0)}function C(o,p){return p=p||new b(16),p[0]=o[0],p[1]=o[1],p[2]=o[2],p[3]=o[3],p[4]=o[4],p[5]=o[5],p[6]=o[6],p[7]=o[7],p[8]=o[8],p[9]=o[9],p[10]=o[10],p[11]=o[11],p[12]=o[12],p[13]=o[13],p[14]=o[14],p[15]=o[15],p}function K(o){return o=o||new b(16),o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function J(o,p){if(p=p||new b(16),p===o){var x;return x=o[1],o[1]=o[4],o[4]=x,x=o[2],o[2]=o[8],o[8]=x,x=o[3],o[3]=o[12],o[12]=x,x=o[6],o[6]=o[9],o[9]=x,x=o[7],o[7]=o[13],o[13]=x,x=o[11],o[11]=o[14],o[14]=x,p}var I=o[0*4+0],E=o[0*4+1],y=o[0*4+2],m=o[0*4+3],A=o[1*4+0],w=o[1*4+1],B=o[1*4+2],k=o[1*4+3],q=o[2*4+0],Y=o[2*4+1],ie=o[2*4+2],se=o[2*4+3],ue=o[3*4+0],me=o[3*4+1],fe=o[3*4+2],ve=o[3*4+3];return p[0]=I,p[1]=A,p[2]=q,p[3]=ue,p[4]=E,p[5]=w,p[6]=Y,p[7]=me,p[8]=y,p[9]=B,p[10]=ie,p[11]=fe,p[12]=m,p[13]=k,p[14]=se,p[15]=ve,p}function z(o,p){p=p||new b(16);var x=o[0*4+0],I=o[0*4+1],E=o[0*4+2],y=o[0*4+3],m=o[1*4+0],A=o[1*4+1],w=o[1*4+2],B=o[1*4+3],k=o[2*4+0],q=o[2*4+1],Y=o[2*4+2],ie=o[2*4+3],se=o[3*4+0],ue=o[3*4+1],me=o[3*4+2],fe=o[3*4+3],ve=Y*fe,xe=me*ie,he=w*fe,Ee=me*B,ze=w*ie,Ze=Y*B,je=E*fe,He=me*y,Fe=E*ie,De=Y*y,et=E*B,qe=w*y,Ke=k*ue,Ye=se*q,rt=m*ue,Be=se*A,ke=m*q,Tt=k*A,dt=x*ue,Ct=se*I,Dt=x*q,qt=k*I,Kt=x*A,Jt=m*I,yr=ve*A+Ee*q+ze*ue-(xe*A+he*q+Ze*ue),Wr=xe*I+je*q+De*ue-(ve*I+He*q+Fe*ue),jr=he*I+He*A+et*ue-(Ee*I+je*A+qe*ue),Vr=Ze*I+Fe*A+qe*q-(ze*I+De*A+et*q),xt=1/(x*yr+m*Wr+k*jr+se*Vr);return p[0]=xt*yr,p[1]=xt*Wr,p[2]=xt*jr,p[3]=xt*Vr,p[4]=xt*(xe*m+he*k+Ze*se-(ve*m+Ee*k+ze*se)),p[5]=xt*(ve*x+He*k+Fe*se-(xe*x+je*k+De*se)),p[6]=xt*(Ee*x+je*m+qe*se-(he*x+He*m+et*se)),p[7]=xt*(ze*x+De*m+et*k-(Ze*x+Fe*m+qe*k)),p[8]=xt*(Ke*B+Be*ie+ke*fe-(Ye*B+rt*ie+Tt*fe)),p[9]=xt*(Ye*y+dt*ie+qt*fe-(Ke*y+Ct*ie+Dt*fe)),p[10]=xt*(rt*y+Ct*B+Kt*fe-(Be*y+dt*B+Jt*fe)),p[11]=xt*(Tt*y+Dt*B+Jt*ie-(ke*y+qt*B+Kt*ie)),p[12]=xt*(rt*Y+Tt*me+Ye*w-(ke*me+Ke*w+Be*Y)),p[13]=xt*(Dt*me+Ke*E+Ct*Y-(dt*Y+qt*me+Ye*E)),p[14]=xt*(dt*w+Jt*me+Be*E-(Kt*me+rt*E+Ct*w)),p[15]=xt*(Kt*Y+ke*E+qt*w-(Dt*w+Jt*Y+Tt*E)),p}function X(o,p,x){x=x||new b(16);var I=o[0],E=o[1],y=o[2],m=o[3],A=o[4],w=o[5],B=o[6],k=o[7],q=o[8],Y=o[9],ie=o[10],se=o[11],ue=o[12],me=o[13],fe=o[14],ve=o[15],xe=p[0],he=p[1],Ee=p[2],ze=p[3],Ze=p[4],je=p[5],He=p[6],Fe=p[7],De=p[8],et=p[9],qe=p[10],Ke=p[11],Ye=p[12],rt=p[13],Be=p[14],ke=p[15];return x[0]=I*xe+A*he+q*Ee+ue*ze,x[1]=E*xe+w*he+Y*Ee+me*ze,x[2]=y*xe+B*he+ie*Ee+fe*ze,x[3]=m*xe+k*he+se*Ee+ve*ze,x[4]=I*Ze+A*je+q*He+ue*Fe,x[5]=E*Ze+w*je+Y*He+me*Fe,x[6]=y*Ze+B*je+ie*He+fe*Fe,x[7]=m*Ze+k*je+se*He+ve*Fe,x[8]=I*De+A*et+q*qe+ue*Ke,x[9]=E*De+w*et+Y*qe+me*Ke,x[10]=y*De+B*et+ie*qe+fe*Ke,x[11]=m*De+k*et+se*qe+ve*Ke,x[12]=I*Ye+A*rt+q*Be+ue*ke,x[13]=E*Ye+w*rt+Y*Be+me*ke,x[14]=y*Ye+B*rt+ie*Be+fe*ke,x[15]=m*Ye+k*rt+se*Be+ve*ke,x}function ne(o,p,x){return x=x||K(),o!==x&&(x[0]=o[0],x[1]=o[1],x[2]=o[2],x[3]=o[3],x[4]=o[4],x[5]=o[5],x[6]=o[6],x[7]=o[7],x[8]=o[8],x[9]=o[9],x[10]=o[10],x[11]=o[11]),x[12]=p[0],x[13]=p[1],x[14]=p[2],x[15]=1,x}function ae(o,p){return p=p||d.create(),p[0]=o[12],p[1]=o[13],p[2]=o[14],p}function Ne(o,p,x){x=x||d.create();var I=p*4;return x[0]=o[I+0],x[1]=o[I+1],x[2]=o[I+2],x}function Ae(o,p,x,I){I!==o&&(I=C(o,I));var E=x*4;return I[E+0]=p[0],I[E+1]=p[1],I[E+2]=p[2],I}function at(o,p,x,I,E){E=E||new b(16);var y=Math.tan(Math.PI*.5-.5*o),m=1/(x-I);return E[0]=y/p,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=y,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=(x+I)*m,E[11]=-1,E[12]=0,E[13]=0,E[14]=x*I*m*2,E[15]=0,E}function st(o,p,x,I,E,y,m){return m=m||new b(16),m[0]=2/(p-o),m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=2/(I-x),m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=2/(E-y),m[11]=0,m[12]=(p+o)/(o-p),m[13]=(I+x)/(x-I),m[14]=(y+E)/(E-y),m[15]=1,m}function Xe(o,p,x,I,E,y,m){m=m||new b(16);var A=p-o,w=I-x,B=E-y;return m[0]=2*E/A,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=2*E/w,m[6]=0,m[7]=0,m[8]=(o+p)/A,m[9]=(I+x)/w,m[10]=y/B,m[11]=-1,m[12]=0,m[13]=0,m[14]=E*y/B,m[15]=0,m}var ge,G,V;function Q(o,p,x,I){return I=I||new b(16),ge=ge||d.create(),G=G||d.create(),V=V||d.create(),d.normalize(d.subtract(o,p,V),V),d.normalize(d.cross(x,V,ge),ge),d.normalize(d.cross(V,ge,G),G),I[0]=ge[0],I[1]=ge[1],I[2]=ge[2],I[3]=0,I[4]=G[0],I[5]=G[1],I[6]=G[2],I[7]=0,I[8]=V[0],I[9]=V[1],I[10]=V[2],I[11]=0,I[12]=o[0],I[13]=o[1],I[14]=o[2],I[15]=1,I}function D(o,p){return p=p||new b(16),p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=o[0],p[13]=o[1],p[14]=o[2],p[15]=1,p}function be(o,p,x){x=x||new b(16);var I=p[0],E=p[1],y=p[2],m=o[0],A=o[1],w=o[2],B=o[3],k=o[1*4+0],q=o[1*4+1],Y=o[1*4+2],ie=o[1*4+3],se=o[2*4+0],ue=o[2*4+1],me=o[2*4+2],fe=o[2*4+3],ve=o[3*4+0],xe=o[3*4+1],he=o[3*4+2],Ee=o[3*4+3];return o!==x&&(x[0]=m,x[1]=A,x[2]=w,x[3]=B,x[4]=k,x[5]=q,x[6]=Y,x[7]=ie,x[8]=se,x[9]=ue,x[10]=me,x[11]=fe),x[12]=m*I+k*E+se*y+ve,x[13]=A*I+q*E+ue*y+xe,x[14]=w*I+Y*E+me*y+he,x[15]=B*I+ie*E+fe*y+Ee,x}function we(o,p){p=p||new b(16);var x=Math.cos(o),I=Math.sin(o);return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=x,p[6]=I,p[7]=0,p[8]=0,p[9]=-I,p[10]=x,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}function Se(o,p,x){x=x||new b(16);var I=o[4],E=o[5],y=o[6],m=o[7],A=o[8],w=o[9],B=o[10],k=o[11],q=Math.cos(p),Y=Math.sin(p);return x[4]=q*I+Y*A,x[5]=q*E+Y*w,x[6]=q*y+Y*B,x[7]=q*m+Y*k,x[8]=q*A-Y*I,x[9]=q*w-Y*E,x[10]=q*B-Y*y,x[11]=q*k-Y*m,o!==x&&(x[0]=o[0],x[1]=o[1],x[2]=o[2],x[3]=o[3],x[12]=o[12],x[13]=o[13],x[14]=o[14],x[15]=o[15]),x}function Ge(o,p){p=p||new b(16);var x=Math.cos(o),I=Math.sin(o);return p[0]=x,p[1]=0,p[2]=-I,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=I,p[9]=0,p[10]=x,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}function We(o,p,x){x=x||new b(16);var I=o[0*4+0],E=o[0*4+1],y=o[0*4+2],m=o[0*4+3],A=o[2*4+0],w=o[2*4+1],B=o[2*4+2],k=o[2*4+3],q=Math.cos(p),Y=Math.sin(p);return x[0]=q*I-Y*A,x[1]=q*E-Y*w,x[2]=q*y-Y*B,x[3]=q*m-Y*k,x[8]=q*A+Y*I,x[9]=q*w+Y*E,x[10]=q*B+Y*y,x[11]=q*k+Y*m,o!==x&&(x[4]=o[4],x[5]=o[5],x[6]=o[6],x[7]=o[7],x[12]=o[12],x[13]=o[13],x[14]=o[14],x[15]=o[15]),x}function tt(o,p){p=p||new b(16);var x=Math.cos(o),I=Math.sin(o);return p[0]=x,p[1]=I,p[2]=0,p[3]=0,p[4]=-I,p[5]=x,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}function $e(o,p,x){x=x||new b(16);var I=o[0*4+0],E=o[0*4+1],y=o[0*4+2],m=o[0*4+3],A=o[1*4+0],w=o[1*4+1],B=o[1*4+2],k=o[1*4+3],q=Math.cos(p),Y=Math.sin(p);return x[0]=q*I+Y*A,x[1]=q*E+Y*w,x[2]=q*y+Y*B,x[3]=q*m+Y*k,x[4]=q*A-Y*I,x[5]=q*w-Y*E,x[6]=q*B-Y*y,x[7]=q*k-Y*m,o!==x&&(x[8]=o[8],x[9]=o[9],x[10]=o[10],x[11]=o[11],x[12]=o[12],x[13]=o[13],x[14]=o[14],x[15]=o[15]),x}function mt(o,p,x){x=x||new b(16);var I=o[0],E=o[1],y=o[2],m=Math.sqrt(I*I+E*E+y*y);I/=m,E/=m,y/=m;var A=I*I,w=E*E,B=y*y,k=Math.cos(p),q=Math.sin(p),Y=1-k;return x[0]=A+(1-A)*k,x[1]=I*E*Y+y*q,x[2]=I*y*Y-E*q,x[3]=0,x[4]=I*E*Y-y*q,x[5]=w+(1-w)*k,x[6]=E*y*Y+I*q,x[7]=0,x[8]=I*y*Y+E*q,x[9]=E*y*Y-I*q,x[10]=B+(1-B)*k,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x}function Mt(o,p,x,I){I=I||new b(16);var E=p[0],y=p[1],m=p[2],A=Math.sqrt(E*E+y*y+m*m);E/=A,y/=A,m/=A;var w=E*E,B=y*y,k=m*m,q=Math.cos(x),Y=Math.sin(x),ie=1-q,se=w+(1-w)*q,ue=E*y*ie+m*Y,me=E*m*ie-y*Y,fe=E*y*ie-m*Y,ve=B+(1-B)*q,xe=y*m*ie+E*Y,he=E*m*ie+y*Y,Ee=y*m*ie-E*Y,ze=k+(1-k)*q,Ze=o[0],je=o[1],He=o[2],Fe=o[3],De=o[4],et=o[5],qe=o[6],Ke=o[7],Ye=o[8],rt=o[9],Be=o[10],ke=o[11];return I[0]=se*Ze+ue*De+me*Ye,I[1]=se*je+ue*et+me*rt,I[2]=se*He+ue*qe+me*Be,I[3]=se*Fe+ue*Ke+me*ke,I[4]=fe*Ze+ve*De+xe*Ye,I[5]=fe*je+ve*et+xe*rt,I[6]=fe*He+ve*qe+xe*Be,I[7]=fe*Fe+ve*Ke+xe*ke,I[8]=he*Ze+Ee*De+ze*Ye,I[9]=he*je+Ee*et+ze*rt,I[10]=he*He+Ee*qe+ze*Be,I[11]=he*Fe+Ee*Ke+ze*ke,o!==I&&(I[12]=o[12],I[13]=o[13],I[14]=o[14],I[15]=o[15]),I}function yt(o,p){return p=p||new b(16),p[0]=o[0],p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=o[1],p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=o[2],p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}function lt(o,p,x){x=x||new b(16);var I=p[0],E=p[1],y=p[2];return x[0]=I*o[0],x[1]=I*o[1],x[2]=I*o[2],x[3]=I*o[3],x[4]=E*o[4],x[5]=E*o[5],x[6]=E*o[6],x[7]=E*o[7],x[8]=y*o[8],x[9]=y*o[9],x[10]=y*o[10],x[11]=y*o[11],o!==x&&(x[12]=o[12],x[13]=o[13],x[14]=o[14],x[15]=o[15]),x}function vt(o,p,x){x=x||d.create();var I=p[0],E=p[1],y=p[2],m=I*o[0*4+3]+E*o[1*4+3]+y*o[2*4+3]+o[3*4+3];return x[0]=(I*o[0]+E*o[4]+y*o[8]+o[12])/m,x[1]=(I*o[1]+E*o[5]+y*o[9]+o[13])/m,x[2]=(I*o[2]+E*o[6]+y*o[10]+o[14])/m,x}function Ft(o,p,x){x=x||d.create();var I=p[0],E=p[1],y=p[2];return x[0]=I*o[0]+E*o[4]+y*o[8],x[1]=I*o[1]+E*o[5]+y*o[9],x[2]=I*o[2]+E*o[6]+y*o[10],x}function de(o,p,x){x=x||d.create();var I=z(o),E=p[0],y=p[1],m=p[2];return x[0]=E*I[0]+y*I[1]+m*I[2],x[1]=E*I[4]+y*I[5]+m*I[6],x[2]=E*I[8]+y*I[9]+m*I[10],x}},"./src/primitives.js":(h,i,u)=>{function v(y){"@babel/helpers - typeof";return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(m){return typeof m}:function(m){return m&&typeof Symbol=="function"&&m.constructor===Symbol&&m!==Symbol.prototype?"symbol":typeof m},v(y)}i.__esModule=!0,i.concatVertices=p,i.create3DFBuffers=i.create3DFBufferInfo=void 0,i.create3DFVertices=Ge,i.createAugmentedTypedArray=z,i.createCrescentBuffers=i.createCrescentBufferInfo=void 0,i.createCrescentVertices=We,i.createCubeBuffers=i.createCubeBufferInfo=i.createCresentVertices=i.createCresentBuffers=i.createCresentBufferInfo=void 0,i.createCubeVertices=be,i.createCylinderBuffers=i.createCylinderBufferInfo=void 0,i.createCylinderVertices=tt,i.createDiscBuffers=i.createDiscBufferInfo=void 0,i.createDiscVertices=mt,i.createPlaneBuffers=i.createPlaneBufferInfo=void 0,i.createPlaneVertices=V,i.createSphereBuffers=i.createSphereBufferInfo=void 0,i.createSphereVertices=Q,i.createTorusBuffers=i.createTorusBufferInfo=void 0,i.createTorusVertices=$e,i.createTruncatedConeBuffers=i.createTruncatedConeBufferInfo=void 0,i.createTruncatedConeVertices=we,i.createXYQuadBuffers=i.createXYQuadBufferInfo=void 0,i.createXYQuadVertices=G,i.deindexVertices=ne,i.duplicateVertices=x,i.flattenNormals=ae,i.makeRandomVertexColors=yt,i.reorientDirections=at,i.reorientNormals=st,i.reorientPositions=Xe,i.reorientVertices=ge;var d=ee(u("./src/attributes.js")),g=ee(u("./src/helper.js")),_=ee(u("./src/typedarrays.js")),b=ee(u("./src/m4.js")),R=ee(u("./src/v3.js"));function U(y){if(typeof WeakMap!="function")return null;var m=new WeakMap,A=new WeakMap;return(U=function(B){return B?A:m})(y)}function ee(y,m){if(!m&&y&&y.__esModule)return y;if(y===null||v(y)!="object"&&typeof y!="function")return{default:y};var A=U(m);if(A&&A.has(y))return A.get(y);var w={__proto__:null},B=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var k in y)if(k!=="default"&&Object.prototype.hasOwnProperty.call(y,k)){var q=B?Object.getOwnPropertyDescriptor(y,k):null;q&&(q.get||q.set)?Object.defineProperty(w,k,q):w[k]=y[k]}return w.default=y,A&&A.set(y,w),w}var C=d.getArray_,K=d.getNumComponents_;function J(y,m){var A=0;return y.push=function(){for(var w=0;w<arguments.length;++w){var B=arguments[w];if(B instanceof Array||_.isArrayBuffer(B))for(var k=0;k<B.length;++k)y[A++]=B[k];else y[A++]=B}},y.reset=function(w){A=w||0},y.numComponents=m,Object.defineProperty(y,"numElements",{get:function(){return this.length/this.numComponents|0}}),y}function z(y,m,A){var w=A||Float32Array;return J(new w(y*m),y)}function X(y){return y!=="indices"}function ne(y){var m=y.indices,A={},w=m.length;function B(k){for(var q=y[k],Y=q.numComponents,ie=z(Y,w,q.constructor),se=0;se<w;++se)for(var ue=m[se],me=ue*Y,fe=0;fe<Y;++fe)ie.push(q[me+fe]);A[k]=ie}return Object.keys(y).filter(X).forEach(B),A}function ae(y){if(y.indices)throw new Error("can not flatten normals of indexed vertices. deindex them first");for(var m=y.normal,A=m.length,w=0;w<A;w+=9){var B=m[w+0],k=m[w+1],q=m[w+2],Y=m[w+3],ie=m[w+4],se=m[w+5],ue=m[w+6],me=m[w+7],fe=m[w+8],ve=B+Y+ue,xe=k+ie+me,he=q+se+fe,Ee=Math.sqrt(ve*ve+xe*xe+he*he);ve/=Ee,xe/=Ee,he/=Ee,m[w+0]=ve,m[w+1]=xe,m[w+2]=he,m[w+3]=ve,m[w+4]=xe,m[w+5]=he,m[w+6]=ve,m[w+7]=xe,m[w+8]=he}return y}function Ne(y,m,A){for(var w=y.length,B=new Float32Array(3),k=0;k<w;k+=3)A(m,[y[k],y[k+1],y[k+2]],B),y[k]=B[0],y[k+1]=B[1],y[k+2]=B[2]}function Ae(y,m,A){A=A||R.create();var w=m[0],B=m[1],k=m[2];return A[0]=w*y[0]+B*y[1]+k*y[2],A[1]=w*y[4]+B*y[5]+k*y[6],A[2]=w*y[8]+B*y[9]+k*y[10],A}function at(y,m){return Ne(y,m,b.transformDirection),y}function st(y,m){return Ne(y,b.inverse(m),Ae),y}function Xe(y,m){return Ne(y,m,b.transformPoint),y}function ge(y,m){return Object.keys(y).forEach(function(A){var w=y[A];A.indexOf("pos")>=0?Xe(w,m):A.indexOf("tan")>=0||A.indexOf("binorm")>=0?at(w,m):A.indexOf("norm")>=0&&st(w,m)}),y}function G(y,m,A){return y=y||2,m=m||0,A=A||0,y*=.5,{position:{numComponents:2,data:[m+-1*y,A+-1*y,m+1*y,A+-1*y,m+-1*y,A+1*y,m+1*y,A+1*y]},normal:[0,0,1,0,0,1,0,0,1,0,0,1],texcoord:[0,0,1,0,0,1,1,1],indices:[0,1,2,2,1,3]}}function V(y,m,A,w,B){y=y||1,m=m||1,A=A||1,w=w||1,B=B||b.identity();for(var k=(A+1)*(w+1),q=z(3,k),Y=z(3,k),ie=z(2,k),se=0;se<=w;se++)for(var ue=0;ue<=A;ue++){var me=ue/A,fe=se/w;q.push(y*me-y*.5,0,m*fe-m*.5),Y.push(0,1,0),ie.push(me,fe)}for(var ve=A+1,xe=z(3,A*w*2,Uint16Array),he=0;he<w;he++)for(var Ee=0;Ee<A;Ee++)xe.push((he+0)*ve+Ee,(he+1)*ve+Ee,(he+0)*ve+Ee+1),xe.push((he+1)*ve+Ee,(he+1)*ve+Ee+1,(he+0)*ve+Ee+1);var ze=ge({position:q,normal:Y,texcoord:ie,indices:xe},B);return ze}function Q(y,m,A,w,B,k,q){if(m<=0||A<=0)throw new Error("subdivisionAxis and subdivisionHeight must be > 0");w=w||0,B=B||Math.PI,k=k||0,q=q||Math.PI*2;for(var Y=B-w,ie=q-k,se=(m+1)*(A+1),ue=z(3,se),me=z(3,se),fe=z(2,se),ve=0;ve<=A;ve++)for(var xe=0;xe<=m;xe++){var he=xe/m,Ee=ve/A,ze=ie*he+k,Ze=Y*Ee+w,je=Math.sin(ze),He=Math.cos(ze),Fe=Math.sin(Ze),De=Math.cos(Ze),et=He*Fe,qe=De,Ke=je*Fe;ue.push(y*et,y*qe,y*Ke),me.push(et,qe,Ke),fe.push(1-he,Ee)}for(var Ye=m+1,rt=z(3,m*A*2,Uint16Array),Be=0;Be<m;Be++)for(var ke=0;ke<A;ke++)rt.push((ke+0)*Ye+Be,(ke+0)*Ye+Be+1,(ke+1)*Ye+Be),rt.push((ke+1)*Ye+Be,(ke+0)*Ye+Be+1,(ke+1)*Ye+Be+1);return{position:ue,normal:me,texcoord:fe,indices:rt}}var D=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];function be(y){y=y||1;for(var m=y/2,A=[[-m,-m,-m],[+m,-m,-m],[-m,+m,-m],[+m,+m,-m],[-m,-m,+m],[+m,-m,+m],[-m,+m,+m],[+m,+m,+m]],w=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],B=[[1,0],[0,0],[0,1],[1,1]],k=6*4,q=z(3,k),Y=z(3,k),ie=z(2,k),se=z(3,6*2,Uint16Array),ue=0;ue<6;++ue){for(var me=D[ue],fe=0;fe<4;++fe){var ve=A[me[fe]],xe=w[ue],he=B[fe];q.push(ve),Y.push(xe),ie.push(he)}var Ee=4*ue;se.push(Ee+0,Ee+1,Ee+2),se.push(Ee+0,Ee+2,Ee+3)}return{position:q,normal:Y,texcoord:ie,indices:se}}function we(y,m,A,w,B,k,q){if(w<3)throw new Error("radialSubdivisions must be 3 or greater");if(B<1)throw new Error("verticalSubdivisions must be 1 or greater");for(var Y=k===void 0?!0:k,ie=q===void 0?!0:q,se=(Y?2:0)+(ie?2:0),ue=(w+1)*(B+1+se),me=z(3,ue),fe=z(3,ue),ve=z(2,ue),xe=z(3,w*(B+se/2)*2,Uint16Array),he=w+1,Ee=Math.atan2(y-m,A),ze=Math.cos(Ee),Ze=Math.sin(Ee),je=Y?-2:0,He=B+(ie?2:0),Fe=je;Fe<=He;++Fe){var De=Fe/B,et=A*De,qe=void 0;Fe<0?(et=0,De=1,qe=y):Fe>B?(et=A,De=1,qe=m):qe=y+(m-y)*(Fe/B),(Fe===-2||Fe===B+2)&&(qe=0,De=0),et-=A/2;for(var Ke=0;Ke<he;++Ke){var Ye=Math.sin(Ke*Math.PI*2/w),rt=Math.cos(Ke*Math.PI*2/w);me.push(Ye*qe,et,rt*qe),Fe<0?fe.push(0,-1,0):Fe>B?fe.push(0,1,0):qe===0?fe.push(0,0,0):fe.push(Ye*ze,Ze,rt*ze),ve.push(Ke/w,1-De)}}for(var Be=0;Be<B+se;++Be)if(!(Be===1&&Y||Be===B+se-2&&ie))for(var ke=0;ke<w;++ke)xe.push(he*(Be+0)+0+ke,he*(Be+0)+1+ke,he*(Be+1)+1+ke),xe.push(he*(Be+0)+0+ke,he*(Be+1)+1+ke,he*(Be+1)+0+ke);return{position:me,normal:fe,texcoord:ve,indices:xe}}function Se(y,m){m=m||[];for(var A=[],w=0;w<y.length;w+=4){var B=y[w],k=y.slice(w+1,w+4);k.push.apply(k,m);for(var q=0;q<B;++q)A.push.apply(A,k)}return A}function Ge(){var y=[0,0,0,0,150,0,30,0,0,0,150,0,30,150,0,30,0,0,30,0,0,30,30,0,100,0,0,30,30,0,100,30,0,100,0,0,30,60,0,30,90,0,67,60,0,30,90,0,67,90,0,67,60,0,0,0,30,30,0,30,0,150,30,0,150,30,30,0,30,30,150,30,30,0,30,100,0,30,30,30,30,30,30,30,100,0,30,100,30,30,30,60,30,67,60,30,30,90,30,30,90,30,67,60,30,67,90,30,0,0,0,100,0,0,100,0,30,0,0,0,100,0,30,0,0,30,100,0,0,100,30,0,100,30,30,100,0,0,100,30,30,100,0,30,30,30,0,30,30,30,100,30,30,30,30,0,100,30,30,100,30,0,30,30,0,30,60,30,30,30,30,30,30,0,30,60,0,30,60,30,30,60,0,67,60,30,30,60,30,30,60,0,67,60,0,67,60,30,67,60,0,67,90,30,67,60,30,67,60,0,67,90,0,67,90,30,30,90,0,30,90,30,67,90,30,30,90,0,67,90,30,67,90,0,30,90,0,30,150,30,30,90,30,30,90,0,30,150,0,30,150,30,0,150,0,0,150,30,30,150,30,0,150,0,30,150,30,30,150,0,0,0,0,0,0,30,0,150,30,0,0,0,0,150,30,0,150,0],m=[.22,.19,.22,.79,.34,.19,.22,.79,.34,.79,.34,.19,.34,.19,.34,.31,.62,.19,.34,.31,.62,.31,.62,.19,.34,.43,.34,.55,.49,.43,.34,.55,.49,.55,.49,.43,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,0,0,1,1,1,0],A=Se([18,0,0,1,18,0,0,-1,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,-1,0,6,-1,0,0]),w=Se([18,200,70,120,18,80,70,200,6,70,200,210,6,200,200,70,6,210,100,70,6,210,160,70,6,70,180,210,6,100,70,210,6,76,210,100,6,140,210,80,6,90,130,110,6,160,160,220],[255]),B=y.length/3,k={position:z(3,B),texcoord:z(2,B),normal:z(3,B),color:z(4,B,Uint8Array),indices:z(3,B/3,Uint16Array)};k.position.push(y),k.texcoord.push(m),k.normal.push(A),k.color.push(w);for(var q=0;q<B;++q)k.indices.push(q);return k}function We(y,m,A,w,B,k,q){if(B<=0)throw new Error("subdivisionDown must be > 0");k=k||0,q=q||1;var Y=2,ie=q-k,se=(B+1)*2*(2+Y),ue=z(3,se),me=z(3,se),fe=z(2,se);function ve(He,Fe,De){return He+(Fe-He)*De}function xe(He,Fe,De,et,qe,Ke){for(var Ye=0;Ye<=B;Ye++){var rt=Fe/(Y-1),Be=Ye/B,ke=(rt-.5)*2,Tt=(k+Be*ie)*Math.PI,dt=Math.sin(Tt),Ct=Math.cos(Tt),Dt=ve(y,He,dt),qt=ke*w,Kt=Ct*y,Jt=dt*Dt;ue.push(qt,Kt,Jt);var yr=R.add(R.multiply([0,dt,Ct],De),et);me.push(yr),fe.push(rt*qe+Ke,Be)}}for(var he=0;he<Y;he++){var Ee=(he/(Y-1)-.5)*2;xe(m,he,[1,1,1],[0,0,0],1,0),xe(m,he,[0,0,0],[Ee,0,0],0,0),xe(A,he,[1,1,1],[0,0,0],1,0),xe(A,he,[0,0,0],[Ee,0,0],0,1)}var ze=z(3,B*2*(2+Y),Uint16Array);function Ze(He,Fe){for(var De=0;De<B;++De)ze.push(He+De+0,He+De+1,Fe+De+0),ze.push(He+De+1,Fe+De+1,Fe+De+0)}var je=B+1;return Ze(je*0,je*4),Ze(je*5,je*7),Ze(je*6,je*2),Ze(je*3,je*1),{position:ue,normal:me,texcoord:fe,indices:ze}}function tt(y,m,A,w,B,k){return we(y,y,m,A,w,B,k)}function $e(y,m,A,w,B,k){if(A<3)throw new Error("radialSubdivisions must be 3 or greater");if(w<3)throw new Error("verticalSubdivisions must be 3 or greater");B=B||0,k=k||Math.PI*2;for(var q=k-B,Y=A+1,ie=w+1,se=Y*ie,ue=z(3,se),me=z(3,se),fe=z(2,se),ve=z(3,A*w*2,Uint16Array),xe=0;xe<ie;++xe)for(var he=xe/w,Ee=he*Math.PI*2,ze=Math.sin(Ee),Ze=y+ze*m,je=Math.cos(Ee),He=je*m,Fe=0;Fe<Y;++Fe){var De=Fe/A,et=B+De*q,qe=Math.sin(et),Ke=Math.cos(et),Ye=qe*Ze,rt=Ke*Ze,Be=qe*ze,ke=Ke*ze;ue.push(Ye,He,rt),me.push(Be,je,ke),fe.push(De,1-he)}for(var Tt=0;Tt<w;++Tt)for(var dt=0;dt<A;++dt){var Ct=1+dt,Dt=1+Tt;ve.push(Y*Tt+dt,Y*Dt+dt,Y*Tt+Ct),ve.push(Y*Dt+dt,Y*Dt+Ct,Y*Tt+Ct)}return{position:ue,normal:me,texcoord:fe,indices:ve}}function mt(y,m,A,w,B){if(m<3)throw new Error("divisions must be at least 3");A=A||1,B=B||1,w=w||0;for(var k=(m+1)*(A+1),q=z(3,k),Y=z(3,k),ie=z(2,k),se=z(3,A*m*2,Uint16Array),ue=0,me=y-w,fe=m+1,ve=0;ve<=A;++ve){for(var xe=w+me*Math.pow(ve/A,B),he=0;he<=m;++he){var Ee=2*Math.PI*he/m,ze=xe*Math.cos(Ee),Ze=xe*Math.sin(Ee);if(q.push(ze,0,Ze),Y.push(0,1,0),ie.push(1-he/m,ve/A),ve>0&&he!==m){var je=ue+(he+1),He=ue+he,Fe=ue+he-fe,De=ue+(he+1)-fe;se.push(je,He,Fe),se.push(je,Fe,De)}}ue+=m+1}return{position:q,normal:Y,texcoord:ie,indices:se}}function Mt(y){return Math.random()*y|0}function yt(y,m){m=m||{};var A=y.position.numElements,w=z(4,A,Uint8Array),B=m.rand||function(me,fe){return fe<3?Mt(256):255};if(y.color=w,y.indices)for(var k=0;k<A;++k)w.push(B(k,0),B(k,1),B(k,2),B(k,3));else for(var q=m.vertsPerColor||3,Y=A/q,ie=0;ie<Y;++ie)for(var se=[B(ie,0),B(ie,1),B(ie,2),B(ie,3)],ue=0;ue<q;++ue)w.push(se);return y}function lt(y){return function(m){var A=y.apply(this,Array.prototype.slice.call(arguments,1));return d.createBuffersFromArrays(m,A)}}function vt(y){return function(m){var A=y.apply(null,Array.prototype.slice.call(arguments,1));return d.createBufferInfoFromArrays(m,A)}}var Ft=["numComponents","size","type","normalize","stride","offset","attrib","name","attribName"];function de(y,m,A,w){w=w||0;for(var B=y.length,k=0;k<B;++k)m[A+k]=y[k]+w}function o(y,m){var A=C(y),w=new A.constructor(m),B=w;return A.numComponents&&A.numElements&&J(w,A.numComponents),y.data&&(B={data:w},g.copyNamedProperties(Ft,y,B)),B}function p(y){for(var m={},A,w=function(){var ue=y[B];Object.keys(ue).forEach(function(me){m[me]||(m[me]=[]),!A&&me!=="indices"&&(A=me);var fe=ue[me],ve=K(fe,me),xe=C(fe),he=xe.length/ve;m[me].push(he)})},B=0;B<y.length;++B)w();function k(se){for(var ue=0,me,fe=0;fe<y.length;++fe){var ve=y[fe],xe=ve[se],he=C(xe);ue+=he.length,(!me||xe.data)&&(me=xe)}return{length:ue,spec:me}}function q(se,ue,me){for(var fe=0,ve=0,xe=0;xe<y.length;++xe){var he=y[xe],Ee=he[se],ze=C(Ee);se==="indices"?(de(ze,me,ve,fe),fe+=ue[xe]):de(ze,me,ve),ve+=ze.length}}var Y=m[A],ie={};return Object.keys(m).forEach(function(se){var ue=k(se),me=o(ue.spec,ue.length);q(se,Y,C(me)),ie[se]=me}),ie}function x(y){var m={};return Object.keys(y).forEach(function(A){var w=y[A],B=C(w),k=o(w,B.length);de(B,C(k),0),m[A]=k}),m}i.create3DFBufferInfo=vt(Ge),i.create3DFBuffers=lt(Ge),i.createCubeBufferInfo=vt(be),i.createCubeBuffers=lt(be),i.createPlaneBufferInfo=vt(V),i.createPlaneBuffers=lt(V),i.createSphereBufferInfo=vt(Q),i.createSphereBuffers=lt(Q),i.createTruncatedConeBufferInfo=vt(we),i.createTruncatedConeBuffers=lt(we),i.createXYQuadBufferInfo=vt(G),i.createXYQuadBuffers=lt(G);var I=i.createCrescentBufferInfo=vt(We),E=i.createCrescentBuffers=lt(We);i.createCylinderBufferInfo=vt(tt),i.createCylinderBuffers=lt(tt),i.createTorusBufferInfo=vt($e),i.createTorusBuffers=lt($e),i.createDiscBufferInfo=vt(mt),i.createDiscBuffers=lt(mt),i.createCresentBufferInfo=I,i.createCresentBuffers=E,i.createCresentVertices=We},"./src/programs.js":(h,i,u)=>{function v(s){"@babel/helpers - typeof";return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},v(s)}i.__esModule=!0,i.bindTransformFeedbackInfo=tn,i.bindUniformBlock=rn,i.createAttributeSetters=Nn,i.createProgram=Nr,i.createProgramAsync=void 0,i.createProgramFromScripts=Sn,i.createProgramFromSources=Mn,i.createProgramInfo=T,i.createProgramInfoAsync=void 0,i.createProgramInfoFromProgram=an,i.createProgramInfos=L,i.createProgramInfosAsync=void 0,i.createPrograms=M,i.createProgramsAsync=void 0,i.createTransformFeedback=Cn,i.createTransformFeedbackInfo=en,i.createUniformBlockInfo=Pn,i.createUniformBlockInfoFromProgram=Rn,i.createUniformBlockSpecFromProgram=hr,i.createUniformSetters=vr,i.setAttributes=Dn,i.setBlockUniforms=Yi,i.setBuffersAndAttributes=$i,i.setUniformBlock=oi,i.setUniforms=nn,i.setUniformsAndBindTextures=void 0;var d=b(u("./src/utils.js")),g=b(u("./src/helper.js"));function _(s){if(typeof WeakMap!="function")return null;var c=new WeakMap,f=new WeakMap;return(_=function(P){return P?f:c})(s)}function b(s,c){if(!c&&s&&s.__esModule)return s;if(s===null||v(s)!="object"&&typeof s!="function")return{default:s};var f=_(c);if(f&&f.has(s))return f.get(s);var F={__proto__:null},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var O in s)if(O!=="default"&&Object.prototype.hasOwnProperty.call(s,O)){var j=P?Object.getOwnPropertyDescriptor(s,O):null;j&&(j.get||j.set)?Object.defineProperty(F,O,j):F[O]=s[O]}return F.default=s,f&&f.set(s,F),F}function R(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */R=function(){return c};var s,c={},f=Object.prototype,F=f.hasOwnProperty,P=Object.defineProperty||function(pe,re,oe){pe[re]=oe.value},O=typeof Symbol=="function"?Symbol:{},j=O.iterator||"@@iterator",W=O.asyncIterator||"@@asyncIterator",$=O.toStringTag||"@@toStringTag";function H(pe,re,oe){return Object.defineProperty(pe,re,{value:oe,enumerable:!0,configurable:!0,writable:!0}),pe[re]}try{H({},"")}catch{H=function(oe,Me,Le){return oe[Me]=Le}}function te(pe,re,oe,Me){var Le=re&&re.prototype instanceof Ve?re:Ve,Re=Object.create(Le.prototype),pt=new Ki(Me||[]);return P(Re,"_invoke",{value:Hs(pe,oe,pt)}),Re}function ye(pe,re,oe){try{return{type:"normal",arg:pe.call(re,oe)}}catch(Me){return{type:"throw",arg:Me}}}c.wrap=te;var Te="suspendedStart",_e="suspendedYield",Pe="executing",Ue="completed",Oe={};function Ve(){}function Qe(){}function ft(){}var bt={};H(bt,j,function(){return this});var It=Object.getPrototypeOf,Yt=It&&It(It(Ji([])));Yt&&Yt!==f&&F.call(Yt,j)&&(bt=Yt);var rr=ft.prototype=Ve.prototype=Object.create(bt);function ci(pe){["next","throw","return"].forEach(function(re){H(pe,re,function(oe){return this._invoke(re,oe)})})}function hi(pe,re){function oe(Le,Re,pt,Bt){var zt=ye(pe[Le],pe,Re);if(zt.type!=="throw"){var Ir=zt.arg,xr=Ir.value;return xr&&v(xr)=="object"&&F.call(xr,"__await")?re.resolve(xr.__await).then(function(Br){oe("next",Br,pt,Bt)},function(Br){oe("throw",Br,pt,Bt)}):re.resolve(xr).then(function(Br){Ir.value=Br,pt(Ir)},function(Br){return oe("throw",Br,pt,Bt)})}Bt(zt.arg)}var Me;P(this,"_invoke",{value:function(Re,pt){function Bt(){return new re(function(zt,Ir){oe(Re,pt,zt,Ir)})}return Me=Me?Me.then(Bt,Bt):Bt()}})}function Hs(pe,re,oe){var Me=Te;return function(Le,Re){if(Me===Pe)throw new Error("Generator is already running");if(Me===Ue){if(Le==="throw")throw Re;return{value:s,done:!0}}for(oe.method=Le,oe.arg=Re;;){var pt=oe.delegate;if(pt){var Bt=Ua(pt,oe);if(Bt){if(Bt===Oe)continue;return Bt}}if(oe.method==="next")oe.sent=oe._sent=oe.arg;else if(oe.method==="throw"){if(Me===Te)throw Me=Ue,oe.arg;oe.dispatchException(oe.arg)}else oe.method==="return"&&oe.abrupt("return",oe.arg);Me=Pe;var zt=ye(pe,re,oe);if(zt.type==="normal"){if(Me=oe.done?Ue:_e,zt.arg===Oe)continue;return{value:zt.arg,done:oe.done}}zt.type==="throw"&&(Me=Ue,oe.method="throw",oe.arg=zt.arg)}}}function Ua(pe,re){var oe=re.method,Me=pe.iterator[oe];if(Me===s)return re.delegate=null,oe==="throw"&&pe.iterator.return&&(re.method="return",re.arg=s,Ua(pe,re),re.method==="throw")||oe!=="return"&&(re.method="throw",re.arg=new TypeError("The iterator does not provide a '"+oe+"' method")),Oe;var Le=ye(Me,pe.iterator,re.arg);if(Le.type==="throw")return re.method="throw",re.arg=Le.arg,re.delegate=null,Oe;var Re=Le.arg;return Re?Re.done?(re[pe.resultName]=Re.value,re.next=pe.nextLoc,re.method!=="return"&&(re.method="next",re.arg=s),re.delegate=null,Oe):Re:(re.method="throw",re.arg=new TypeError("iterator result is not an object"),re.delegate=null,Oe)}function Xs(pe){var re={tryLoc:pe[0]};1 in pe&&(re.catchLoc=pe[1]),2 in pe&&(re.finallyLoc=pe[2],re.afterLoc=pe[3]),this.tryEntries.push(re)}function Qi(pe){var re=pe.completion||{};re.type="normal",delete re.arg,pe.completion=re}function Ki(pe){this.tryEntries=[{tryLoc:"root"}],pe.forEach(Xs,this),this.reset(!0)}function Ji(pe){if(pe||pe===""){var re=pe[j];if(re)return re.call(pe);if(typeof pe.next=="function")return pe;if(!isNaN(pe.length)){var oe=-1,Me=function Le(){for(;++oe<pe.length;)if(F.call(pe,oe))return Le.value=pe[oe],Le.done=!1,Le;return Le.value=s,Le.done=!0,Le};return Me.next=Me}}throw new TypeError(v(pe)+" is not iterable")}return Qe.prototype=ft,P(rr,"constructor",{value:ft,configurable:!0}),P(ft,"constructor",{value:Qe,configurable:!0}),Qe.displayName=H(ft,$,"GeneratorFunction"),c.isGeneratorFunction=function(pe){var re=typeof pe=="function"&&pe.constructor;return!!re&&(re===Qe||(re.displayName||re.name)==="GeneratorFunction")},c.mark=function(pe){return Object.setPrototypeOf?Object.setPrototypeOf(pe,ft):(pe.__proto__=ft,H(pe,$,"GeneratorFunction")),pe.prototype=Object.create(rr),pe},c.awrap=function(pe){return{__await:pe}},ci(hi.prototype),H(hi.prototype,W,function(){return this}),c.AsyncIterator=hi,c.async=function(pe,re,oe,Me,Le){Le===void 0&&(Le=Promise);var Re=new hi(te(pe,re,oe,Me),Le);return c.isGeneratorFunction(re)?Re:Re.next().then(function(pt){return pt.done?pt.value:Re.next()})},ci(rr),H(rr,$,"Generator"),H(rr,j,function(){return this}),H(rr,"toString",function(){return"[object Generator]"}),c.keys=function(pe){var re=Object(pe),oe=[];for(var Me in re)oe.push(Me);return oe.reverse(),function Le(){for(;oe.length;){var Re=oe.pop();if(Re in re)return Le.value=Re,Le.done=!1,Le}return Le.done=!0,Le}},c.values=Ji,Ki.prototype={constructor:Ki,reset:function(re){if(this.prev=0,this.next=0,this.sent=this._sent=s,this.done=!1,this.delegate=null,this.method="next",this.arg=s,this.tryEntries.forEach(Qi),!re)for(var oe in this)oe.charAt(0)==="t"&&F.call(this,oe)&&!isNaN(+oe.slice(1))&&(this[oe]=s)},stop:function(){this.done=!0;var re=this.tryEntries[0].completion;if(re.type==="throw")throw re.arg;return this.rval},dispatchException:function(re){if(this.done)throw re;var oe=this;function Me(Ir,xr){return pt.type="throw",pt.arg=re,oe.next=Ir,xr&&(oe.method="next",oe.arg=s),!!xr}for(var Le=this.tryEntries.length-1;Le>=0;--Le){var Re=this.tryEntries[Le],pt=Re.completion;if(Re.tryLoc==="root")return Me("end");if(Re.tryLoc<=this.prev){var Bt=F.call(Re,"catchLoc"),zt=F.call(Re,"finallyLoc");if(Bt&&zt){if(this.prev<Re.catchLoc)return Me(Re.catchLoc,!0);if(this.prev<Re.finallyLoc)return Me(Re.finallyLoc)}else if(Bt){if(this.prev<Re.catchLoc)return Me(Re.catchLoc,!0)}else{if(!zt)throw new Error("try statement without catch or finally");if(this.prev<Re.finallyLoc)return Me(Re.finallyLoc)}}}},abrupt:function(re,oe){for(var Me=this.tryEntries.length-1;Me>=0;--Me){var Le=this.tryEntries[Me];if(Le.tryLoc<=this.prev&&F.call(Le,"finallyLoc")&&this.prev<Le.finallyLoc){var Re=Le;break}}Re&&(re==="break"||re==="continue")&&Re.tryLoc<=oe&&oe<=Re.finallyLoc&&(Re=null);var pt=Re?Re.completion:{};return pt.type=re,pt.arg=oe,Re?(this.method="next",this.next=Re.finallyLoc,Oe):this.complete(pt)},complete:function(re,oe){if(re.type==="throw")throw re.arg;return re.type==="break"||re.type==="continue"?this.next=re.arg:re.type==="return"?(this.rval=this.arg=re.arg,this.method="return",this.next="end"):re.type==="normal"&&oe&&(this.next=oe),Oe},finish:function(re){for(var oe=this.tryEntries.length-1;oe>=0;--oe){var Me=this.tryEntries[oe];if(Me.finallyLoc===re)return this.complete(Me.completion,Me.afterLoc),Qi(Me),Oe}},catch:function(re){for(var oe=this.tryEntries.length-1;oe>=0;--oe){var Me=this.tryEntries[oe];if(Me.tryLoc===re){var Le=Me.completion;if(Le.type==="throw"){var Re=Le.arg;Qi(Me)}return Re}}throw new Error("illegal catch attempt")},delegateYield:function(re,oe,Me){return this.delegate={iterator:Ji(re),resultName:oe,nextLoc:Me},this.method==="next"&&(this.arg=s),Oe}},c}function U(s,c){var f=Object.keys(s);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(s);c&&(F=F.filter(function(P){return Object.getOwnPropertyDescriptor(s,P).enumerable})),f.push.apply(f,F)}return f}function ee(s){for(var c=1;c<arguments.length;c++){var f=arguments[c]!=null?arguments[c]:{};c%2?U(Object(f),!0).forEach(function(F){C(s,F,f[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(f)):U(Object(f)).forEach(function(F){Object.defineProperty(s,F,Object.getOwnPropertyDescriptor(f,F))})}return s}function C(s,c,f){return c=K(c),c in s?Object.defineProperty(s,c,{value:f,enumerable:!0,configurable:!0,writable:!0}):s[c]=f,s}function K(s){var c=J(s,"string");return v(c)=="symbol"?c:String(c)}function J(s,c){if(v(s)!="object"||!s)return s;var f=s[Symbol.toPrimitive];if(f!==void 0){var F=f.call(s,c||"default");if(v(F)!="object")return F;throw new TypeError("@@toPrimitive must return a primitive value.")}return(c==="string"?String:Number)(s)}function z(s,c,f,F,P,O,j){try{var W=s[O](j),$=W.value}catch(H){f(H);return}W.done?c($):Promise.resolve($).then(F,P)}function X(s){return function(){var c=this,f=arguments;return new Promise(function(F,P){var O=s.apply(c,f);function j($){z(O,F,P,j,W,"next",$)}function W($){z(O,F,P,j,W,"throw",$)}j(void 0)})}}function ne(s,c){return Ae(s)||Ne(s,c)||ge(s,c)||ae()}function ae(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ne(s,c){var f=s==null?null:typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(f!=null){var F,P,O,j,W=[],$=!0,H=!1;try{if(O=(f=f.call(s)).next,c===0){if(Object(f)!==f)return;$=!1}else for(;!($=(F=O.call(f)).done)&&(W.push(F.value),W.length!==c);$=!0);}catch(te){H=!0,P=te}finally{try{if(!$&&f.return!=null&&(j=f.return(),Object(j)!==j))return}finally{if(H)throw P}}return W}}function Ae(s){if(Array.isArray(s))return s}function at(s,c){var f=typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(!f){if(Array.isArray(s)||(f=ge(s))||c&&s&&typeof s.length=="number"){f&&(s=f);var F=0,P=function(){};return{s:P,n:function(){return F>=s.length?{done:!0}:{done:!1,value:s[F++]}},e:function(H){throw H},f:P}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var O=!0,j=!1,W;return{s:function(){f=f.call(s)},n:function(){var H=f.next();return O=H.done,H},e:function(H){j=!0,W=H},f:function(){try{!O&&f.return!=null&&f.return()}finally{if(j)throw W}}}}function st(s){return V(s)||G(s)||ge(s)||Xe()}function Xe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ge(s,c){if(s){if(typeof s=="string")return Q(s,c);var f=Object.prototype.toString.call(s).slice(8,-1);if(f==="Object"&&s.constructor&&(f=s.constructor.name),f==="Map"||f==="Set")return Array.from(s);if(f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f))return Q(s,c)}}function G(s){if(typeof Symbol<"u"&&s[Symbol.iterator]!=null||s["@@iterator"]!=null)return Array.from(s)}function V(s){if(Array.isArray(s))return Q(s)}function Q(s,c){(c==null||c>s.length)&&(c=s.length);for(var f=0,F=new Array(c);f<c;f++)F[f]=s[f];return F}var D=g.error,be=g.warn;function we(s){return typeof document<"u"&&document.getElementById?document.getElementById(s):null}var Se=33984,Ge=35048,We=34962,tt=34963,$e=35345,mt=35982,Mt=36386,yt=35713,lt=35714,vt=35632,Ft=35633,de=35981,o=35718,p=35721,x=35971,I=35382,E=35396,y=35398,m=35392,A=35395,w=5126,B=35664,k=35665,q=35666,Y=5124,ie=35667,se=35668,ue=35669,me=35670,fe=35671,ve=35672,xe=35673,he=35674,Ee=35675,ze=35676,Ze=35678,je=35680,He=35679,Fe=35682,De=35685,et=35686,qe=35687,Ke=35688,Ye=35689,rt=35690,Be=36289,ke=36292,Tt=36293,dt=5125,Ct=36294,Dt=36295,qt=36296,Kt=36298,Jt=36299,yr=36300,Wr=36303,jr=36306,Vr=36307,xt=36308,Li=36311,Hr=3553,Xr=34067,bn=32879,qr=35866,Ce={};function qn(s,c){return Ce[c].bindPoint}function zi(s,c){return function(f){s.uniform1f(c,f)}}function Ui(s,c){return function(f){s.uniform1fv(c,f)}}function ki(s,c){return function(f){s.uniform2fv(c,f)}}function Gi(s,c){return function(f){s.uniform3fv(c,f)}}function Wi(s,c){return function(f){s.uniform4fv(c,f)}}function Yn(s,c){return function(f){s.uniform1i(c,f)}}function $n(s,c){return function(f){s.uniform1iv(c,f)}}function Zn(s,c){return function(f){s.uniform2iv(c,f)}}function Qn(s,c){return function(f){s.uniform3iv(c,f)}}function Kn(s,c){return function(f){s.uniform4iv(c,f)}}function er(s,c){return function(f){s.uniform1ui(c,f)}}function ot(s,c){return function(f){s.uniform1uiv(c,f)}}function Yr(s,c){return function(f){s.uniform2uiv(c,f)}}function dr(s,c){return function(f){s.uniform3uiv(c,f)}}function $r(s,c){return function(f){s.uniform4uiv(c,f)}}function ir(s,c){return function(f){s.uniformMatrix2fv(c,!1,f)}}function Et(s,c){return function(f){s.uniformMatrix3fv(c,!1,f)}}function Jn(s,c){return function(f){s.uniformMatrix4fv(c,!1,f)}}function ei(s,c){return function(f){s.uniformMatrix2x3fv(c,!1,f)}}function ti(s,c){return function(f){s.uniformMatrix3x2fv(c,!1,f)}}function Ut(s,c){return function(f){s.uniformMatrix2x4fv(c,!1,f)}}function Pr(s,c){return function(f){s.uniformMatrix4x2fv(c,!1,f)}}function Tn(s,c){return function(f){s.uniformMatrix3x4fv(c,!1,f)}}function ji(s,c){return function(f){s.uniformMatrix4x3fv(c,!1,f)}}function At(s,c,f,F){var P=qn(s,c);return d.isWebGL2(s)?function(O){var j,W;!O||g.isTexture(s,O)?(j=O,W=null):(j=O.texture,W=O.sampler),s.uniform1i(F,f),s.activeTexture(Se+f),s.bindTexture(P,j),s.bindSampler(f,W)}:function(O){s.uniform1i(F,f),s.activeTexture(Se+f),s.bindTexture(P,O)}}function St(s,c,f,F,P){for(var O=qn(s,c),j=new Int32Array(P),W=0;W<P;++W)j[W]=f+W;return d.isWebGL2(s)?function($){s.uniform1iv(F,j),$.forEach(function(H,te){s.activeTexture(Se+j[te]);var ye,Te;!H||g.isTexture(s,H)?(ye=H,Te=null):(ye=H.texture,Te=H.sampler),s.bindSampler(f,Te),s.bindTexture(O,ye)})}:function($){s.uniform1iv(F,j),$.forEach(function(H,te){s.activeTexture(Se+j[te]),s.bindTexture(O,H)})}}Ce[w]={Type:Float32Array,size:4,setter:zi,arraySetter:Ui},Ce[B]={Type:Float32Array,size:8,setter:ki,cols:2},Ce[k]={Type:Float32Array,size:12,setter:Gi,cols:3},Ce[q]={Type:Float32Array,size:16,setter:Wi,cols:4},Ce[Y]={Type:Int32Array,size:4,setter:Yn,arraySetter:$n},Ce[ie]={Type:Int32Array,size:8,setter:Zn,cols:2},Ce[se]={Type:Int32Array,size:12,setter:Qn,cols:3},Ce[ue]={Type:Int32Array,size:16,setter:Kn,cols:4},Ce[dt]={Type:Uint32Array,size:4,setter:er,arraySetter:ot},Ce[Ct]={Type:Uint32Array,size:8,setter:Yr,cols:2},Ce[Dt]={Type:Uint32Array,size:12,setter:dr,cols:3},Ce[qt]={Type:Uint32Array,size:16,setter:$r,cols:4},Ce[me]={Type:Uint32Array,size:4,setter:Yn,arraySetter:$n},Ce[fe]={Type:Uint32Array,size:8,setter:Zn,cols:2},Ce[ve]={Type:Uint32Array,size:12,setter:Qn,cols:3},Ce[xe]={Type:Uint32Array,size:16,setter:Kn,cols:4},Ce[he]={Type:Float32Array,size:32,setter:ir,rows:2,cols:2},Ce[Ee]={Type:Float32Array,size:48,setter:Et,rows:3,cols:3},Ce[ze]={Type:Float32Array,size:64,setter:Jn,rows:4,cols:4},Ce[De]={Type:Float32Array,size:32,setter:ei,rows:2,cols:3},Ce[et]={Type:Float32Array,size:32,setter:Ut,rows:2,cols:4},Ce[qe]={Type:Float32Array,size:48,setter:ti,rows:3,cols:2},Ce[Ke]={Type:Float32Array,size:48,setter:Tn,rows:3,cols:4},Ce[Ye]={Type:Float32Array,size:64,setter:Pr,rows:4,cols:2},Ce[rt]={Type:Float32Array,size:64,setter:ji,rows:4,cols:3},Ce[Ze]={Type:null,size:0,setter:At,arraySetter:St,bindPoint:Hr},Ce[je]={Type:null,size:0,setter:At,arraySetter:St,bindPoint:Xr},Ce[He]={Type:null,size:0,setter:At,arraySetter:St,bindPoint:bn},Ce[Fe]={Type:null,size:0,setter:At,arraySetter:St,bindPoint:Hr},Ce[Be]={Type:null,size:0,setter:At,arraySetter:St,bindPoint:qr},Ce[ke]={Type:null,size:0,setter:At,arraySetter:St,bindPoint:qr},Ce[Tt]={Type:null,size:0,setter:At,arraySetter:St,bindPoint:Xr},Ce[Kt]={Type:null,size:0,setter:At,arraySetter:St,bindPoint:Hr},Ce[Jt]={Type:null,size:0,setter:At,arraySetter:St,bindPoint:bn},Ce[yr]={Type:null,size:0,setter:At,arraySetter:St,bindPoint:Xr},Ce[Wr]={Type:null,size:0,setter:At,arraySetter:St,bindPoint:qr},Ce[jr]={Type:null,size:0,setter:At,arraySetter:St,bindPoint:Hr},Ce[Vr]={Type:null,size:0,setter:At,arraySetter:St,bindPoint:bn},Ce[xt]={Type:null,size:0,setter:At,arraySetter:St,bindPoint:Xr},Ce[Li]={Type:null,size:0,setter:At,arraySetter:St,bindPoint:qr};function Zr(s,c){return function(f){if(f.value)switch(s.disableVertexAttribArray(c),f.value.length){case 4:s.vertexAttrib4fv(c,f.value);break;case 3:s.vertexAttrib3fv(c,f.value);break;case 2:s.vertexAttrib2fv(c,f.value);break;case 1:s.vertexAttrib1fv(c,f.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else s.bindBuffer(We,f.buffer),s.enableVertexAttribArray(c),s.vertexAttribPointer(c,f.numComponents||f.size,f.type||w,f.normalize||!1,f.stride||0,f.offset||0),s.vertexAttribDivisor&&s.vertexAttribDivisor(c,f.divisor||0)}}function Lt(s,c){return function(f){if(f.value)if(s.disableVertexAttribArray(c),f.value.length===4)s.vertexAttrib4iv(c,f.value);else throw new Error("The length of an integer constant value must be 4!");else s.bindBuffer(We,f.buffer),s.enableVertexAttribArray(c),s.vertexAttribIPointer(c,f.numComponents||f.size,f.type||Y,f.stride||0,f.offset||0),s.vertexAttribDivisor&&s.vertexAttribDivisor(c,f.divisor||0)}}function Wt(s,c){return function(f){if(f.value)if(s.disableVertexAttribArray(c),f.value.length===4)s.vertexAttrib4uiv(c,f.value);else throw new Error("The length of an unsigned integer constant value must be 4!");else s.bindBuffer(We,f.buffer),s.enableVertexAttribArray(c),s.vertexAttribIPointer(c,f.numComponents||f.size,f.type||dt,f.stride||0,f.offset||0),s.vertexAttribDivisor&&s.vertexAttribDivisor(c,f.divisor||0)}}function ar(s,c,f){var F=f.size,P=f.count;return function(O){s.bindBuffer(We,O.buffer);for(var j=O.size||O.numComponents||F,W=j/P,$=O.type||w,H=Ce[$],te=H.size*j,ye=O.normalize||!1,Te=O.offset||0,_e=te/P,Pe=0;Pe<P;++Pe)s.enableVertexAttribArray(c+Pe),s.vertexAttribPointer(c+Pe,W,$,ye,te,Te+_e*Pe),s.vertexAttribDivisor&&s.vertexAttribDivisor(c+Pe,O.divisor||0)}}var it={};it[w]={size:4,setter:Zr},it[B]={size:8,setter:Zr},it[k]={size:12,setter:Zr},it[q]={size:16,setter:Zr},it[Y]={size:4,setter:Lt},it[ie]={size:8,setter:Lt},it[se]={size:12,setter:Lt},it[ue]={size:16,setter:Lt},it[dt]={size:4,setter:Wt},it[Ct]={size:8,setter:Wt},it[Dt]={size:12,setter:Wt},it[qt]={size:16,setter:Wt},it[me]={size:4,setter:Lt},it[fe]={size:8,setter:Lt},it[ve]={size:12,setter:Lt},it[xe]={size:16,setter:Lt},it[he]={size:4,setter:ar,count:2},it[Ee]={size:9,setter:ar,count:3},it[ze]={size:16,setter:ar,count:4};var sr=/ERROR:\s*\d+:(\d+)/gi;function tr(s){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,F=st(c.matchAll(sr)),P=new Map(F.map(function(O,j){var W=parseInt(O[1]),$=F[j+1],H=$?$.index:c.length,te=c.substring(O.index,H);return[W-1,te]}));return s.split(`
`).map(function(O,j){var W=P.get(j);return"".concat(j+1+f,": ").concat(O).concat(W?`

^^^ `.concat(W):"")}).join(`
`)}var En=/^[ \t]*\n/;function _t(s){var c=0;return En.test(s)&&(c=1,s=s.replace(En,"")),{lineOffset:c,shaderSource:s}}function Qr(s,c){return s.errorCallback(c),s.callback&&setTimeout(function(){s.callback("".concat(c,`
`).concat(s.errors.join(`
`)))}),null}function Kr(s,c,f,F){F=F||D;var P=s.getShaderParameter(f,yt);if(!P){var O=s.getShaderInfoLog(f),j=_t(s.getShaderSource(f)),W=j.lineOffset,$=j.shaderSource,H="".concat(tr($,O,W),`
Error compiling `).concat(d.glEnumToString(s,c),": ").concat(O);return F(H),H}return""}function or(s,c,f){var F,P,O;if(typeof c=="function"&&(f=c,c=void 0),typeof s=="function")f=s,s=void 0;else if(s&&!Array.isArray(s)){var j=s;f=j.errorCallback,s=j.attribLocations,F=j.transformFeedbackVaryings,P=j.transformFeedbackMode,O=j.callback}var W=f||D,$=[],H={errorCallback:function(Te){$.push(Te);for(var _e=arguments.length,Pe=new Array(_e>1?_e-1:0),Ue=1;Ue<_e;Ue++)Pe[Ue-1]=arguments[Ue];W.apply(void 0,[Te].concat(Pe))},transformFeedbackVaryings:F,transformFeedbackMode:P,callback:O,errors:$};{var te={};Array.isArray(s)?s.forEach(function(ye,Te){te[ye]=c?c[Te]:Te}):te=s||{},H.attribLocations=te}return H}var ur=["VERTEX_SHADER","FRAGMENT_SHADER"];function ri(s,c){if(c.indexOf("frag")>=0)return vt;if(c.indexOf("vert")>=0)return Ft}function ni(s,c,f){var F=s.getAttachedShaders(c),P=at(F),O;try{for(P.s();!(O=P.n()).done;){var j=O.value;f.has(j)&&s.deleteShader(j)}}catch(W){P.e(W)}finally{P.f()}s.deleteProgram(c)}var ii=function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return new Promise(function(f){return setTimeout(f,c)})};function ai(s,c,f){for(var F=s.createProgram(),P=or(f),O=P.attribLocations,j=P.transformFeedbackVaryings,W=P.transformFeedbackMode,$=0;$<c.length;++$){var H=c[$];if(typeof H=="string"){var te=we(H),ye=te?te.text:H,Te=s[ur[$]];te&&te.type&&(Te=ri(s,te.type)||Te),H=s.createShader(Te),s.shaderSource(H,_t(ye).shaderSource),s.compileShader(H),s.attachShader(F,H)}}Object.entries(O).forEach(function(Pe){var Ue=ne(Pe,2),Oe=Ue[0],Ve=Ue[1];return s.bindAttribLocation(F,Ve,Oe)});{var _e=j;_e&&(_e.attribs&&(_e=_e.attribs),Array.isArray(_e)||(_e=Object.keys(_e)),s.transformFeedbackVaryings(F,_e,W||de))}return s.linkProgram(F),F}function Nr(s,c,f,F,P){var O=or(f,F,P),j=new Set(c),W=ai(s,c,O);function $(H,te){var ye=An(H,te,O.errorCallback);return ye&&ni(H,te,j),ye}if(O.callback){_n(s,W).then(function(){var H=$(s,W);O.callback(H,H?void 0:W)});return}return $(s,W)?void 0:W}function cr(s){return function(c,f){for(var F=arguments.length,P=new Array(F>2?F-2:0),O=2;O<F;O++)P[O-2]=arguments[O];return new Promise(function(j,W){var $=or.apply(void 0,P);$.callback=function(H,te){H?W(H):j(te)},s(c,f,$)})}}i.createProgramAsync=cr(Nr),i.createProgramInfoAsync=cr(T);function _n(s,c){return wn.apply(this,arguments)}function wn(){return wn=X(R().mark(function s(c,f){var F,P,O;return R().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:F=c.getExtension("KHR_parallel_shader_compile"),P=F?function($,H){return $.getProgramParameter(H,F.COMPLETION_STATUS_KHR)}:function(){return!0},O=0;case 3:return W.next=5,ii(O);case 5:O=16.666666666666668;case 6:if(!P(c,f)){W.next=3;break}case 7:case"end":return W.stop()}},s)})),wn.apply(this,arguments)}function pr(s,c){return Jr.apply(this,arguments)}function Jr(){return Jr=X(R().mark(function s(c,f){var F,P,O;return R().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:F=0,P=Object.values(f);case 1:if(!(F<P.length)){W.next=8;break}return O=P[F],W.next=5,_n(c,O);case 5:F++,W.next=1;break;case 8:case"end":return W.stop()}},s)})),Jr.apply(this,arguments)}function An(s,c,f){f=f||D;var F=s.getProgramParameter(c,lt);if(!F){var P=s.getProgramInfoLog(c);f("Error in program linking: ".concat(P));var O=s.getAttachedShaders(c),j=O.map(function(W){return Kr(s,s.getShaderParameter(W,s.SHADER_TYPE),W,f)});return"".concat(P,`
`).concat(j.filter(function(W){return W}).join(`
`))}}function Sn(s,c,f,F,P){var O=or(f,F,P),j=[],W=at(c),$;try{for(W.s();!($=W.n()).done;){var H=$.value,te=we(H);if(!te)return Qr(O,"unknown script element: ".concat(H));j.push(te.text)}}catch(ye){W.e(ye)}finally{W.f()}return Nr(s,j,O)}function Mn(s,c,f,F,P){return Nr(s,c,f,F,P)}function Fn(s){var c=s.name;return c.startsWith("gl_")||c.startsWith("webgl_")}var Vi=/(\.|\[|]|\w+)/g,Hi=function(c){return c>="0"&&c<="9"};function Dr(s,c,f,F){for(var P=s.split(Vi).filter(function(Pe){return Pe!==""}),O=0,j="";;){var W=P[O++];j+=W;var $=Hi(W[0]),H=$?parseInt(W):W;$&&(j+=P[O++]);var te=O===P.length;if(te){f[H]=c;break}else{var ye=P[O++],Te=ye==="[",_e=f[H]||(Te?[]:{});f[H]=_e,f=_e,F[j]=F[j]||function(Pe){return function(Ue){ui(Pe,Ue)}}(_e),j+=ye}}}function vr(s,c){var f=0;function F(Te,_e,Pe){var Ue=_e.name.endsWith("[0]"),Oe=_e.type,Ve=Ce[Oe];if(!Ve)throw new Error("unknown type: 0x".concat(Oe.toString(16)));var Qe;if(Ve.bindPoint){var ft=f;f+=_e.size,Ue?Qe=Ve.arraySetter(s,Oe,ft,Pe,_e.size):Qe=Ve.setter(s,Oe,ft,Pe,_e.size)}else Ve.arraySetter&&Ue?Qe=Ve.arraySetter(s,Pe):Qe=Ve.setter(s,Pe);return Qe.location=Pe,Qe}for(var P={},O={},j=s.getProgramParameter(c,o),W=0;W<j;++W){var $=s.getActiveUniform(c,W);if(!Fn($)){var H=$.name;H.endsWith("[0]")&&(H=H.substr(0,H.length-3));var te=s.getUniformLocation(c,$.name);if(te){var ye=F(c,$,te);P[H]=ye,Dr(H,ye,O,P)}}}return P}function en(s,c){for(var f={},F=s.getProgramParameter(c,x),P=0;P<F;++P){var O=s.getTransformFeedbackVarying(c,P);f[O.name]={index:P,type:O.type,size:O.size}}return f}function tn(s,c,f){c.transformFeedbackInfo&&(c=c.transformFeedbackInfo),f.attribs&&(f=f.attribs);for(var F in f){var P=c[F];if(P){var O=f[F];O.offset?s.bindBufferRange(mt,P.index,O.buffer,O.offset,O.size):s.bindBufferBase(mt,P.index,O.buffer)}}}function Cn(s,c,f){var F=s.createTransformFeedback();return s.bindTransformFeedback(Mt,F),s.useProgram(c.program),tn(s,c,f),s.bindTransformFeedback(Mt,null),F}function hr(s,c){for(var f=s.getProgramParameter(c,o),F=[],P=[],O=0;O<f;++O){P.push(O),F.push({});var j=s.getActiveUniform(c,O);F[O].name=j.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach(function(Te){var _e=Te[0],Pe=Te[1];s.getActiveUniforms(c,P,s[_e]).forEach(function(Ue,Oe){F[Oe][Pe]=Ue})});for(var W={},$=s.getProgramParameter(c,I),H=0;H<$;++H){var te=s.getActiveUniformBlockName(c,H),ye={index:s.getUniformBlockIndex(c,te),usedByVertexShader:s.getActiveUniformBlockParameter(c,H,E),usedByFragmentShader:s.getActiveUniformBlockParameter(c,H,y),size:s.getActiveUniformBlockParameter(c,H,m),uniformIndices:s.getActiveUniformBlockParameter(c,H,A)};ye.used=ye.usedByVertexShader||ye.usedByFragmentShader,W[te]=ye}return{blockSpecs:W,uniformData:F}}var si=/\[\d+\]\.$/,Xi=function(c,f){return((c+(f-1))/f|0)*f};function qi(s,c,f,F){if(c||f){F=F||1;var P=s.length,O=P/4;return function(j){for(var W=0,$=0,H=0;H<O;++H){for(var te=0;te<F;++te)s[W++]=j[$++];W+=4-F}}}else return function(j){j.length?s.set(j):s[0]=j}}function Rn(s,c,f,F){var P=f.blockSpecs,O=f.uniformData,j=P[F];if(!j)return be("no uniform block object named:",F),{name:F,uniforms:{}};var W=new ArrayBuffer(j.size),$=s.createBuffer(),H=j.index;s.bindBuffer($e,$),s.uniformBlockBinding(c,j.index,H);var te=F+".";si.test(te)&&(te=te.replace(si,"."));var ye={},Te={},_e={};return j.uniformIndices.forEach(function(Pe){var Ue=O[Pe],Oe=Ue.name;Oe.startsWith(te)&&(Oe=Oe.substr(te.length));var Ve=Oe.endsWith("[0]");Ve&&(Oe=Oe.substr(0,Oe.length-3));var Qe=Ce[Ue.type],ft=Qe.Type,bt=Ve?Xi(Qe.size,16)*Ue.size:Qe.size*Ue.size,It=new ft(W,Ue.offset,bt/ft.BYTES_PER_ELEMENT);ye[Oe]=It;var Yt=qi(It,Ve,Qe.rows,Qe.cols);Te[Oe]=Yt,Dr(Oe,Yt,_e,Te)}),{name:F,array:W,asFloat:new Float32Array(W),buffer:$,uniforms:ye,setters:Te}}function Pn(s,c,f){return Rn(s,c.program,c.uniformBlockSpec,f)}function rn(s,c,f){var F=c.uniformBlockSpec||c,P=F.blockSpecs[f.name];if(P){var O=P.index;return s.bindBufferRange($e,O,f.buffer,f.offset||0,f.array.byteLength),!0}return!1}function oi(s,c,f){rn(s,c,f)&&s.bufferData($e,f.array,Ge)}function Yi(s,c){var f=s.setters;for(var F in c){var P=f[F];if(P){var O=c[F];P(O)}}}function ui(s,c){for(var f in c){var F=s[f];typeof F=="function"?F(c[f]):ui(s[f],c[f])}}function nn(s){for(var c=s.uniformSetters||s,f=arguments.length<=1?0:arguments.length-1,F=0;F<f;++F){var P=F+1<1||arguments.length<=F+1?void 0:arguments[F+1];if(Array.isArray(P))for(var O=P.length,j=0;j<O;++j)nn(c,P[j]);else for(var W in P){var $=c[W];$&&$(P[W])}}}i.setUniformsAndBindTextures=nn;function Nn(s,c){for(var f={},F=s.getProgramParameter(c,p),P=0;P<F;++P){var O=s.getActiveAttrib(c,P);if(!Fn(O)){var j=s.getAttribLocation(c,O.name),W=it[O.type],$=W.setter(s,j,W);$.location=j,f[O.name]=$}}return f}function Dn(s,c){for(var f in c){var F=s[f];F&&F(c[f])}}function $i(s,c,f){f.vertexArrayObject?s.bindVertexArray(f.vertexArrayObject):(Dn(c.attribSetters||c,f.attribs),f.indices&&s.bindBuffer(tt,f.indices))}function an(s,c){var f=vr(s,c),F=Nn(s,c),P={program:c,uniformSetters:f,attribSetters:F};return d.isWebGL2(s)&&(P.uniformBlockSpec=hr(s,c),P.transformFeedbackInfo=en(s,c)),P}var Zi=/\s|{|}|;/;function T(s,c,f,F,P){var O=or(f,F,P),j=[];if(c=c.map(function(H){if(!Zi.test(H)){var te=we(H);if(te)H=te.text;else{var ye="no element with id: ".concat(H);O.errorCallback(ye),j.push(ye)}}return H}),j.length)return Qr(O,"");var W=O.callback;W&&(O.callback=function(H,te){W(H,H?void 0:an(s,te))});var $=Mn(s,c,O);return $?an(s,$):null}function S(s,c,f,F,P){for(var O=0,j=Object.entries(c);O<j.length;O++){var W=ne(j[O],2),$=W[0],H=W[1],te=ee({},P),ye=f[$];Array.isArray(ye)||Object.assign(te,ye);var Te=An(s,H,te.errorCallback);if(Te){for(var _e=0,Pe=Object.values(c);_e<Pe.length;_e++){var Ue=Pe[_e],Oe=s.getAttachedShaders(Ue);s.deleteProgram(Ue);var Ve=at(Oe),Qe;try{for(Ve.s();!(Qe=Ve.n()).done;){var ft=Qe.value;F.has(ft)||s.deleteShader(ft)}}catch(bt){Ve.e(bt)}finally{Ve.f()}}return Te}}}function M(s,c){var f=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},F=new Set,P=Object.fromEntries(Object.entries(c).map(function(j){var W=ne(j,2),$=W[0],H=W[1],te=ee({},f),ye=Array.isArray(H)?H:H.shaders;return Array.isArray(H)||Object.assign(te,H),ye.forEach(F.add,F),[$,ai(s,ye,te)]}));if(f.callback){pr(s,P).then(function(){var j=S(s,P,c,F,f);f.callback(j,j?void 0:P)});return}var O=S(s,P,c,F,f);return O?void 0:P}function L(s,c,f){f=or(f);function F(j,W){return Object.fromEntries(Object.entries(W).map(function($){var H=ne($,2),te=H[0],ye=H[1];return[te,an(j,ye)]}))}var P=f.callback;P&&(f.callback=function(j,W){P(j,j?void 0:F(s,W))});var O=M(s,c,f);if(!(P||!O))return F(s,O)}i.createProgramsAsync=cr(M),i.createProgramInfosAsync=cr(L)},"./src/textures.js":(h,i,u)=>{function v(T){"@babel/helpers - typeof";return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S},v(T)}i.__esModule=!0,i.canFilter=ii,i.canGenerateMipmap=ni,i.createSampler=Fn,i.createSamplers=Vi,i.createTexture=Dn,i.createTextures=Zi,i.getBytesPerElementForInternalFormat=or,i.getFormatAndTypeForInternalFormat=ur,i.getNumComponentsForFormat=ai,i.loadTextureFromUrl=oi,i.resizeTexture=$i,i.setDefaultTextureColor=_n,i.setEmptyTexture=Nn,i.setSamplerParameters=Mn,i.setTextureDefaults_=wn,i.setTextureFilteringForSize=Dr,i.setTextureFromArray=nn,i.setTextureFromElement=Cn,i.setTextureParameters=Sn;var d=R(u("./src/utils.js")),g=R(u("./src/typedarrays.js")),_=R(u("./src/helper.js"));function b(T){if(typeof WeakMap!="function")return null;var S=new WeakMap,M=new WeakMap;return(b=function(s){return s?M:S})(T)}function R(T,S){if(!S&&T&&T.__esModule)return T;if(T===null||v(T)!="object"&&typeof T!="function")return{default:T};var M=b(S);if(M&&M.has(T))return M.get(T);var L={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in T)if(c!=="default"&&Object.prototype.hasOwnProperty.call(T,c)){var f=s?Object.getOwnPropertyDescriptor(T,c):null;f&&(f.get||f.set)?Object.defineProperty(L,c,f):L[c]=T[c]}return L.default=T,M&&M.set(T,L),L}var U={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},ee=g.isArrayBuffer,C=function(){var T;return function(){return T=T||(typeof document<"u"&&document.createElement?document.createElement("canvas").getContext("2d"):null),T}}(),K=6406,J=6407,z=6408,X=6409,ne=6410,ae=6402,Ne=34041,Ae=33071,at=9728,st=9729,Xe=3553,ge=34067,G=32879,V=35866,Q=34069,D=34070,be=34071,we=34072,Se=34073,Ge=34074,We=10241,tt=10240,$e=10242,mt=10243,Mt=32882,yt=33082,lt=33083,vt=33084,Ft=33085,de=34892,o=34893,p=3317,x=3314,I=32878,E=3316,y=3315,m=32877,A=37443,w=37441,B=37440,k=33321,q=36756,Y=33325,ie=33326,se=33330,ue=33329,me=33338,fe=33337,ve=33340,xe=33339,he=33323,Ee=36757,ze=33327,Ze=33328,je=33336,He=33335,Fe=33332,De=33331,et=33334,qe=33333,Ke=32849,Ye=35905,rt=36194,Be=36758,ke=35898,Tt=35901,dt=34843,Ct=34837,Dt=36221,qt=36239,Kt=36215,Jt=36233,yr=36209,Wr=36227,jr=32856,Vr=35907,xt=36759,Li=32855,Hr=32854,Xr=32857,bn=34842,qr=34836,Ce=36220,qn=36238,zi=36975,Ui=36214,ki=36232,Gi=36226,Wi=36208,Yn=33189,$n=33190,Zn=36012,Qn=36013,Kn=35056,er=5120,ot=5121,Yr=5122,dr=5123,$r=5124,ir=5125,Et=5126,Jn=32819,ei=32820,ti=33635,Ut=5131,Pr=36193,Tn=33640,ji=35899,At=35902,St=36269,Zr=34042,Lt=33319,Wt=33320,ar=6403,it=36244,sr=36248,tr=36249,En={};{var _t=En;_t[K]={numColorComponents:1},_t[X]={numColorComponents:1},_t[ne]={numColorComponents:2},_t[J]={numColorComponents:3},_t[z]={numColorComponents:4},_t[ar]={numColorComponents:1},_t[it]={numColorComponents:1},_t[Lt]={numColorComponents:2},_t[Wt]={numColorComponents:2},_t[J]={numColorComponents:3},_t[sr]={numColorComponents:3},_t[z]={numColorComponents:4},_t[tr]={numColorComponents:4},_t[ae]={numColorComponents:1},_t[Ne]={numColorComponents:2}}var Qr;function Kr(T){if(!Qr){var S={};S[K]={textureFormat:K,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[ot,Ut,Pr,Et]},S[X]={textureFormat:X,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[ot,Ut,Pr,Et]},S[ne]={textureFormat:ne,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[ot,Ut,Pr,Et]},S[J]={textureFormat:J,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[ot,Ut,Pr,Et,ti]},S[z]={textureFormat:z,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[ot,Ut,Pr,Et,Jn,ei]},S[ae]={textureFormat:ae,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[ir,dr]},S[k]={textureFormat:ar,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1],type:[ot]},S[q]={textureFormat:ar,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[1],type:[er]},S[Y]={textureFormat:ar,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[Et,Ut]},S[ie]={textureFormat:ar,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[4],type:[Et]},S[se]={textureFormat:it,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[ot]},S[ue]={textureFormat:it,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[er]},S[Fe]={textureFormat:it,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[dr]},S[De]={textureFormat:it,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[Yr]},S[et]={textureFormat:it,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ir]},S[qe]={textureFormat:it,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[$r]},S[he]={textureFormat:Lt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2],type:[ot]},S[Ee]={textureFormat:Lt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[2],type:[er]},S[ze]={textureFormat:Lt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[Et,Ut]},S[Ze]={textureFormat:Lt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[8],type:[Et]},S[je]={textureFormat:Wt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[ot]},S[He]={textureFormat:Wt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[er]},S[me]={textureFormat:Wt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[dr]},S[fe]={textureFormat:Wt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Yr]},S[ve]={textureFormat:Wt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[ir]},S[xe]={textureFormat:Wt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[$r]},S[Ke]={textureFormat:J,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3],type:[ot]},S[Ye]={textureFormat:J,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[ot]},S[rt]={textureFormat:J,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[ot,ti]},S[Be]={textureFormat:J,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[er]},S[ke]={textureFormat:J,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[Et,Ut,ji]},S[Tt]={textureFormat:J,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[Et,Ut,At]},S[dt]={textureFormat:J,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[Et,Ut]},S[Ct]={textureFormat:J,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[Et]},S[Dt]={textureFormat:sr,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[ot]},S[qt]={textureFormat:sr,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[er]},S[Kt]={textureFormat:sr,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[dr]},S[Jt]={textureFormat:sr,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[Yr]},S[yr]={textureFormat:sr,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[ir]},S[Wr]={textureFormat:sr,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[$r]},S[jr]={textureFormat:z,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[ot]},S[Vr]={textureFormat:z,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[ot]},S[xt]={textureFormat:z,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4],type:[er]},S[Li]={textureFormat:z,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[ot,ei,Tn]},S[Hr]={textureFormat:z,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[ot,Jn]},S[Xr]={textureFormat:z,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[Tn]},S[bn]={textureFormat:z,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[Et,Ut]},S[qr]={textureFormat:z,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[16],type:[Et]},S[Ce]={textureFormat:tr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ot]},S[qn]={textureFormat:tr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[er]},S[zi]={textureFormat:tr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Tn]},S[Ui]={textureFormat:tr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[dr]},S[ki]={textureFormat:tr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[Yr]},S[Gi]={textureFormat:tr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[$r]},S[Wi]={textureFormat:tr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[ir]},S[Yn]={textureFormat:ae,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[dr,ir]},S[$n]={textureFormat:ae,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ir]},S[Zn]={textureFormat:ae,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Et]},S[Kn]={textureFormat:Ne,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Zr]},S[Qn]={textureFormat:Ne,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[St]},Object.keys(S).forEach(function(M){var L=S[M];L.bytesPerElementMap={},L.bytesPerElement.forEach(function(s,c){var f=L.type[c];L.bytesPerElementMap[f]=s})}),Qr=S}return Qr[T]}function or(T,S){var M=Kr(T);if(!M)throw"unknown internal format";var L=M.bytesPerElementMap[S];if(L===void 0)throw"unknown internal format";return L}function ur(T){var S=Kr(T);if(!S)throw"unknown internal format";return{format:S.textureFormat,type:S.type[0]}}function ri(T){return(T&T-1)===0}function ni(T,S,M,L){if(!d.isWebGL2(T))return ri(S)&&ri(M);var s=Kr(L);if(!s)throw"unknown internal format";return s.colorRenderable&&s.textureFilterable}function ii(T){var S=Kr(T);if(!S)throw"unknown internal format";return S.textureFilterable}function ai(T){var S=En[T];if(!S)throw"unknown format: "+T;return S.numColorComponents}function Nr(T,S,M){return ee(S)?g.getGLTypeForTypedArray(S):M||ot}function cr(T,S,M,L,s){if(s%1!==0)throw"can't guess dimensions";if(!M&&!L){var c=Math.sqrt(s/(S===ge?6:1));c%1===0?(M=c,L=c):(M=s,L=1)}else if(L){if(!M&&(M=s/L,M%1))throw"can't guess dimensions"}else if(L=s/M,L%1)throw"can't guess dimensions";return{width:M,height:L}}function _n(T){U.textureColor=new Uint8Array([T[0]*255,T[1]*255,T[2]*255,T[3]*255])}function wn(T){_.copyExistingProperties(T,U),T.textureColor&&_n(T.textureColor)}function pr(T,S){S.colorspaceConversion!==void 0&&T.pixelStorei(A,S.colorspaceConversion),S.premultiplyAlpha!==void 0&&T.pixelStorei(w,S.premultiplyAlpha),S.flipY!==void 0&&T.pixelStorei(B,S.flipY)}function Jr(T){T.pixelStorei(p,4),d.isWebGL2(T)&&(T.pixelStorei(x,0),T.pixelStorei(I,0),T.pixelStorei(E,0),T.pixelStorei(y,0),T.pixelStorei(m,0))}function An(T,S,M,L){L.minMag&&(M.call(T,S,We,L.minMag),M.call(T,S,tt,L.minMag)),L.min&&M.call(T,S,We,L.min),L.mag&&M.call(T,S,tt,L.mag),L.wrap&&(M.call(T,S,$e,L.wrap),M.call(T,S,mt,L.wrap),(S===G||_.isSampler(T,S))&&M.call(T,S,Mt,L.wrap)),L.wrapR&&M.call(T,S,Mt,L.wrapR),L.wrapS&&M.call(T,S,$e,L.wrapS),L.wrapT&&M.call(T,S,mt,L.wrapT),L.minLod!==void 0&&M.call(T,S,yt,L.minLod),L.maxLod!==void 0&&M.call(T,S,lt,L.maxLod),L.baseLevel!==void 0&&M.call(T,S,vt,L.baseLevel),L.maxLevel!==void 0&&M.call(T,S,Ft,L.maxLevel),L.compareFunc!==void 0&&M.call(T,S,o,L.compareFunc),L.compareMode!==void 0&&M.call(T,S,de,L.compareMode)}function Sn(T,S,M){var L=M.target||Xe;T.bindTexture(L,S),An(T,L,T.texParameteri,M)}function Mn(T,S,M){An(T,S,T.samplerParameteri,M)}function Fn(T,S){var M=T.createSampler();return Mn(T,M,S),M}function Vi(T,S){var M={};return Object.keys(S).forEach(function(L){M[L]=Fn(T,S[L])}),M}function Hi(T){return T=T||U.textureColor,ee(T)?T:new Uint8Array([T[0]*255,T[1]*255,T[2]*255,T[3]*255])}function Dr(T,S,M,L,s,c){M=M||U.textureOptions,c=c||z;var f=M.target||Xe;if(L=L||M.width,s=s||M.height,T.bindTexture(f,S),ni(T,L,s,c))T.generateMipmap(f);else{var F=ii(c)?st:at;T.texParameteri(f,We,F),T.texParameteri(f,tt,F),T.texParameteri(f,$e,Ae),T.texParameteri(f,mt,Ae)}}function vr(T){return T.auto===!0||T.auto===void 0&&T.level===void 0}function en(T,S){return S=S||{},S.cubeFaceOrder||[Q,D,be,we,Se,Ge]}function tn(T,S){var M=en(T,S),L=M.map(function(s,c){return{face:s,ndx:c}});return L.sort(function(s,c){return s.face-c.face}),L}function Cn(T,S,M,L){L=L||U.textureOptions;var s=L.target||Xe,c=L.level||0,f=M.width,F=M.height,P=L.internalFormat||L.format||z,O=ur(P),j=L.format||O.format,W=L.type||O.type;if(pr(T,L),T.bindTexture(s,S),s===ge){var $=M.width,H=M.height,te,ye;if($/6===H)te=H,ye=[0,0,1,0,2,0,3,0,4,0,5,0];else if(H/6===$)te=$,ye=[0,0,0,1,0,2,0,3,0,4,0,5];else if($/3===H/2)te=$/3,ye=[0,0,1,0,2,0,0,1,1,1,2,1];else if($/2===H/3)te=$/2,ye=[0,0,1,0,0,1,1,1,0,2,1,2];else throw"can't figure out cube map from element: "+(M.src?M.src:M.nodeName);var Te=C();Te?(Te.canvas.width=te,Te.canvas.height=te,f=te,F=te,tn(T,L).forEach(function(It){var Yt=ye[It.ndx*2+0]*te,rr=ye[It.ndx*2+1]*te;Te.drawImage(M,Yt,rr,te,te,0,0,te,te),T.texImage2D(It.face,c,P,j,W,Te.canvas)}),Te.canvas.width=1,Te.canvas.height=1):typeof createImageBitmap<"u"&&(f=te,F=te,tn(T,L).forEach(function(It){var Yt=ye[It.ndx*2+0]*te,rr=ye[It.ndx*2+1]*te;T.texImage2D(It.face,c,P,te,te,0,j,W,null),createImageBitmap(M,Yt,rr,te,te,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then(function(ci){pr(T,L),T.bindTexture(s,S),T.texImage2D(It.face,c,P,j,W,ci),vr(L)&&Dr(T,S,L,f,F,P)})}))}else if(s===G||s===V){var _e=Math.min(M.width,M.height),Pe=Math.max(M.width,M.height),Ue=Pe/_e;if(Ue%1!==0)throw"can not compute 3D dimensions of element";var Oe=M.width===Pe?1:0,Ve=M.height===Pe?1:0;T.pixelStorei(p,1),T.pixelStorei(x,M.width),T.pixelStorei(I,0),T.pixelStorei(m,0),T.texImage3D(s,c,P,_e,_e,_e,0,j,W,null);for(var Qe=0;Qe<Ue;++Qe){var ft=Qe*_e*Oe,bt=Qe*_e*Ve;T.pixelStorei(E,ft),T.pixelStorei(y,bt),T.texSubImage3D(s,c,0,0,Qe,_e,_e,1,j,W,M)}Jr(T)}else T.texImage2D(s,c,P,j,W,M);vr(L)&&Dr(T,S,L,f,F,P),Sn(T,S,L)}function hr(){}function si(T){if(typeof document<"u"){var S=document.createElement("a");return S.href=T,S.hostname===location.hostname&&S.port===location.port&&S.protocol===location.protocol}else{var M=new URL(location.href).origin,L=new URL(T,location.href).origin;return L===M}}function Xi(T,S){return S===void 0&&!si(T)?"anonymous":S}function qi(T,S,M){M=M||hr;var L;if(S=S!==void 0?S:U.crossOrigin,S=Xi(T,S),typeof Image<"u"){L=new Image,S!==void 0&&(L.crossOrigin=S);var s=function(){L.removeEventListener("error",c),L.removeEventListener("load",f),L=null},c=function(){var $="couldn't load image: "+T;_.error($),M($,L),s()},f=function(){M(null,L),s()};return L.addEventListener("error",c),L.addEventListener("load",f),L.src=T,L}else if(typeof ImageBitmap<"u"){var F,P,O=function(){M(F,P)},j={};S&&(j.mode="cors"),fetch(T,j).then(function(W){if(!W.ok)throw W;return W.blob()}).then(function(W){return createImageBitmap(W,{premultiplyAlpha:"none",colorSpaceConversion:"none"})}).then(function(W){P=W,setTimeout(O)}).catch(function(W){F=W,setTimeout(O)}),L=null}return L}function Rn(T){return typeof ImageBitmap<"u"&&T instanceof ImageBitmap||typeof ImageData<"u"&&T instanceof ImageData||typeof HTMLElement<"u"&&T instanceof HTMLElement}function Pn(T,S,M){return Rn(T)?(setTimeout(function(){M(null,T)}),T):qi(T,S,M)}function rn(T,S,M){M=M||U.textureOptions;var L=M.target||Xe;if(T.bindTexture(L,S),M.color!==!1){var s=Hi(M.color);if(L===ge)for(var c=0;c<6;++c)T.texImage2D(Q+c,0,z,1,1,0,z,ot,s);else L===G||L===V?T.texImage3D(L,0,z,1,1,1,0,z,ot,s):T.texImage2D(L,0,z,1,1,0,z,ot,s)}}function oi(T,S,M,L){L=L||hr,M=M||U.textureOptions,rn(T,S,M),M=Object.assign({},M);var s=Pn(M.src,M.crossOrigin,function(c,f){c?L(c,S,f):(Cn(T,S,f,M),L(null,S,f))});return s}function Yi(T,S,M,L){L=L||hr;var s=M.src;if(s.length!==6)throw"there must be 6 urls for a cubemap";var c=M.level||0,f=M.internalFormat||M.format||z,F=ur(f),P=M.format||F.format,O=M.type||ot,j=M.target||Xe;if(j!==ge)throw"target must be TEXTURE_CUBE_MAP";rn(T,S,M),M=Object.assign({},M);var W=6,$=[],H=en(T,M),te;function ye(Te){return function(_e,Pe){--W,_e?$.push(_e):Pe.width!==Pe.height?$.push("cubemap face img is not a square: "+Pe.src):(pr(T,M),T.bindTexture(j,S),W===5?en().forEach(function(Ue){T.texImage2D(Ue,c,f,P,O,Pe)}):T.texImage2D(Te,c,f,P,O,Pe),vr(M)&&T.generateMipmap(j)),W===0&&L($.length?$:void 0,S,te)}}te=s.map(function(Te,_e){return Pn(Te,M.crossOrigin,ye(H[_e]))})}function ui(T,S,M,L){L=L||hr;var s=M.src,c=M.internalFormat||M.format||z,f=ur(c),F=M.format||f.format,P=M.type||ot,O=M.target||V;if(O!==G&&O!==V)throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY";rn(T,S,M),M=Object.assign({},M);var j=s.length,W=[],$,H=M.level||0,te=M.width,ye=M.height,Te=s.length,_e=!0;function Pe(Ue){return function(Oe,Ve){if(--j,Oe)W.push(Oe);else{if(pr(T,M),T.bindTexture(O,S),_e){_e=!1,te=M.width||Ve.width,ye=M.height||Ve.height,T.texImage3D(O,H,c,te,ye,Te,0,F,P,null);for(var Qe=0;Qe<Te;++Qe)T.texSubImage3D(O,H,0,0,Qe,te,ye,1,F,P,Ve)}else{var ft=Ve,bt;(Ve.width!==te||Ve.height!==ye)&&(bt=C(),ft=bt.canvas,bt.canvas.width=te,bt.canvas.height=ye,bt.drawImage(Ve,0,0,te,ye)),T.texSubImage3D(O,H,0,0,Ue,te,ye,1,F,P,ft),bt&&ft===bt.canvas&&(bt.canvas.width=0,bt.canvas.height=0)}vr(M)&&T.generateMipmap(O)}j===0&&L(W.length?W:void 0,S,$)}}$=s.map(function(Ue,Oe){return Pn(Ue,M.crossOrigin,Pe(Oe))})}function nn(T,S,M,L){L=L||U.textureOptions;var s=L.target||Xe;T.bindTexture(s,S);var c=L.width,f=L.height,F=L.depth,P=L.level||0,O=L.internalFormat||L.format||z,j=ur(O),W=L.format||j.format,$=L.type||Nr(T,M,j.type);if(ee(M))M instanceof Uint8ClampedArray&&(M=new Uint8Array(M.buffer));else{var H=g.getTypedArrayTypeForGLType($);M=new H(M)}var te=or(O,$),ye=M.byteLength/te;if(ye%1)throw"length wrong size for format: "+d.glEnumToString(T,W);var Te;if(s===G||s===V)if(!c&&!f&&!F){var _e=Math.cbrt(ye);if(_e%1!==0)throw"can't guess cube size of array of numElements: "+ye;c=_e,f=_e,F=_e}else c&&(!f||!F)?(Te=cr(T,s,f,F,ye/c),f=Te.width,F=Te.height):f&&(!c||!F)?(Te=cr(T,s,c,F,ye/f),c=Te.width,F=Te.height):(Te=cr(T,s,c,f,ye/F),c=Te.width,f=Te.height);else Te=cr(T,s,c,f,ye),c=Te.width,f=Te.height;if(Jr(T),T.pixelStorei(p,L.unpackAlignment||1),pr(T,L),s===ge){var Pe=te/M.BYTES_PER_ELEMENT,Ue=ye/6*Pe;tn(T,L).forEach(function(Oe){var Ve=Ue*Oe.ndx,Qe=M.subarray(Ve,Ve+Ue);T.texImage2D(Oe.face,P,O,c,f,0,W,$,Qe)})}else s===G||s===V?T.texImage3D(s,P,O,c,f,F,0,W,$,M):T.texImage2D(s,P,O,c,f,0,W,$,M);return{width:c,height:f,depth:F,type:$}}function Nn(T,S,M){var L=M.target||Xe;T.bindTexture(L,S);var s=M.level||0,c=M.internalFormat||M.format||z,f=ur(c),F=M.format||f.format,P=M.type||f.type;if(pr(T,M),L===ge)for(var O=0;O<6;++O)T.texImage2D(Q+O,s,c,M.width,M.height,0,F,P,null);else L===G||L===V?T.texImage3D(L,s,c,M.width,M.height,M.depth,0,F,P,null):T.texImage2D(L,s,c,M.width,M.height,0,F,P,null)}function Dn(T,S,M){M=M||hr,S=S||U.textureOptions;var L=T.createTexture(),s=S.target||Xe,c=S.width||1,f=S.height||1,F=S.internalFormat||z;T.bindTexture(s,L),s===ge&&(T.texParameteri(s,$e,Ae),T.texParameteri(s,mt,Ae));var P=S.src;if(P)if(typeof P=="function"&&(P=P(T,S)),typeof P=="string")oi(T,L,S,M);else if(ee(P)||Array.isArray(P)&&(typeof P[0]=="number"||Array.isArray(P[0])||ee(P[0]))){var O=nn(T,L,P,S);c=O.width,f=O.height}else Array.isArray(P)&&(typeof P[0]=="string"||Rn(P[0]))?s===ge?Yi(T,L,S,M):ui(T,L,S,M):(Cn(T,L,P,S),c=P.width,f=P.height);else Nn(T,L,S);return vr(S)&&Dr(T,L,S,c,f,F),Sn(T,L,S),L}function $i(T,S,M,L,s,c){L=L||M.width,s=s||M.height,c=c||M.depth;var f=M.target||Xe;T.bindTexture(f,S);var F=M.level||0,P=M.internalFormat||M.format||z,O=ur(P),j=M.format||O.format,W,$=M.src;if($&&(ee($)||Array.isArray($)&&typeof $[0]=="number")?W=M.type||Nr(T,$,O.type):W=M.type||O.type,f===ge)for(var H=0;H<6;++H)T.texImage2D(Q+H,F,P,L,s,0,j,W,null);else f===G||f===V?T.texImage3D(f,F,P,L,s,c,0,j,W,null):T.texImage2D(f,F,P,L,s,0,j,W,null)}function an(T){return typeof T=="string"||Array.isArray(T)&&typeof T[0]=="string"}function Zi(T,S,M){M=M||hr;var L=0,s=[],c={},f={};function F(){L===0&&setTimeout(function(){M(s.length?s:void 0,c,f)},0)}return Object.keys(S).forEach(function(P){var O=S[P],j;an(O.src)&&(j=function($,H,te){f[P]=te,--L,$&&s.push($),F()},++L),c[P]=Dn(T,O,j)}),F(),c}},"./src/twgl-full.js":(h,i,u)=>{function v(C){"@babel/helpers - typeof";return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(K){return typeof K}:function(K){return K&&typeof Symbol=="function"&&K.constructor===Symbol&&K!==Symbol.prototype?"symbol":typeof K},v(C)}i.__esModule=!0;var d={m4:!0,v3:!0,primitives:!0};i.v3=i.primitives=i.m4=void 0;var g=ee(u("./src/m4.js"));i.m4=g;var _=ee(u("./src/v3.js"));i.v3=_;var b=ee(u("./src/primitives.js"));i.primitives=b;var R=u("./src/twgl.js");Object.keys(R).forEach(function(C){C==="default"||C==="__esModule"||Object.prototype.hasOwnProperty.call(d,C)||C in i&&i[C]===R[C]||(i[C]=R[C])});function U(C){if(typeof WeakMap!="function")return null;var K=new WeakMap,J=new WeakMap;return(U=function(X){return X?J:K})(C)}function ee(C,K){if(!K&&C&&C.__esModule)return C;if(C===null||v(C)!="object"&&typeof C!="function")return{default:C};var J=U(K);if(J&&J.has(C))return J.get(C);var z={__proto__:null},X=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ne in C)if(ne!=="default"&&Object.prototype.hasOwnProperty.call(C,ne)){var ae=X?Object.getOwnPropertyDescriptor(C,ne):null;ae&&(ae.get||ae.set)?Object.defineProperty(z,ne,ae):z[ne]=C[ne]}return z.default=C,J&&J.set(C,z),z}},"./src/twgl.js":(h,i,u)=>{function v(D){"@babel/helpers - typeof";return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(be){return typeof be}:function(be){return be&&typeof Symbol=="function"&&be.constructor===Symbol&&be!==Symbol.prototype?"symbol":typeof be},v(D)}i.__esModule=!0;var d={addExtensionsToContext:!0,getContext:!0,getWebGLContext:!0,resizeCanvasToDisplaySize:!0,setDefaults:!0,attributes:!0,textures:!0,utils:!0,draw:!0,framebuffers:!0,programs:!0,typedarrays:!0,vertexArrays:!0};i.addExtensionsToContext=st,i.framebuffers=i.draw=i.attributes=void 0,i.getContext=V,i.getWebGLContext=ge,i.programs=void 0,i.resizeCanvasToDisplaySize=Q,i.setDefaults=ae,i.vertexArrays=i.utils=i.typedarrays=i.textures=void 0;var g=X(u("./src/attributes.js"));i.attributes=g,Object.keys(g).forEach(function(D){D==="default"||D==="__esModule"||Object.prototype.hasOwnProperty.call(d,D)||D in i&&i[D]===g[D]||(i[D]=g[D])});var _=X(u("./src/textures.js"));i.textures=_,Object.keys(_).forEach(function(D){D==="default"||D==="__esModule"||Object.prototype.hasOwnProperty.call(d,D)||D in i&&i[D]===_[D]||(i[D]=_[D])});var b=X(u("./src/helper.js")),R=X(u("./src/utils.js"));i.utils=R,Object.keys(R).forEach(function(D){D==="default"||D==="__esModule"||Object.prototype.hasOwnProperty.call(d,D)||D in i&&i[D]===R[D]||(i[D]=R[D])});var U=X(u("./src/draw.js"));i.draw=U,Object.keys(U).forEach(function(D){D==="default"||D==="__esModule"||Object.prototype.hasOwnProperty.call(d,D)||D in i&&i[D]===U[D]||(i[D]=U[D])});var ee=X(u("./src/framebuffers.js"));i.framebuffers=ee,Object.keys(ee).forEach(function(D){D==="default"||D==="__esModule"||Object.prototype.hasOwnProperty.call(d,D)||D in i&&i[D]===ee[D]||(i[D]=ee[D])});var C=X(u("./src/programs.js"));i.programs=C,Object.keys(C).forEach(function(D){D==="default"||D==="__esModule"||Object.prototype.hasOwnProperty.call(d,D)||D in i&&i[D]===C[D]||(i[D]=C[D])});var K=X(u("./src/typedarrays.js"));i.typedarrays=K,Object.keys(K).forEach(function(D){D==="default"||D==="__esModule"||Object.prototype.hasOwnProperty.call(d,D)||D in i&&i[D]===K[D]||(i[D]=K[D])});var J=X(u("./src/vertex-arrays.js"));i.vertexArrays=J,Object.keys(J).forEach(function(D){D==="default"||D==="__esModule"||Object.prototype.hasOwnProperty.call(d,D)||D in i&&i[D]===J[D]||(i[D]=J[D])});function z(D){if(typeof WeakMap!="function")return null;var be=new WeakMap,we=new WeakMap;return(z=function(Ge){return Ge?we:be})(D)}function X(D,be){if(!be&&D&&D.__esModule)return D;if(D===null||v(D)!="object"&&typeof D!="function")return{default:D};var we=z(be);if(we&&we.has(D))return we.get(D);var Se={__proto__:null},Ge=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var We in D)if(We!=="default"&&Object.prototype.hasOwnProperty.call(D,We)){var tt=Ge?Object.getOwnPropertyDescriptor(D,We):null;tt&&(tt.get||tt.set)?Object.defineProperty(Se,We,tt):Se[We]=D[We]}return Se.default=D,we&&we.set(D,Se),Se}var ne={addExtensionsToContext:!0};function ae(D){b.copyExistingProperties(D,ne),g.setAttributeDefaults_(D),_.setTextureDefaults_(D)}var Ne=/^(.*?)_/;function Ae(D,be){R.glEnumToString(D,0);var we=D.getExtension(be);if(we){var Se={},Ge=Ne.exec(be)[1],We="_"+Ge;for(var tt in we){var $e=we[tt],mt=typeof $e=="function",Mt=mt?Ge:We,yt=tt;tt.endsWith(Mt)&&(yt=tt.substring(0,tt.length-Mt.length)),D[yt]!==void 0?!mt&&D[yt]!==$e&&b.warn(yt,D[yt],$e,tt):mt?D[yt]=function(lt){return function(){return lt.apply(we,arguments)}}($e):(D[yt]=$e,Se[yt]=$e)}Se.constructor={name:we.constructor.name},R.glEnumToString(Se,0)}return we}var at=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_depth_texture","WEBGL_draw_buffers"];function st(D){for(var be=0;be<at.length;++be)Ae(D,at[be])}function Xe(D,be){for(var we=["webgl","experimental-webgl"],Se=null,Ge=0;Ge<we.length;++Ge)if(Se=D.getContext(we[Ge],be),Se){ne.addExtensionsToContext&&st(Se);break}return Se}function ge(D,be){var we=Xe(D,be);return we}function G(D,be){for(var we=["webgl2","webgl","experimental-webgl"],Se=null,Ge=0;Ge<we.length;++Ge)if(Se=D.getContext(we[Ge],be),Se){ne.addExtensionsToContext&&st(Se);break}return Se}function V(D,be){var we=G(D,be);return we}function Q(D,be){be=be||1,be=Math.max(0,be);var we=D.clientWidth*be|0,Se=D.clientHeight*be|0;return D.width!==we||D.height!==Se?(D.width=we,D.height=Se,!0):!1}},"./src/typedarrays.js":(h,i)=>{i.__esModule=!0,i.getGLTypeForTypedArray=at,i.getGLTypeForTypedArrayType=st,i.getTypedArrayTypeForGLType=Xe,i.isArrayBuffer=void 0;var u=5120,v=5121,d=5122,g=5123,_=5124,b=5125,R=5126,U=32819,ee=32820,C=33635,K=5131,J=33640,z=35899,X=35902,ne=36269,ae=34042,Ne={};{var Ae=Ne;Ae[u]=Int8Array,Ae[v]=Uint8Array,Ae[d]=Int16Array,Ae[g]=Uint16Array,Ae[_]=Int32Array,Ae[b]=Uint32Array,Ae[R]=Float32Array,Ae[U]=Uint16Array,Ae[ee]=Uint16Array,Ae[C]=Uint16Array,Ae[K]=Uint16Array,Ae[J]=Uint32Array,Ae[z]=Uint32Array,Ae[X]=Uint32Array,Ae[ne]=Uint32Array,Ae[ae]=Uint32Array}function at(ge){if(ge instanceof Int8Array)return u;if(ge instanceof Uint8Array||ge instanceof Uint8ClampedArray)return v;if(ge instanceof Int16Array)return d;if(ge instanceof Uint16Array)return g;if(ge instanceof Int32Array)return _;if(ge instanceof Uint32Array)return b;if(ge instanceof Float32Array)return R;throw new Error("unsupported typed array type")}function st(ge){if(ge===Int8Array)return u;if(ge===Uint8Array||ge===Uint8ClampedArray)return v;if(ge===Int16Array)return d;if(ge===Uint16Array)return g;if(ge===Int32Array)return _;if(ge===Uint32Array)return b;if(ge===Float32Array)return R;throw new Error("unsupported typed array type")}function Xe(ge){var G=Ne[ge];if(!G)throw new Error("unknown gl type");return G}i.isArrayBuffer=typeof SharedArrayBuffer<"u"?function(G){return G&&G.buffer&&(G.buffer instanceof ArrayBuffer||G.buffer instanceof SharedArrayBuffer)}:function(G){return G&&G.buffer&&G.buffer instanceof ArrayBuffer}},"./src/utils.js":(h,i)=>{i.__esModule=!0,i.glEnumToString=void 0,i.isWebGL1=v,i.isWebGL2=u;function u(d){return!!d.texStorage2D}function v(d){return!d.texStorage2D}i.glEnumToString=function(){var d={},g={};function _(b){var R=b.constructor.name;if(!d[R]){for(var U in b)if(typeof b[U]=="number"){var ee=g[b[U]];g[b[U]]=ee?"".concat(ee," | ").concat(U):U}d[R]=!0}}return function(R,U){return _(R),g[U]||(typeof U=="number"?"0x".concat(U.toString(16)):U)}}()},"./src/v3.js":(h,i)=>{i.__esModule=!0,i.add=g,i.copy=st,i.create=d,i.cross=J,i.distance=ae,i.distanceSq=Ne,i.divScalar=K,i.divide=ge,i.dot=z,i.length=X,i.lengthSq=ne,i.lerp=b,i.lerpV=R,i.max=U,i.min=ee,i.mulScalar=C,i.multiply=Xe,i.negate=at,i.normalize=Ae,i.setDefaultType=v,i.subtract=_;var u=Float32Array;function v(G){var V=u;return u=G,V}function d(G,V,Q){var D=new u(3);return G&&(D[0]=G),V&&(D[1]=V),Q&&(D[2]=Q),D}function g(G,V,Q){return Q=Q||new u(3),Q[0]=G[0]+V[0],Q[1]=G[1]+V[1],Q[2]=G[2]+V[2],Q}function _(G,V,Q){return Q=Q||new u(3),Q[0]=G[0]-V[0],Q[1]=G[1]-V[1],Q[2]=G[2]-V[2],Q}function b(G,V,Q,D){return D=D||new u(3),D[0]=G[0]+Q*(V[0]-G[0]),D[1]=G[1]+Q*(V[1]-G[1]),D[2]=G[2]+Q*(V[2]-G[2]),D}function R(G,V,Q,D){return D=D||new u(3),D[0]=G[0]+Q[0]*(V[0]-G[0]),D[1]=G[1]+Q[1]*(V[1]-G[1]),D[2]=G[2]+Q[2]*(V[2]-G[2]),D}function U(G,V,Q){return Q=Q||new u(3),Q[0]=Math.max(G[0],V[0]),Q[1]=Math.max(G[1],V[1]),Q[2]=Math.max(G[2],V[2]),Q}function ee(G,V,Q){return Q=Q||new u(3),Q[0]=Math.min(G[0],V[0]),Q[1]=Math.min(G[1],V[1]),Q[2]=Math.min(G[2],V[2]),Q}function C(G,V,Q){return Q=Q||new u(3),Q[0]=G[0]*V,Q[1]=G[1]*V,Q[2]=G[2]*V,Q}function K(G,V,Q){return Q=Q||new u(3),Q[0]=G[0]/V,Q[1]=G[1]/V,Q[2]=G[2]/V,Q}function J(G,V,Q){Q=Q||new u(3);var D=G[2]*V[0]-G[0]*V[2],be=G[0]*V[1]-G[1]*V[0];return Q[0]=G[1]*V[2]-G[2]*V[1],Q[1]=D,Q[2]=be,Q}function z(G,V){return G[0]*V[0]+G[1]*V[1]+G[2]*V[2]}function X(G){return Math.sqrt(G[0]*G[0]+G[1]*G[1]+G[2]*G[2])}function ne(G){return G[0]*G[0]+G[1]*G[1]+G[2]*G[2]}function ae(G,V){var Q=G[0]-V[0],D=G[1]-V[1],be=G[2]-V[2];return Math.sqrt(Q*Q+D*D+be*be)}function Ne(G,V){var Q=G[0]-V[0],D=G[1]-V[1],be=G[2]-V[2];return Q*Q+D*D+be*be}function Ae(G,V){V=V||new u(3);var Q=G[0]*G[0]+G[1]*G[1]+G[2]*G[2],D=Math.sqrt(Q);return D>1e-5?(V[0]=G[0]/D,V[1]=G[1]/D,V[2]=G[2]/D):(V[0]=0,V[1]=0,V[2]=0),V}function at(G,V){return V=V||new u(3),V[0]=-G[0],V[1]=-G[1],V[2]=-G[2],V}function st(G,V){return V=V||new u(3),V[0]=G[0],V[1]=G[1],V[2]=G[2],V}function Xe(G,V,Q){return Q=Q||new u(3),Q[0]=G[0]*V[0],Q[1]=G[1]*V[1],Q[2]=G[2]*V[2],Q}function ge(G,V,Q){return Q=Q||new u(3),Q[0]=G[0]/V[0],Q[1]=G[1]/V[1],Q[2]=G[2]/V[2],Q}},"./src/vertex-arrays.js":(h,i,u)=>{function v(C){"@babel/helpers - typeof";return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(K){return typeof K}:function(K){return K&&typeof Symbol=="function"&&K.constructor===Symbol&&K!==Symbol.prototype?"symbol":typeof K},v(C)}i.__esModule=!0,i.createVAOAndSetAttributes=U,i.createVAOFromBufferInfo=ee,i.createVertexArrayInfo=R;var d=_(u("./src/programs.js"));function g(C){if(typeof WeakMap!="function")return null;var K=new WeakMap,J=new WeakMap;return(g=function(X){return X?J:K})(C)}function _(C,K){if(!K&&C&&C.__esModule)return C;if(C===null||v(C)!="object"&&typeof C!="function")return{default:C};var J=g(K);if(J&&J.has(C))return J.get(C);var z={__proto__:null},X=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ne in C)if(ne!=="default"&&Object.prototype.hasOwnProperty.call(C,ne)){var ae=X?Object.getOwnPropertyDescriptor(C,ne):null;ae&&(ae.get||ae.set)?Object.defineProperty(z,ne,ae):z[ne]=C[ne]}return z.default=C,J&&J.set(C,z),z}var b=34963;function R(C,K,J){var z=C.createVertexArray();return C.bindVertexArray(z),K.length||(K=[K]),K.forEach(function(X){d.setBuffersAndAttributes(C,X,J)}),C.bindVertexArray(null),{numElements:J.numElements,elementType:J.elementType,vertexArrayObject:z}}function U(C,K,J,z){var X=C.createVertexArray();return C.bindVertexArray(X),d.setAttributes(K,J),z&&C.bindBuffer(b,z),C.bindVertexArray(null),X}function ee(C,K,J){return U(C,K.attribSetters||K,J.attribs,J.indices)}}},r={};function n(h){var i=r[h];if(i!==void 0)return i.exports;var u=r[h]={exports:{}};return t[h](u,u.exports,n),u.exports}var a=n("./src/twgl-full.js");return a})())})(vs);var gr=vs.exports;/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const xs="162",gs=300,ka=1e3,li=1001,Ga=1002,Wa=1003,Qs=1006,Ks=1008,Js=1009,eo=1014,to=1020,ro=1023,ra=1026,ja=1027,bs="",Er="srgb",Aa="srgb-linear",no="display-p3",Ts="display-p3-linear",da="linear",Va="srgb",Ha="rec709",Xa="p3",io=515,fi=2e3,qa=2001;class Sa{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const n=this._listeners[e];if(n!==void 0){const a=n.indexOf(t);a!==-1&&n.splice(a,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const n=r.slice(0);for(let a=0,h=n.length;a<h;a++)n[a].call(this,e);e.target=null}}}const Rt=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Ya=1234567;const Es=Math.PI/180,_s=180/Math.PI;function Di(){const l=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Rt[l&255]+Rt[l>>8&255]+Rt[l>>16&255]+Rt[l>>24&255]+"-"+Rt[e&255]+Rt[e>>8&255]+"-"+Rt[e>>16&15|64]+Rt[e>>24&255]+"-"+Rt[t&63|128]+Rt[t>>8&255]+"-"+Rt[t>>16&255]+Rt[t>>24&255]+Rt[r&255]+Rt[r>>8&255]+Rt[r>>16&255]+Rt[r>>24&255]).toLowerCase()}function Ot(l,e,t){return Math.max(e,Math.min(t,l))}function Ma(l,e){return(l%e+e)%e}function ao(l,e,t,r,n){return r+(l-e)*(n-r)/(t-e)}function so(l,e,t){return l!==e?(t-l)/(e-l):0}function On(l,e,t){return(1-t)*l+t*e}function oo(l,e,t,r){return On(l,e,1-Math.exp(-t*r))}function uo(l,e=1){return e-Math.abs(Ma(l,e*2)-e)}function co(l,e,t){return l<=e?0:l>=t?1:(l=(l-e)/(t-e),l*l*(3-2*l))}function ho(l,e,t){return l<=e?0:l>=t?1:(l=(l-e)/(t-e),l*l*l*(l*(l*6-15)+10))}function lo(l,e){return l+Math.floor(Math.random()*(e-l+1))}function fo(l,e){return l+Math.random()*(e-l)}function mo(l){return l*(.5-Math.random())}function yo(l){l!==void 0&&(Ya=l);let e=Ya+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function po(l){return l*Es}function vo(l){return l*_s}function xo(l){return(l&l-1)===0&&l!==0}function go(l){return Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))}function bo(l){return Math.pow(2,Math.floor(Math.log(l)/Math.LN2))}function To(l,e,t,r,n){const a=Math.cos,h=Math.sin,i=a(t/2),u=h(t/2),v=a((e+r)/2),d=h((e+r)/2),g=a((e-r)/2),_=h((e-r)/2),b=a((r-e)/2),R=h((r-e)/2);switch(n){case"XYX":l.set(i*d,u*g,u*_,i*v);break;case"YZY":l.set(u*_,i*d,u*g,i*v);break;case"ZXZ":l.set(u*g,u*_,i*d,i*v);break;case"XZX":l.set(i*d,u*R,u*b,i*v);break;case"YXY":l.set(u*b,i*d,u*R,i*v);break;case"ZYZ":l.set(u*R,u*b,i*d,i*v);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function Eo(l,e){switch(e.constructor){case Float32Array:return l;case Uint32Array:return l/4294967295;case Uint16Array:return l/65535;case Uint8Array:return l/255;case Int32Array:return Math.max(l/2147483647,-1);case Int16Array:return Math.max(l/32767,-1);case Int8Array:return Math.max(l/127,-1);default:throw new Error("Invalid component type.")}}function _o(l,e){switch(e.constructor){case Float32Array:return l;case Uint32Array:return Math.round(l*4294967295);case Uint16Array:return Math.round(l*65535);case Uint8Array:return Math.round(l*255);case Int32Array:return Math.round(l*2147483647);case Int16Array:return Math.round(l*32767);case Int8Array:return Math.round(l*127);default:throw new Error("Invalid component type.")}}const wo={DEG2RAD:Es,RAD2DEG:_s,generateUUID:Di,clamp:Ot,euclideanModulo:Ma,mapLinear:ao,inverseLerp:so,lerp:On,damp:oo,pingpong:uo,smoothstep:co,smootherstep:ho,randInt:lo,randFloat:fo,randFloatSpread:mo,seededRandom:yo,degToRad:po,radToDeg:vo,isPowerOfTwo:xo,ceilPowerOfTwo:go,floorPowerOfTwo:bo,setQuaternionFromProperEuler:To,normalize:_o,denormalize:Eo};class hn{constructor(e=0,t=0){hn.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6],this.y=n[1]*t+n[4]*r+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Ot(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),n=Math.sin(t),a=this.x-e.x,h=this.y-e.y;return this.x=a*r-h*n+e.x,this.y=a*n+h*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Rr{constructor(e,t,r,n,a,h,i,u,v){Rr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,r,n,a,h,i,u,v)}set(e,t,r,n,a,h,i,u,v){const d=this.elements;return d[0]=e,d[1]=n,d[2]=i,d[3]=t,d[4]=a,d[5]=u,d[6]=r,d[7]=h,d[8]=v,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,n=t.elements,a=this.elements,h=r[0],i=r[3],u=r[6],v=r[1],d=r[4],g=r[7],_=r[2],b=r[5],R=r[8],U=n[0],ee=n[3],C=n[6],K=n[1],J=n[4],z=n[7],X=n[2],ne=n[5],ae=n[8];return a[0]=h*U+i*K+u*X,a[3]=h*ee+i*J+u*ne,a[6]=h*C+i*z+u*ae,a[1]=v*U+d*K+g*X,a[4]=v*ee+d*J+g*ne,a[7]=v*C+d*z+g*ae,a[2]=_*U+b*K+R*X,a[5]=_*ee+b*J+R*ne,a[8]=_*C+b*z+R*ae,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],n=e[2],a=e[3],h=e[4],i=e[5],u=e[6],v=e[7],d=e[8];return t*h*d-t*i*v-r*a*d+r*i*u+n*a*v-n*h*u}invert(){const e=this.elements,t=e[0],r=e[1],n=e[2],a=e[3],h=e[4],i=e[5],u=e[6],v=e[7],d=e[8],g=d*h-i*v,_=i*u-d*a,b=v*a-h*u,R=t*g+r*_+n*b;if(R===0)return this.set(0,0,0,0,0,0,0,0,0);const U=1/R;return e[0]=g*U,e[1]=(n*v-d*r)*U,e[2]=(i*r-n*h)*U,e[3]=_*U,e[4]=(d*t-n*u)*U,e[5]=(n*a-i*t)*U,e[6]=b*U,e[7]=(r*u-v*t)*U,e[8]=(h*t-r*a)*U,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,n,a,h,i){const u=Math.cos(a),v=Math.sin(a);return this.set(r*u,r*v,-r*(u*h+v*i)+h+e,-n*v,n*u,-n*(-v*h+u*i)+i+t,0,0,1),this}scale(e,t){return this.premultiply(na.makeScale(e,t)),this}rotate(e){return this.premultiply(na.makeRotation(-e)),this}translate(e,t){return this.premultiply(na.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let n=0;n<9;n++)if(t[n]!==r[n])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const na=new Rr;function $a(l){return document.createElementNS("http://www.w3.org/1999/xhtml",l)}const Za=new Rr().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),Qa=new Rr().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),mi={[Aa]:{transfer:da,primaries:Ha,toReference:l=>l,fromReference:l=>l},[Er]:{transfer:Va,primaries:Ha,toReference:l=>l.convertSRGBToLinear(),fromReference:l=>l.convertLinearToSRGB()},[Ts]:{transfer:da,primaries:Xa,toReference:l=>l.applyMatrix3(Qa),fromReference:l=>l.applyMatrix3(Za)},[no]:{transfer:Va,primaries:Xa,toReference:l=>l.convertSRGBToLinear().applyMatrix3(Qa),fromReference:l=>l.applyMatrix3(Za).convertLinearToSRGB()}},Ao=new Set([Aa,Ts]),Zt={enabled:!0,_workingColorSpace:Aa,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(l){if(!Ao.has(l))throw new Error(`Unsupported working color space, "${l}".`);this._workingColorSpace=l},convert:function(l,e,t){if(this.enabled===!1||e===t||!e||!t)return l;const r=mi[e].toReference,n=mi[t].fromReference;return n(r(l))},fromWorkingColorSpace:function(l,e){return this.convert(l,this._workingColorSpace,e)},toWorkingColorSpace:function(l,e){return this.convert(l,e,this._workingColorSpace)},getPrimaries:function(l){return mi[l].primaries},getTransfer:function(l){return l===bs?da:mi[l].transfer}};function ln(l){return l<.04045?l*.0773993808:Math.pow(l*.9478672986+.0521327014,2.4)}function ia(l){return l<.0031308?l*12.92:1.055*Math.pow(l,.41666)-.055}let sn;class So{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{sn===void 0&&(sn=$a("canvas")),sn.width=e.width,sn.height=e.height;const r=sn.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=sn}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=$a("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const n=r.getImageData(0,0,e.width,e.height),a=n.data;for(let h=0;h<a.length;h++)a[h]=ln(a[h]/255)*255;return r.putImageData(n,0,0),t}else if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(ln(t[r]/255)*255):t[r]=ln(t[r]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Mo=0;class Fo{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Mo++}),this.uuid=Di(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},n=this.data;if(n!==null){let a;if(Array.isArray(n)){a=[];for(let h=0,i=n.length;h<i;h++)n[h].isDataTexture?a.push(aa(n[h].image)):a.push(aa(n[h]))}else a=aa(n);r.url=a}return t||(e.images[this.uuid]=r),r}}function aa(l){return typeof HTMLImageElement<"u"&&l instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&l instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&l instanceof ImageBitmap?So.getDataURL(l):l.data?{data:Array.from(l.data),width:l.width,height:l.height,type:l.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Co=0;class Cr extends Sa{constructor(e=Cr.DEFAULT_IMAGE,t=Cr.DEFAULT_MAPPING,r=li,n=li,a=Qs,h=Ks,i=ro,u=Js,v=Cr.DEFAULT_ANISOTROPY,d=bs){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Co++}),this.uuid=Di(),this.name="",this.source=new Fo(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=n,this.magFilter=a,this.minFilter=h,this.anisotropy=v,this.format=i,this.internalFormat=null,this.type=u,this.offset=new hn(0,0),this.repeat=new hn(1,1),this.center=new hn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Rr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=d,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==gs)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ka:e.x=e.x-Math.floor(e.x);break;case li:e.x=e.x<0?0:1;break;case Ga:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case ka:e.y=e.y-Math.floor(e.y);break;case li:e.y=e.y<0?0:1;break;case Ga:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}Cr.DEFAULT_IMAGE=null;Cr.DEFAULT_MAPPING=gs;Cr.DEFAULT_ANISOTROPY=1;class Fa{constructor(e=0,t=0,r=0,n=1){Fa.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,n){return this.x=e,this.y=t,this.z=r,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,n=this.z,a=this.w,h=e.elements;return this.x=h[0]*t+h[4]*r+h[8]*n+h[12]*a,this.y=h[1]*t+h[5]*r+h[9]*n+h[13]*a,this.z=h[2]*t+h[6]*r+h[10]*n+h[14]*a,this.w=h[3]*t+h[7]*r+h[11]*n+h[15]*a,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,n,a;const u=e.elements,v=u[0],d=u[4],g=u[8],_=u[1],b=u[5],R=u[9],U=u[2],ee=u[6],C=u[10];if(Math.abs(d-_)<.01&&Math.abs(g-U)<.01&&Math.abs(R-ee)<.01){if(Math.abs(d+_)<.1&&Math.abs(g+U)<.1&&Math.abs(R+ee)<.1&&Math.abs(v+b+C-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const J=(v+1)/2,z=(b+1)/2,X=(C+1)/2,ne=(d+_)/4,ae=(g+U)/4,Ne=(R+ee)/4;return J>z&&J>X?J<.01?(r=0,n=.707106781,a=.707106781):(r=Math.sqrt(J),n=ne/r,a=ae/r):z>X?z<.01?(r=.707106781,n=0,a=.707106781):(n=Math.sqrt(z),r=ne/n,a=Ne/n):X<.01?(r=.707106781,n=.707106781,a=0):(a=Math.sqrt(X),r=ae/a,n=Ne/a),this.set(r,n,a,t),this}let K=Math.sqrt((ee-R)*(ee-R)+(g-U)*(g-U)+(_-d)*(_-d));return Math.abs(K)<.001&&(K=1),this.x=(ee-R)/K,this.y=(g-U)/K,this.z=(_-d)/K,this.w=Math.acos((v+b+C-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Vn{constructor(e=0,t=0,r=0,n=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=n}static slerpFlat(e,t,r,n,a,h,i){let u=r[n+0],v=r[n+1],d=r[n+2],g=r[n+3];const _=a[h+0],b=a[h+1],R=a[h+2],U=a[h+3];if(i===0){e[t+0]=u,e[t+1]=v,e[t+2]=d,e[t+3]=g;return}if(i===1){e[t+0]=_,e[t+1]=b,e[t+2]=R,e[t+3]=U;return}if(g!==U||u!==_||v!==b||d!==R){let ee=1-i;const C=u*_+v*b+d*R+g*U,K=C>=0?1:-1,J=1-C*C;if(J>Number.EPSILON){const X=Math.sqrt(J),ne=Math.atan2(X,C*K);ee=Math.sin(ee*ne)/X,i=Math.sin(i*ne)/X}const z=i*K;if(u=u*ee+_*z,v=v*ee+b*z,d=d*ee+R*z,g=g*ee+U*z,ee===1-i){const X=1/Math.sqrt(u*u+v*v+d*d+g*g);u*=X,v*=X,d*=X,g*=X}}e[t]=u,e[t+1]=v,e[t+2]=d,e[t+3]=g}static multiplyQuaternionsFlat(e,t,r,n,a,h){const i=r[n],u=r[n+1],v=r[n+2],d=r[n+3],g=a[h],_=a[h+1],b=a[h+2],R=a[h+3];return e[t]=i*R+d*g+u*b-v*_,e[t+1]=u*R+d*_+v*g-i*b,e[t+2]=v*R+d*b+i*_-u*g,e[t+3]=d*R-i*g-u*_-v*b,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,n){return this._x=e,this._y=t,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const r=e._x,n=e._y,a=e._z,h=e._order,i=Math.cos,u=Math.sin,v=i(r/2),d=i(n/2),g=i(a/2),_=u(r/2),b=u(n/2),R=u(a/2);switch(h){case"XYZ":this._x=_*d*g+v*b*R,this._y=v*b*g-_*d*R,this._z=v*d*R+_*b*g,this._w=v*d*g-_*b*R;break;case"YXZ":this._x=_*d*g+v*b*R,this._y=v*b*g-_*d*R,this._z=v*d*R-_*b*g,this._w=v*d*g+_*b*R;break;case"ZXY":this._x=_*d*g-v*b*R,this._y=v*b*g+_*d*R,this._z=v*d*R+_*b*g,this._w=v*d*g-_*b*R;break;case"ZYX":this._x=_*d*g-v*b*R,this._y=v*b*g+_*d*R,this._z=v*d*R-_*b*g,this._w=v*d*g+_*b*R;break;case"YZX":this._x=_*d*g+v*b*R,this._y=v*b*g+_*d*R,this._z=v*d*R-_*b*g,this._w=v*d*g-_*b*R;break;case"XZY":this._x=_*d*g-v*b*R,this._y=v*b*g-_*d*R,this._z=v*d*R+_*b*g,this._w=v*d*g+_*b*R;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+h)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],n=t[4],a=t[8],h=t[1],i=t[5],u=t[9],v=t[2],d=t[6],g=t[10],_=r+i+g;if(_>0){const b=.5/Math.sqrt(_+1);this._w=.25/b,this._x=(d-u)*b,this._y=(a-v)*b,this._z=(h-n)*b}else if(r>i&&r>g){const b=2*Math.sqrt(1+r-i-g);this._w=(d-u)/b,this._x=.25*b,this._y=(n+h)/b,this._z=(a+v)/b}else if(i>g){const b=2*Math.sqrt(1+i-r-g);this._w=(a-v)/b,this._x=(n+h)/b,this._y=.25*b,this._z=(u+d)/b}else{const b=2*Math.sqrt(1+g-r-i);this._w=(h-n)/b,this._x=(a+v)/b,this._y=(u+d)/b,this._z=.25*b}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ot(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const n=Math.min(1,t/r);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,n=e._y,a=e._z,h=e._w,i=t._x,u=t._y,v=t._z,d=t._w;return this._x=r*d+h*i+n*v-a*u,this._y=n*d+h*u+a*i-r*v,this._z=a*d+h*v+r*u-n*i,this._w=h*d-r*i-n*u-a*v,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,n=this._y,a=this._z,h=this._w;let i=h*e._w+r*e._x+n*e._y+a*e._z;if(i<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,i=-i):this.copy(e),i>=1)return this._w=h,this._x=r,this._y=n,this._z=a,this;const u=1-i*i;if(u<=Number.EPSILON){const b=1-t;return this._w=b*h+t*this._w,this._x=b*r+t*this._x,this._y=b*n+t*this._y,this._z=b*a+t*this._z,this.normalize(),this}const v=Math.sqrt(u),d=Math.atan2(v,i),g=Math.sin((1-t)*d)/v,_=Math.sin(t*d)/v;return this._w=h*g+this._w*_,this._x=r*g+this._x*_,this._y=n*g+this._y*_,this._z=a*g+this._z*_,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),r=Math.random(),n=Math.sqrt(1-r),a=Math.sqrt(r);return this.set(n*Math.sin(e),n*Math.cos(e),a*Math.sin(t),a*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class gt{constructor(e=0,t=0,r=0){gt.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Ka.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Ka.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,n=this.z,a=e.elements;return this.x=a[0]*t+a[3]*r+a[6]*n,this.y=a[1]*t+a[4]*r+a[7]*n,this.z=a[2]*t+a[5]*r+a[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,n=this.z,a=e.elements,h=1/(a[3]*t+a[7]*r+a[11]*n+a[15]);return this.x=(a[0]*t+a[4]*r+a[8]*n+a[12])*h,this.y=(a[1]*t+a[5]*r+a[9]*n+a[13])*h,this.z=(a[2]*t+a[6]*r+a[10]*n+a[14])*h,this}applyQuaternion(e){const t=this.x,r=this.y,n=this.z,a=e.x,h=e.y,i=e.z,u=e.w,v=2*(h*n-i*r),d=2*(i*t-a*n),g=2*(a*r-h*t);return this.x=t+u*v+h*g-i*d,this.y=r+u*d+i*v-a*g,this.z=n+u*g+a*d-h*v,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,n=this.z,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*n,this.y=a[1]*t+a[5]*r+a[9]*n,this.z=a[2]*t+a[6]*r+a[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,n=e.y,a=e.z,h=t.x,i=t.y,u=t.z;return this.x=n*u-a*i,this.y=a*h-r*u,this.z=r*i-n*h,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return sa.copy(this).projectOnVector(e),this.sub(sa)}reflect(e){return this.sub(sa.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Ot(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return t*t+r*r+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const n=Math.sin(t)*e;return this.x=n*Math.sin(r),this.y=Math.cos(t)*e,this.z=n*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,r=Math.sqrt(1-t*t);return this.x=r*Math.cos(e),this.y=t,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const sa=new gt,Ka=new Vn;class nr{constructor(e,t,r,n,a,h,i,u,v,d,g,_,b,R,U,ee){nr.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,r,n,a,h,i,u,v,d,g,_,b,R,U,ee)}set(e,t,r,n,a,h,i,u,v,d,g,_,b,R,U,ee){const C=this.elements;return C[0]=e,C[4]=t,C[8]=r,C[12]=n,C[1]=a,C[5]=h,C[9]=i,C[13]=u,C[2]=v,C[6]=d,C[10]=g,C[14]=_,C[3]=b,C[7]=R,C[11]=U,C[15]=ee,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new nr().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,n=1/on.setFromMatrixColumn(e,0).length(),a=1/on.setFromMatrixColumn(e,1).length(),h=1/on.setFromMatrixColumn(e,2).length();return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=0,t[4]=r[4]*a,t[5]=r[5]*a,t[6]=r[6]*a,t[7]=0,t[8]=r[8]*h,t[9]=r[9]*h,t[10]=r[10]*h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,n=e.y,a=e.z,h=Math.cos(r),i=Math.sin(r),u=Math.cos(n),v=Math.sin(n),d=Math.cos(a),g=Math.sin(a);if(e.order==="XYZ"){const _=h*d,b=h*g,R=i*d,U=i*g;t[0]=u*d,t[4]=-u*g,t[8]=v,t[1]=b+R*v,t[5]=_-U*v,t[9]=-i*u,t[2]=U-_*v,t[6]=R+b*v,t[10]=h*u}else if(e.order==="YXZ"){const _=u*d,b=u*g,R=v*d,U=v*g;t[0]=_+U*i,t[4]=R*i-b,t[8]=h*v,t[1]=h*g,t[5]=h*d,t[9]=-i,t[2]=b*i-R,t[6]=U+_*i,t[10]=h*u}else if(e.order==="ZXY"){const _=u*d,b=u*g,R=v*d,U=v*g;t[0]=_-U*i,t[4]=-h*g,t[8]=R+b*i,t[1]=b+R*i,t[5]=h*d,t[9]=U-_*i,t[2]=-h*v,t[6]=i,t[10]=h*u}else if(e.order==="ZYX"){const _=h*d,b=h*g,R=i*d,U=i*g;t[0]=u*d,t[4]=R*v-b,t[8]=_*v+U,t[1]=u*g,t[5]=U*v+_,t[9]=b*v-R,t[2]=-v,t[6]=i*u,t[10]=h*u}else if(e.order==="YZX"){const _=h*u,b=h*v,R=i*u,U=i*v;t[0]=u*d,t[4]=U-_*g,t[8]=R*g+b,t[1]=g,t[5]=h*d,t[9]=-i*d,t[2]=-v*d,t[6]=b*g+R,t[10]=_-U*g}else if(e.order==="XZY"){const _=h*u,b=h*v,R=i*u,U=i*v;t[0]=u*d,t[4]=-g,t[8]=v*d,t[1]=_*g+U,t[5]=h*d,t[9]=b*g-R,t[2]=R*g-b,t[6]=i*d,t[10]=U*g+_}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Ro,e,Po)}lookAt(e,t,r){const n=this.elements;return kt.subVectors(e,t),kt.lengthSq()===0&&(kt.z=1),kt.normalize(),br.crossVectors(r,kt),br.lengthSq()===0&&(Math.abs(r.z)===1?kt.x+=1e-4:kt.z+=1e-4,kt.normalize(),br.crossVectors(r,kt)),br.normalize(),yi.crossVectors(kt,br),n[0]=br.x,n[4]=yi.x,n[8]=kt.x,n[1]=br.y,n[5]=yi.y,n[9]=kt.y,n[2]=br.z,n[6]=yi.z,n[10]=kt.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,n=t.elements,a=this.elements,h=r[0],i=r[4],u=r[8],v=r[12],d=r[1],g=r[5],_=r[9],b=r[13],R=r[2],U=r[6],ee=r[10],C=r[14],K=r[3],J=r[7],z=r[11],X=r[15],ne=n[0],ae=n[4],Ne=n[8],Ae=n[12],at=n[1],st=n[5],Xe=n[9],ge=n[13],G=n[2],V=n[6],Q=n[10],D=n[14],be=n[3],we=n[7],Se=n[11],Ge=n[15];return a[0]=h*ne+i*at+u*G+v*be,a[4]=h*ae+i*st+u*V+v*we,a[8]=h*Ne+i*Xe+u*Q+v*Se,a[12]=h*Ae+i*ge+u*D+v*Ge,a[1]=d*ne+g*at+_*G+b*be,a[5]=d*ae+g*st+_*V+b*we,a[9]=d*Ne+g*Xe+_*Q+b*Se,a[13]=d*Ae+g*ge+_*D+b*Ge,a[2]=R*ne+U*at+ee*G+C*be,a[6]=R*ae+U*st+ee*V+C*we,a[10]=R*Ne+U*Xe+ee*Q+C*Se,a[14]=R*Ae+U*ge+ee*D+C*Ge,a[3]=K*ne+J*at+z*G+X*be,a[7]=K*ae+J*st+z*V+X*we,a[11]=K*Ne+J*Xe+z*Q+X*Se,a[15]=K*Ae+J*ge+z*D+X*Ge,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],n=e[8],a=e[12],h=e[1],i=e[5],u=e[9],v=e[13],d=e[2],g=e[6],_=e[10],b=e[14],R=e[3],U=e[7],ee=e[11],C=e[15];return R*(+a*u*g-n*v*g-a*i*_+r*v*_+n*i*b-r*u*b)+U*(+t*u*b-t*v*_+a*h*_-n*h*b+n*v*d-a*u*d)+ee*(+t*v*g-t*i*b-a*h*g+r*h*b+a*i*d-r*v*d)+C*(-n*i*d-t*u*g+t*i*_+n*h*g-r*h*_+r*u*d)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],n=e[2],a=e[3],h=e[4],i=e[5],u=e[6],v=e[7],d=e[8],g=e[9],_=e[10],b=e[11],R=e[12],U=e[13],ee=e[14],C=e[15],K=g*ee*v-U*_*v+U*u*b-i*ee*b-g*u*C+i*_*C,J=R*_*v-d*ee*v-R*u*b+h*ee*b+d*u*C-h*_*C,z=d*U*v-R*g*v+R*i*b-h*U*b-d*i*C+h*g*C,X=R*g*u-d*U*u-R*i*_+h*U*_+d*i*ee-h*g*ee,ne=t*K+r*J+n*z+a*X;if(ne===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const ae=1/ne;return e[0]=K*ae,e[1]=(U*_*a-g*ee*a-U*n*b+r*ee*b+g*n*C-r*_*C)*ae,e[2]=(i*ee*a-U*u*a+U*n*v-r*ee*v-i*n*C+r*u*C)*ae,e[3]=(g*u*a-i*_*a-g*n*v+r*_*v+i*n*b-r*u*b)*ae,e[4]=J*ae,e[5]=(d*ee*a-R*_*a+R*n*b-t*ee*b-d*n*C+t*_*C)*ae,e[6]=(R*u*a-h*ee*a-R*n*v+t*ee*v+h*n*C-t*u*C)*ae,e[7]=(h*_*a-d*u*a+d*n*v-t*_*v-h*n*b+t*u*b)*ae,e[8]=z*ae,e[9]=(R*g*a-d*U*a-R*r*b+t*U*b+d*r*C-t*g*C)*ae,e[10]=(h*U*a-R*i*a+R*r*v-t*U*v-h*r*C+t*i*C)*ae,e[11]=(d*i*a-h*g*a-d*r*v+t*g*v+h*r*b-t*i*b)*ae,e[12]=X*ae,e[13]=(d*U*n-R*g*n+R*r*_-t*U*_-d*r*ee+t*g*ee)*ae,e[14]=(R*i*n-h*U*n-R*r*u+t*U*u+h*r*ee-t*i*ee)*ae,e[15]=(h*g*n-d*i*n+d*r*u-t*g*u-h*r*_+t*i*_)*ae,this}scale(e){const t=this.elements,r=e.x,n=e.y,a=e.z;return t[0]*=r,t[4]*=n,t[8]*=a,t[1]*=r,t[5]*=n,t[9]*=a,t[2]*=r,t[6]*=n,t[10]*=a,t[3]*=r,t[7]*=n,t[11]*=a,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,n))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),n=Math.sin(t),a=1-r,h=e.x,i=e.y,u=e.z,v=a*h,d=a*i;return this.set(v*h+r,v*i-n*u,v*u+n*i,0,v*i+n*u,d*i+r,d*u-n*h,0,v*u-n*i,d*u+n*h,a*u*u+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,n,a,h){return this.set(1,r,a,0,e,1,h,0,t,n,1,0,0,0,0,1),this}compose(e,t,r){const n=this.elements,a=t._x,h=t._y,i=t._z,u=t._w,v=a+a,d=h+h,g=i+i,_=a*v,b=a*d,R=a*g,U=h*d,ee=h*g,C=i*g,K=u*v,J=u*d,z=u*g,X=r.x,ne=r.y,ae=r.z;return n[0]=(1-(U+C))*X,n[1]=(b+z)*X,n[2]=(R-J)*X,n[3]=0,n[4]=(b-z)*ne,n[5]=(1-(_+C))*ne,n[6]=(ee+K)*ne,n[7]=0,n[8]=(R+J)*ae,n[9]=(ee-K)*ae,n[10]=(1-(_+U))*ae,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,r){const n=this.elements;let a=on.set(n[0],n[1],n[2]).length();const h=on.set(n[4],n[5],n[6]).length(),i=on.set(n[8],n[9],n[10]).length();this.determinant()<0&&(a=-a),e.x=n[12],e.y=n[13],e.z=n[14],Qt.copy(this);const v=1/a,d=1/h,g=1/i;return Qt.elements[0]*=v,Qt.elements[1]*=v,Qt.elements[2]*=v,Qt.elements[4]*=d,Qt.elements[5]*=d,Qt.elements[6]*=d,Qt.elements[8]*=g,Qt.elements[9]*=g,Qt.elements[10]*=g,t.setFromRotationMatrix(Qt),r.x=a,r.y=h,r.z=i,this}makePerspective(e,t,r,n,a,h,i=fi){const u=this.elements,v=2*a/(t-e),d=2*a/(r-n),g=(t+e)/(t-e),_=(r+n)/(r-n);let b,R;if(i===fi)b=-(h+a)/(h-a),R=-2*h*a/(h-a);else if(i===qa)b=-h/(h-a),R=-h*a/(h-a);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+i);return u[0]=v,u[4]=0,u[8]=g,u[12]=0,u[1]=0,u[5]=d,u[9]=_,u[13]=0,u[2]=0,u[6]=0,u[10]=b,u[14]=R,u[3]=0,u[7]=0,u[11]=-1,u[15]=0,this}makeOrthographic(e,t,r,n,a,h,i=fi){const u=this.elements,v=1/(t-e),d=1/(r-n),g=1/(h-a),_=(t+e)*v,b=(r+n)*d;let R,U;if(i===fi)R=(h+a)*g,U=-2*g;else if(i===qa)R=a*g,U=-1*g;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+i);return u[0]=2*v,u[4]=0,u[8]=0,u[12]=-_,u[1]=0,u[5]=2*d,u[9]=0,u[13]=-b,u[2]=0,u[6]=0,u[10]=U,u[14]=-R,u[3]=0,u[7]=0,u[11]=0,u[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let n=0;n<16;n++)if(t[n]!==r[n])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const on=new gt,Qt=new nr,Ro=new gt(0,0,0),Po=new gt(1,1,1),br=new gt,yi=new gt,kt=new gt,Ja=new nr,es=new Vn;class Ii{constructor(e=0,t=0,r=0,n=Ii.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,n=this._order){return this._x=e,this._y=t,this._z=r,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const n=e.elements,a=n[0],h=n[4],i=n[8],u=n[1],v=n[5],d=n[9],g=n[2],_=n[6],b=n[10];switch(t){case"XYZ":this._y=Math.asin(Ot(i,-1,1)),Math.abs(i)<.9999999?(this._x=Math.atan2(-d,b),this._z=Math.atan2(-h,a)):(this._x=Math.atan2(_,v),this._z=0);break;case"YXZ":this._x=Math.asin(-Ot(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(i,b),this._z=Math.atan2(u,v)):(this._y=Math.atan2(-g,a),this._z=0);break;case"ZXY":this._x=Math.asin(Ot(_,-1,1)),Math.abs(_)<.9999999?(this._y=Math.atan2(-g,b),this._z=Math.atan2(-h,v)):(this._y=0,this._z=Math.atan2(u,a));break;case"ZYX":this._y=Math.asin(-Ot(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(_,b),this._z=Math.atan2(u,a)):(this._x=0,this._z=Math.atan2(-h,v));break;case"YZX":this._z=Math.asin(Ot(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-d,v),this._y=Math.atan2(-g,a)):(this._x=0,this._y=Math.atan2(i,b));break;case"XZY":this._z=Math.asin(-Ot(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(_,v),this._y=Math.atan2(i,a)):(this._x=Math.atan2(-d,b),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return Ja.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Ja,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return es.setFromEuler(this),this.setFromQuaternion(es,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ii.DEFAULT_ORDER="XYZ";class No{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Do=0;const ts=new gt,un=new Vn,lr=new nr,di=new gt,In=new gt,Io=new gt,Bo=new Vn,rs=new gt(1,0,0),ns=new gt(0,1,0),is=new gt(0,0,1),Oo={type:"added"},Lo={type:"removed"},oa={type:"childadded",child:null},ua={type:"childremoved",child:null};class Ur extends Sa{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Do++}),this.uuid=Di(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ur.DEFAULT_UP.clone();const e=new gt,t=new Ii,r=new Vn,n=new gt(1,1,1);function a(){r.setFromEuler(t,!1)}function h(){t.setFromQuaternion(r,void 0,!1)}t._onChange(a),r._onChange(h),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new nr},normalMatrix:{value:new Rr}}),this.matrix=new nr,this.matrixWorld=new nr,this.matrixAutoUpdate=Ur.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ur.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new No,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return un.setFromAxisAngle(e,t),this.quaternion.multiply(un),this}rotateOnWorldAxis(e,t){return un.setFromAxisAngle(e,t),this.quaternion.premultiply(un),this}rotateX(e){return this.rotateOnAxis(rs,e)}rotateY(e){return this.rotateOnAxis(ns,e)}rotateZ(e){return this.rotateOnAxis(is,e)}translateOnAxis(e,t){return ts.copy(e).applyQuaternion(this.quaternion),this.position.add(ts.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(rs,e)}translateY(e){return this.translateOnAxis(ns,e)}translateZ(e){return this.translateOnAxis(is,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(lr.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?di.copy(e):di.set(e,t,r);const n=this.parent;this.updateWorldMatrix(!0,!1),In.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?lr.lookAt(In,di,this.up):lr.lookAt(di,In,this.up),this.quaternion.setFromRotationMatrix(lr),n&&(lr.extractRotation(n.matrixWorld),un.setFromRotationMatrix(lr),this.quaternion.premultiply(un.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Oo),oa.child=e,this.dispatchEvent(oa),oa.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Lo),ua.child=e,this.dispatchEvent(ua),ua.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),lr.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),lr.multiply(e.parent.matrixWorld)),e.applyMatrix4(lr),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,n=this.children.length;r<n;r++){const h=this.children[r].getObjectByProperty(e,t);if(h!==void 0)return h}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);const n=this.children;for(let a=0,h=n.length;a<h;a++)n[a].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(In,e,Io),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(In,Bo,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,n=t.length;r<n;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,n=t.length;r<n;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,n=t.length;r<n;r++){const a=t[r];(a.matrixWorldAutoUpdate===!0||e===!0)&&a.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const n=this.children;for(let a=0,h=n.length;a<h;a++){const i=n[a];i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map(i=>({boxInitialized:i.boxInitialized,boxMin:i.box.min.toArray(),boxMax:i.box.max.toArray(),sphereInitialized:i.sphereInitialized,sphereRadius:i.sphere.radius,sphereCenter:i.sphere.center.toArray()})),n.maxGeometryCount=this._maxGeometryCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),this.boundingBox!==null&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()}));function a(i,u){return i[u.uuid]===void 0&&(i[u.uuid]=u.toJSON(e)),u.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=a(e.geometries,this.geometry);const i=this.geometry.parameters;if(i!==void 0&&i.shapes!==void 0){const u=i.shapes;if(Array.isArray(u))for(let v=0,d=u.length;v<d;v++){const g=u[v];a(e.shapes,g)}else a(e.shapes,u)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(a(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const i=[];for(let u=0,v=this.material.length;u<v;u++)i.push(a(e.materials,this.material[u]));n.material=i}else n.material=a(e.materials,this.material);if(this.children.length>0){n.children=[];for(let i=0;i<this.children.length;i++)n.children.push(this.children[i].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let i=0;i<this.animations.length;i++){const u=this.animations[i];n.animations.push(a(e.animations,u))}}if(t){const i=h(e.geometries),u=h(e.materials),v=h(e.textures),d=h(e.images),g=h(e.shapes),_=h(e.skeletons),b=h(e.animations),R=h(e.nodes);i.length>0&&(r.geometries=i),u.length>0&&(r.materials=u),v.length>0&&(r.textures=v),d.length>0&&(r.images=d),g.length>0&&(r.shapes=g),_.length>0&&(r.skeletons=_),b.length>0&&(r.animations=b),R.length>0&&(r.nodes=R)}return r.object=n,r;function h(i){const u=[];for(const v in i){const d=i[v];delete d.metadata,u.push(d)}return u}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const n=e.children[r];this.add(n.clone())}return this}}Ur.DEFAULT_UP=new gt(0,1,0);Ur.DEFAULT_MATRIX_AUTO_UPDATE=!0;Ur.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ws={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Tr={h:0,s:0,l:0},pi={h:0,s:0,l:0};function ca(l,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?l+(e-l)*6*t:t<1/2?e:t<2/3?l+(e-l)*6*(2/3-t):l}class Ca{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(t===void 0&&r===void 0){const n=e;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Er){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Zt.toWorkingColorSpace(this,t),this}setRGB(e,t,r,n=Zt.workingColorSpace){return this.r=e,this.g=t,this.b=r,Zt.toWorkingColorSpace(this,n),this}setHSL(e,t,r,n=Zt.workingColorSpace){if(e=Ma(e,1),t=Ot(t,0,1),r=Ot(r,0,1),t===0)this.r=this.g=this.b=r;else{const a=r<=.5?r*(1+t):r+t-r*t,h=2*r-a;this.r=ca(h,a,e+1/3),this.g=ca(h,a,e),this.b=ca(h,a,e-1/3)}return Zt.toWorkingColorSpace(this,n),this}setStyle(e,t=Er){function r(a){a!==void 0&&parseFloat(a)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(e)){let a;const h=n[1],i=n[2];switch(h){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return r(a[4]),this.setRGB(Math.min(255,parseInt(a[1],10))/255,Math.min(255,parseInt(a[2],10))/255,Math.min(255,parseInt(a[3],10))/255,t);if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return r(a[4]),this.setRGB(Math.min(100,parseInt(a[1],10))/100,Math.min(100,parseInt(a[2],10))/100,Math.min(100,parseInt(a[3],10))/100,t);break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return r(a[4]),this.setHSL(parseFloat(a[1])/360,parseFloat(a[2])/100,parseFloat(a[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const a=n[1],h=a.length;if(h===3)return this.setRGB(parseInt(a.charAt(0),16)/15,parseInt(a.charAt(1),16)/15,parseInt(a.charAt(2),16)/15,t);if(h===6)return this.setHex(parseInt(a,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Er){const r=ws[e.toLowerCase()];return r!==void 0?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ln(e.r),this.g=ln(e.g),this.b=ln(e.b),this}copyLinearToSRGB(e){return this.r=ia(e.r),this.g=ia(e.g),this.b=ia(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Er){return Zt.fromWorkingColorSpace(Pt.copy(this),e),Math.round(Ot(Pt.r*255,0,255))*65536+Math.round(Ot(Pt.g*255,0,255))*256+Math.round(Ot(Pt.b*255,0,255))}getHexString(e=Er){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Zt.workingColorSpace){Zt.fromWorkingColorSpace(Pt.copy(this),t);const r=Pt.r,n=Pt.g,a=Pt.b,h=Math.max(r,n,a),i=Math.min(r,n,a);let u,v;const d=(i+h)/2;if(i===h)u=0,v=0;else{const g=h-i;switch(v=d<=.5?g/(h+i):g/(2-h-i),h){case r:u=(n-a)/g+(n<a?6:0);break;case n:u=(a-r)/g+2;break;case a:u=(r-n)/g+4;break}u/=6}return e.h=u,e.s=v,e.l=d,e}getRGB(e,t=Zt.workingColorSpace){return Zt.fromWorkingColorSpace(Pt.copy(this),t),e.r=Pt.r,e.g=Pt.g,e.b=Pt.b,e}getStyle(e=Er){Zt.fromWorkingColorSpace(Pt.copy(this),e);const t=Pt.r,r=Pt.g,n=Pt.b;return e!==Er?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(r*255)},${Math.round(n*255)})`}offsetHSL(e,t,r){return this.getHSL(Tr),this.setHSL(Tr.h+e,Tr.s+t,Tr.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(Tr),e.getHSL(pi);const r=On(Tr.h,pi.h,t),n=On(Tr.s,pi.s,t),a=On(Tr.l,pi.l,t);return this.setHSL(r,n,a),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,n=this.b,a=e.elements;return this.r=a[0]*t+a[3]*r+a[6]*n,this.g=a[1]*t+a[4]*r+a[7]*n,this.b=a[2]*t+a[5]*r+a[8]*n,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Pt=new Ca;Ca.NAMES=ws;class zo extends Cr{constructor(e,t,r,n,a,h,i,u,v,d){if(d=d!==void 0?d:ra,d!==ra&&d!==ja)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&d===ra&&(r=eo),r===void 0&&d===ja&&(r=to),super(null,n,a,h,i,u,d,r,v),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=i!==void 0?i:Wa,this.minFilter=u!==void 0?u:Wa,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const Uo=new zo(1,1);Uo.compareFunction=io;typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:xs}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=xs);const as={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Ra=["x","y","z","w"];function ko(l){let e="{";l.isNode===!0&&(e+=l.id);for(const{property:t,childNode:r}of pa(l))e+=","+t.slice(0,-4)+":"+r.getCacheKey();return e+="}",e}function*pa(l,e=!1){for(const t in l){if(t.startsWith("_")===!0)continue;const r=l[t];if(Array.isArray(r)===!0)for(let n=0;n<r.length;n++){const a=r[n];a&&(a.isNode===!0||e&&typeof a.toJSON=="function")&&(yield{property:t,index:n,childNode:a})}else if(r&&r.isNode===!0)yield{property:t,childNode:r};else if(typeof r=="object")for(const n in r){const a=r[n];a&&(a.isNode===!0||e&&typeof a.toJSON=="function")&&(yield{property:t,index:n,childNode:a})}}}function va(l){if(l==null)return null;const e=typeof l;return l.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":l.isVector2===!0?"vec2":l.isVector3===!0?"vec3":l.isVector4===!0?"vec4":l.isMatrix3===!0?"mat3":l.isMatrix4===!0?"mat4":l.isColor===!0?"color":l instanceof ArrayBuffer?"ArrayBuffer":null}function As(l,...e){const t=l?l.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),l==="color"?new Ca(...e):t==="vec2"?new hn(...e):t==="vec3"?new gt(...e):t==="vec4"?new Fa(...e):t==="mat3"?new Rr(...e):t==="mat4"?new nr(...e):l==="bool"?e[0]||!1:l==="float"||l==="int"||l==="uint"?e[0]||0:l==="string"?e[0]||"":l==="ArrayBuffer"?Wo(e[0]):null}function Go(l){let e="";const t=new Uint8Array(l);for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function Wo(l){return Uint8Array.from(atob(l),e=>e.charCodeAt(0)).buffer}const ss=new Map;let jo=0;class Gr extends Sa{constructor(e=null){super(),this.nodeType=e,this.updateType=as.NONE,this.updateBeforeType=as.NONE,this.uuid=wo.generateUUID(),this.isNode=!0,Object.defineProperty(this,"id",{value:jo++})}get type(){return this.constructor.type}getSelf(){return this.self||this}setReference(){return this}isGlobal(){return!1}*getChildren(){for(const{childNode:e}of pa(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(){return ko(this)}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);for(const r of this.getChildren())t["_node"+r.id]=r;return null}construct(e){return console.warn("THREE.Node: construct() is deprecated. Use setup() instead."),this.setup(e)}increaseUsage(e){const t=e.getDataFromNode(this);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}analyze(e){if(this.increaseUsage(e)===1){const r=e.getNodeProperties(this);for(const n of Object.values(r))n&&n.isNode===!0&&n.build(e)}}generate(e,t){const{outputNode:r}=e.getNodeProperties(this);if(r&&r.isNode===!0)return r.build(e,t)}updateBefore(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const r=this.getShared(e);if(this!==r)return r.build(e,t);e.addNode(this),e.addChain(this);let n=null;const a=e.getBuildStage();if(a==="setup"){this.setReference(e);const h=e.getNodeProperties(this);if(h.initialized!==!0||e.context.tempRead===!1){const i=e.stack.nodes.length;h.initialized=!0,h.outputNode=this.setup(e),h.outputNode!==null&&e.stack.nodes.length!==i&&(h.outputNode=e.stack);for(const u of Object.values(h))u&&u.isNode===!0&&u.build(e)}}else if(a==="analyze")this.analyze(e);else if(a==="generate")if(this.generate.length===1){const i=this.getNodeType(e),u=e.getDataFromNode(this);n=u.snippet,n===void 0&&(n=this.generate(e)||"",u.snippet=n),n=e.format(n,i,t)}else n=this.generate(e,t)||"";return e.removeChain(this),n}getSerializeChildren(){return pa(this)}serialize(e){const t=this.getSerializeChildren(),r={};for(const{property:n,index:a,childNode:h}of t)a!==void 0?(r[n]===void 0&&(r[n]=Number.isInteger(a)?[]:{}),r[n][a]=h.toJSON(e.meta).uuid):r[n]=h.toJSON(e.meta).uuid;Object.keys(r).length>0&&(e.inputNodes=r)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const r in e.inputNodes)if(Array.isArray(e.inputNodes[r])){const n=[];for(const a of e.inputNodes[r])n.push(t[a]);this[r]=n}else if(typeof e.inputNodes[r]=="object"){const n={};for(const a in e.inputNodes[r]){const h=e.inputNodes[r][a];n[a]=t[h]}this[r]=n}else{const n=e.inputNodes[r];this[r]=t[n]}}}toJSON(e){const{uuid:t,type:r}=this,n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{},nodes:{}});let a=e.nodes[t];a===void 0&&(a={uuid:t,type:r,meta:e,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},n!==!0&&(e.nodes[a.uuid]=a),this.serialize(a),delete a.meta);function h(i){const u=[];for(const v in i){const d=i[v];delete d.metadata,u.push(d)}return u}if(n){const i=h(e.textures),u=h(e.images),v=h(e.nodes);i.length>0&&(a.textures=i),u.length>0&&(a.images=u),v.length>0&&(a.nodes=v)}return a}}function Ht(l,e){if(typeof e!="function"||!l)throw new Error(`Node class ${l} is not a class`);if(ss.has(l)){console.warn(`Redefinition of node class ${l}`);return}ss.set(l,e),e.type=l}class gn extends Gr{constructor(e){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const n=e.getVectorType(this.getNodeType(e,t)),a=e.getDataFromNode(this);if(e.context.tempRead!==!1&&a.propertyName!==void 0)return e.format(a.propertyName,n,t);if(e.context.tempWrite!==!1&&n!=="void"&&t!=="void"&&this.hasDependencies(e)){const h=super.build(e,n),i=e.getVarFromNode(this,null,n),u=e.getPropertyName(i);return e.addLineFlowCode(`${u} = ${h}`),a.snippet=h,a.propertyName=u,e.format(a.propertyName,n,t)}}return super.build(e,t)}}Ht("TempNode",gn);class Pa extends Gr{constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getNodeType(e)}generate(e){const t=this.node.build(e),r=this.indexNode.build(e,"uint");return`${t}[ ${r} ]`}}Ht("ArrayElementNode",Pa);class Na extends Gr{constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let r=null;for(const n of this.convertTo.split("|"))(r===null||e.getTypeLength(t)===e.getTypeLength(n))&&(r=n);return r}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const r=this.node,n=this.getNodeType(e),a=r.build(e,n);return e.format(a,n,t)}}Ht("ConvertNode",Na);class Ss extends gn{constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,r)=>t+e.getTypeLength(r.getNodeType(e)),0))}generate(e,t){const r=this.getNodeType(e),n=this.nodes,a=e.getComponentType(r),h=[];for(const u of n){let v=u.build(e);const d=e.getComponentType(u.getNodeType(e));d!==a&&(v=e.format(v,d,a)),h.push(v)}const i=`${e.getType(r)}( ${h.join(", ")} )`;return e.format(i,r,t)}}Ht("JoinNode",Ss);const Vo=Ra.join("");class xa extends Gr{constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(Ra.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){const r=this.node,n=e.getTypeLength(r.getNodeType(e));let a=null;if(n>1){let h=null;this.getVectorLength()>=n&&(h=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const u=r.build(e,h);this.components.length===n&&this.components===Vo.slice(0,this.components.length)?a=e.format(u,h,t):a=e.format(`${u}.${this.components}`,this.getNodeType(e),t)}else a=r.build(e,t);return a}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}Ht("SplitNode",xa);class Ms extends gn{constructor(e,t,r){super(),this.sourceNode=e,this.components=t,this.targetNode=r}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:r,targetNode:n}=this,a=this.getNodeType(e),h=e.getTypeFromLength(r.length),i=n.build(e,h),u=t.build(e,a),v=e.getTypeLength(a),d=[];for(let g=0;g<v;g++){const _=Ra[g];_===r[0]?(d.push(i),g+=r.length-1):d.push(u+"."+_)}return`${e.getType(a)}( ${d.join(", ")} )`}}Ht("SetNode",Ms);class Fs extends Gr{constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?va(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=va(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=Go(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?As(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}Ht("InputNode",Fs);class Xt extends Fs{constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const r=this.getNodeType(e);return e.format(this.generateConst(e),r,t)}}Ht("ConstNode",Xt);let Ho=null;const cn=new Map;function Z(l,e){if(cn.has(l)){console.warn(`Redefinition of node element ${l}`);return}if(typeof e!="function")throw new Error(`Node element ${l} is not a function`);cn.set(l,e)}const os=l=>l.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),Cs={setup(l,e){const t=e.shift();return l(Oa(t),...e)},get(l,e,t){if(typeof e=="string"&&l[e]===void 0){if(l.isStackNode!==!0&&e==="assign")return(...r)=>(Ho.assign(t,...r),t);if(cn.has(e)){const r=cn.get(e);return l.isStackNode?(...n)=>t.add(r(...n)):(...n)=>r(t,...n)}else{if(e==="self")return l;if(e.endsWith("Assign")&&cn.has(e.slice(0,e.length-6))){const r=cn.get(e.slice(0,e.length-6));return l.isStackNode?(...n)=>t.assign(n[0],r(...n)):(...n)=>t.assign(r(t,...n))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=os(e),ut(new xa(t,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=os(e.slice(3).toLowerCase()),e=e.split("").sort().join(""),r=>ut(new Ms(l,e,r));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),ut(new xa(l,e));if(/^\d+$/.test(e)===!0)return ut(new Pa(t,new Xt(Number(e),"uint")))}}}return Reflect.get(l,e,t)},set(l,e,t,r){return typeof e=="string"&&l[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(r[e].assign(t),!0):Reflect.set(l,e,t,r)}},ha=new WeakMap,us=new WeakMap,Xo=function(l,e=null){const t=va(l);if(t==="node"){let r=ha.get(l);return r===void 0&&(r=new Proxy(l,Cs),ha.set(l,r),ha.set(r,r)),r}else{if(e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string")return ut(ga(l,e));if(t==="shader")return Hn(l)}return l},qo=function(l,e=null){for(const t in l)l[t]=ut(l[t],e);return l},Yo=function(l,e=null){const t=l.length;for(let r=0;r<t;r++)l[r]=ut(l[r],e);return l},$o=function(l,e=null,t=null,r=null){const n=a=>ut(r!==null?Object.assign(a,r):a);return e===null?(...a)=>n(new l(...la(a))):t!==null?(t=ut(t),(...a)=>n(new l(e,...la(a),t))):(...a)=>n(new l(e,...la(a)))};class Zo extends Gr{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t}getNodeType(e){const{outputNode:t}=e.getNodeProperties(this);return t?t.getNodeType(e):super.getNodeType(e)}call(e){const{shaderNode:t,inputNodes:r}=this;if(t.layout){let h=us.get(e.constructor);h===void 0&&(h=new WeakMap,us.set(e.constructor,h));let i=h.get(t);return i===void 0&&(i=ut(e.buildFunctionNode(t)),h.set(t,i)),e.currentFunctionNode!==null&&e.currentFunctionNode.includes.push(i),ut(i.call(r))}const n=t.jsFunc,a=r!==null?n(r,e.stack,e):n(e.stack,e);return ut(a)}setup(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,t){const{outputNode:r}=e.getNodeProperties(this);return r===null?this.call(e).build(e,t):super.generate(e,t)}}class Qo extends Gr{constructor(e){super(),this.jsFunc=e,this.layout=null}get isArrayInput(){return/^\((\s+)?\[/.test(this.jsFunc.toString())}setLayout(e){return this.layout=e,this}call(e=null){return Oa(e),ut(new Zo(this,e))}setup(){return this.call()}}const Ko=[!1,!0],Jo=[0,1,2,3],eu=[-1,-2],Rs=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],Da=new Map;for(const l of Ko)Da.set(l,new Xt(l));const Ia=new Map;for(const l of Jo)Ia.set(l,new Xt(l,"uint"));const Ba=new Map([...Ia].map(l=>new Xt(l.value,"int")));for(const l of eu)Ba.set(l,new Xt(l,"int"));const Bi=new Map([...Ba].map(l=>new Xt(l.value)));for(const l of Rs)Bi.set(l,new Xt(l));for(const l of Rs)Bi.set(-l,new Xt(-l));const Oi={bool:Da,uint:Ia,ints:Ba,float:Bi},cs=new Map([...Da,...Bi]),ga=(l,e)=>cs.has(l)?cs.get(l):l.isNode===!0?l:new Xt(l,e),tu=l=>{try{return l.getNodeType()}catch{return}},nt=function(l,e=null){return(...t)=>{if((t.length===0||!["bool","float","int","uint"].includes(l)&&t.every(n=>typeof n!="object"))&&(t=[As(l,...t)]),t.length===1&&e!==null&&e.has(t[0]))return ut(e.get(t[0]));if(t.length===1){const n=ga(t[0],l);return tu(n)===l?ut(n):ut(new Na(n,l))}const r=t.map(n=>ga(n));return ut(new Ss(r,l))}};function Ps(l){return new Proxy(new Qo(l),Cs)}const ut=(l,e=null)=>Xo(l,e),Oa=(l,e=null)=>new qo(l,e),la=(l,e=null)=>new Yo(l,e),ce=(...l)=>new $o(...l),Hn=l=>{const e=new Ps(l),t=(...r)=>{let n;return Oa(r),r[0]&&r[0].isNode?n=[...r]:n=r[0],e.call(n)};return t.shaderNode=e,t.setLayout=r=>(e.setLayout(r),t),t};Ht("ShaderNode",Ps);function ru(l){return l}Z("append",ru);const nu=new nt("color"),Xn=new nt("float",Oi.float),iu=new nt("int",Oi.int),au=new nt("uint",Oi.uint),su=new nt("bool",Oi.bool),ou=new nt("vec2"),uu=new nt("ivec2"),cu=new nt("uvec2"),hu=new nt("bvec2"),kr=new nt("vec3"),lu=new nt("ivec3"),fu=new nt("uvec3"),mu=new nt("bvec3"),ba=new nt("vec4"),yu=new nt("ivec4"),du=new nt("uvec4"),pu=new nt("bvec4"),vu=new nt("mat2"),xu=new nt("imat2"),gu=new nt("umat2"),bu=new nt("bmat2"),Tu=new nt("mat3"),Eu=new nt("imat3"),_u=new nt("umat3"),wu=new nt("bmat3"),Au=new nt("mat4"),Su=new nt("imat4"),Mu=new nt("umat4"),Fu=new nt("bmat4"),Cu=(l="")=>ut(new Xt(l,"string")),Ru=l=>ut(new Xt(l,"ArrayBuffer"));Z("color",nu);Z("float",Xn);Z("int",iu);Z("uint",au);Z("bool",su);Z("vec2",ou);Z("ivec2",uu);Z("uvec2",cu);Z("bvec2",hu);Z("vec3",kr);Z("ivec3",lu);Z("uvec3",fu);Z("bvec3",mu);Z("vec4",ba);Z("ivec4",yu);Z("uvec4",du);Z("bvec4",pu);Z("mat2",vu);Z("imat2",xu);Z("umat2",gu);Z("bmat2",bu);Z("mat3",Tu);Z("imat3",Eu);Z("umat3",_u);Z("bmat3",wu);Z("mat4",Au);Z("imat4",Su);Z("umat4",Mu);Z("bmat4",Fu);Z("string",Cu);Z("arrayBuffer",Ru);const Pu=ce(Pa),Nu=(l,e)=>ut(new Na(ut(l),e));Z("element",Pu);Z("convert",Nu);class ht extends gn{constructor(e,t,r,...n){if(super(),this.op=e,n.length>0){let a=r;for(let h=0;h<n.length;h++)a=new ht(e,a,n[h]);r=a}this.aNode=t,this.bNode=r}getNodeType(e,t){const r=this.op,n=this.aNode,a=this.bNode,h=n.getNodeType(e),i=typeof a<"u"?a.getNodeType(e):null;if(h==="void"||i==="void")return"void";if(r==="%")return h;if(r==="~"||r==="&"||r==="|"||r==="^"||r===">>"||r==="<<")return e.getIntegerType(h);if(r==="!"||r==="=="||r==="&&"||r==="||"||r==="^^")return"bool";if(r==="<"||r===">"||r==="<="||r===">="){const u=t?e.getTypeLength(t):Math.max(e.getTypeLength(h),e.getTypeLength(i));return u>1?`bvec${u}`:"bool"}else return h==="float"&&e.isMatrix(i)?i:e.isMatrix(h)&&e.isVector(i)?e.getVectorFromMatrix(h):e.isVector(h)&&e.isMatrix(i)?e.getVectorFromMatrix(i):e.getTypeLength(i)>e.getTypeLength(h)?i:h}generate(e,t){const r=this.op,n=this.aNode,a=this.bNode,h=this.getNodeType(e,t);let i=null,u=null;h!=="void"?(i=n.getNodeType(e),u=typeof a<"u"?a.getNodeType(e):null,r==="<"||r===">"||r==="<="||r===">="||r==="=="?e.isVector(i)?u=i:i=u="float":r===">>"||r==="<<"?(i=h,u=e.changeComponentType(u,"uint")):e.isMatrix(i)&&e.isVector(u)?u=e.getVectorFromMatrix(i):e.isVector(i)&&e.isMatrix(u)?i=e.getVectorFromMatrix(u):i=u=h):i=u=h;const v=n.build(e,i),d=typeof a<"u"?a.build(e,u):null,g=e.getTypeLength(t),_=e.getFunctionOperator(r);if(t!=="void")return r==="<"&&g>1?e.format(`${e.getMethod("lessThan")}( ${v}, ${d} )`,h,t):r==="<="&&g>1?e.format(`${e.getMethod("lessThanEqual")}( ${v}, ${d} )`,h,t):r===">"&&g>1?e.format(`${e.getMethod("greaterThan")}( ${v}, ${d} )`,h,t):r===">="&&g>1?e.format(`${e.getMethod("greaterThanEqual")}( ${v}, ${d} )`,h,t):r==="!"||r==="~"?e.format(`(${r}${v})`,i,t):_?e.format(`${_}( ${v}, ${d} )`,h,t):e.format(`( ${v} ${r} ${d} )`,h,t);if(i!=="void")return _?e.format(`${_}( ${v}, ${d} )`,h,t):e.format(`${v} ${r} ${d}`,h,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Du=ce(ht,"+"),Ta=ce(ht,"-"),La=ce(ht,"*"),Ns=ce(ht,"/"),Iu=ce(ht,"%"),Bu=ce(ht,"=="),Ou=ce(ht,"!="),Lu=ce(ht,"<"),zu=ce(ht,">"),Uu=ce(ht,"<="),ku=ce(ht,">="),Gu=ce(ht,"&&"),Wu=ce(ht,"||"),ju=ce(ht,"!"),Vu=ce(ht,"^^"),Hu=ce(ht,"&"),Xu=ce(ht,"~"),qu=ce(ht,"|"),Yu=ce(ht,"^"),$u=ce(ht,"<<"),Zu=ce(ht,">>");Z("add",Du);Z("sub",Ta);Z("mul",La);Z("div",Ns);Z("remainder",Iu);Z("equal",Bu);Z("notEqual",Ou);Z("lessThan",Lu);Z("greaterThan",zu);Z("lessThanEqual",Uu);Z("greaterThanEqual",ku);Z("and",Gu);Z("or",Wu);Z("not",ju);Z("xor",Vu);Z("bitAnd",Hu);Z("bitNot",Xu);Z("bitOr",qu);Z("bitXor",Yu);Z("shiftLeft",$u);Z("shiftRight",Zu);Ht("OperatorNode",ht);class N extends gn{constructor(e,t,r=null,n=null){super(),this.method=e,this.aNode=t,this.bNode=r,this.cNode=n}getInputType(e){const t=this.aNode.getNodeType(e),r=this.bNode?this.bNode.getNodeType(e):null,n=this.cNode?this.cNode.getNodeType(e):null,a=e.isMatrix(t)?0:e.getTypeLength(t),h=e.isMatrix(r)?0:e.getTypeLength(r),i=e.isMatrix(n)?0:e.getTypeLength(n);return a>h&&a>i?t:h>i?r:i>a?n:t}getNodeType(e){const t=this.method;return t===N.LENGTH||t===N.DISTANCE||t===N.DOT?"float":t===N.CROSS?"vec3":t===N.ALL?"bool":t===N.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):t===N.MOD?this.aNode.getNodeType(e):this.getInputType(e)}generate(e,t){const r=this.method,n=this.getNodeType(e),a=this.getInputType(e),h=this.aNode,i=this.bNode,u=this.cNode,v=e.renderer.isWebGLRenderer===!0;if(r===N.TRANSFORM_DIRECTION){let d=h,g=i;e.isMatrix(d.getNodeType(e))?g=ba(kr(g),0):d=ba(kr(d),0);const _=La(d,g).xyz;return Ds(_).build(e,t)}else{if(r===N.NEGATE)return e.format("( - "+h.build(e,a)+" )",n,t);if(r===N.ONE_MINUS)return Ta(1,h).build(e,t);if(r===N.RECIPROCAL)return Ns(1,h).build(e,t);if(r===N.DIFFERENCE)return za(Ta(h,i)).build(e,t);{const d=[];return r===N.CROSS||r===N.MOD?d.push(h.build(e,n),i.build(e,n)):r===N.STEP?d.push(h.build(e,e.getTypeLength(h.getNodeType(e))===1?"float":a),i.build(e,a)):v&&(r===N.MIN||r===N.MAX)||r===N.MOD?d.push(h.build(e,a),i.build(e,e.getTypeLength(i.getNodeType(e))===1?"float":a)):r===N.REFRACT?d.push(h.build(e,a),i.build(e,a),u.build(e,"float")):r===N.MIX?d.push(h.build(e,a),i.build(e,a),u.build(e,e.getTypeLength(u.getNodeType(e))===1?"float":a)):(d.push(h.build(e,a)),i!==null&&d.push(i.build(e,a)),u!==null&&d.push(u.build(e,a))),e.format(`${e.getMethod(r,n)}( ${d.join(", ")} )`,n,t)}}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}N.ALL="all";N.ANY="any";N.EQUALS="equals";N.RADIANS="radians";N.DEGREES="degrees";N.EXP="exp";N.EXP2="exp2";N.LOG="log";N.LOG2="log2";N.SQRT="sqrt";N.INVERSE_SQRT="inversesqrt";N.FLOOR="floor";N.CEIL="ceil";N.NORMALIZE="normalize";N.FRACT="fract";N.SIN="sin";N.COS="cos";N.TAN="tan";N.ASIN="asin";N.ACOS="acos";N.ATAN="atan";N.ABS="abs";N.SIGN="sign";N.LENGTH="length";N.NEGATE="negate";N.ONE_MINUS="oneMinus";N.DFDX="dFdx";N.DFDY="dFdy";N.ROUND="round";N.RECIPROCAL="reciprocal";N.TRUNC="trunc";N.FWIDTH="fwidth";N.BITCAST="bitcast";N.ATAN2="atan2";N.MIN="min";N.MAX="max";N.MOD="mod";N.STEP="step";N.REFLECT="reflect";N.DISTANCE="distance";N.DIFFERENCE="difference";N.DOT="dot";N.CROSS="cross";N.POW="pow";N.TRANSFORM_DIRECTION="transformDirection";N.MIX="mix";N.CLAMP="clamp";N.REFRACT="refract";N.SMOOTHSTEP="smoothstep";N.FACEFORWARD="faceforward";const Qu=Xn(1e-6);Xn(1e6);Xn(Math.PI);Xn(Math.PI*2);const Ku=ce(N,N.ALL),Ju=ce(N,N.ANY),ec=ce(N,N.EQUALS),tc=ce(N,N.RADIANS),rc=ce(N,N.DEGREES),nc=ce(N,N.EXP),ic=ce(N,N.EXP2),ac=ce(N,N.LOG),sc=ce(N,N.LOG2),oc=ce(N,N.SQRT),uc=ce(N,N.INVERSE_SQRT),cc=ce(N,N.FLOOR),hc=ce(N,N.CEIL),Ds=ce(N,N.NORMALIZE),lc=ce(N,N.FRACT),fc=ce(N,N.SIN),mc=ce(N,N.COS),yc=ce(N,N.TAN),dc=ce(N,N.ASIN),pc=ce(N,N.ACOS),vc=ce(N,N.ATAN),za=ce(N,N.ABS),Is=ce(N,N.SIGN),xc=ce(N,N.LENGTH),gc=ce(N,N.NEGATE),bc=ce(N,N.ONE_MINUS),Tc=ce(N,N.DFDX),Ec=ce(N,N.DFDY),_c=ce(N,N.ROUND),wc=ce(N,N.RECIPROCAL),Ac=ce(N,N.TRUNC),Sc=ce(N,N.FWIDTH);ce(N,N.BITCAST);const Mc=ce(N,N.ATAN2),Fc=ce(N,N.MIN),Cc=ce(N,N.MAX),Rc=ce(N,N.MOD),Pc=ce(N,N.STEP),Nc=ce(N,N.REFLECT),Dc=ce(N,N.DISTANCE),Ic=ce(N,N.DIFFERENCE),Bs=ce(N,N.DOT),Bc=ce(N,N.CROSS),Os=ce(N,N.POW),Oc=ce(N,N.POW,2),Lc=ce(N,N.POW,3),zc=ce(N,N.POW,4),Uc=ce(N,N.TRANSFORM_DIRECTION),kc=l=>La(Is(l),Os(za(l),1/3)),Gc=l=>Bs(l,l),Wc=ce(N,N.MIX),Ls=(l,e=0,t=1)=>ut(new N(N.CLAMP,ut(l),ut(e),ut(t))),jc=l=>Ls(l),Vc=ce(N,N.REFRACT),Hc=ce(N,N.SMOOTHSTEP),Xc=ce(N,N.FACEFORWARD),qc=(l,e,t)=>Wc(e,t,l),Yc=(l,e,t)=>Hc(e,t,l);Z("all",Ku);Z("any",Ju);Z("equals",ec);Z("radians",tc);Z("degrees",rc);Z("exp",nc);Z("exp2",ic);Z("log",ac);Z("log2",sc);Z("sqrt",oc);Z("inverseSqrt",uc);Z("floor",cc);Z("ceil",hc);Z("normalize",Ds);Z("fract",lc);Z("sin",fc);Z("cos",mc);Z("tan",yc);Z("asin",dc);Z("acos",pc);Z("atan",vc);Z("abs",za);Z("sign",Is);Z("length",xc);Z("lengthSq",Gc);Z("negate",gc);Z("oneMinus",bc);Z("dFdx",Tc);Z("dFdy",Ec);Z("round",_c);Z("reciprocal",wc);Z("trunc",Ac);Z("fwidth",Sc);Z("atan2",Mc);Z("min",Fc);Z("max",Cc);Z("mod",Rc);Z("step",Pc);Z("reflect",Nc);Z("distance",Dc);Z("dot",Bs);Z("cross",Bc);Z("pow",Os);Z("pow2",Oc);Z("pow3",Lc);Z("pow4",zc);Z("transformDirection",Uc);Z("mix",qc);Z("clamp",Ls);Z("refract",Vc);Z("smoothstep",Yc);Z("faceForward",Xc);Z("difference",Ic);Z("saturate",jc);Z("cbrt",kc);Ht("MathNode",N);const $c=Hn(({base:l,blend:e})=>{const t=r=>e[r].lessThan(Qu).cond(e[r],l[r].oneMinus().div(e[r]).oneMinus().max(0));return kr(t("x"),t("y"),t("z"))}).setLayout({name:"burnColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Zc=Hn(({base:l,blend:e})=>{const t=r=>e[r].equal(1).cond(e[r],l[r].div(e[r].oneMinus()).max(0));return kr(t("x"),t("y"),t("z"))}).setLayout({name:"dodgeColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Qc=Hn(({base:l,blend:e})=>{const t=r=>l[r].oneMinus().mul(e[r].oneMinus()).oneMinus();return kr(t("x"),t("y"),t("z"))}).setLayout({name:"screenColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Kc=Hn(({base:l,blend:e})=>{const t=r=>l[r].lessThan(.5).cond(l[r].mul(e[r],2),l[r].oneMinus().mul(e[r].oneMinus()).oneMinus());return kr(t("x"),t("y"),t("z"))}).setLayout({name:"overlayColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]});class wt extends gn{constructor(e,t,r){super(),this.blendMode=e,this.baseNode=t,this.blendNode=r}setup(){const{blendMode:e,baseNode:t,blendNode:r}=this,n={base:t,blend:r};let a=null;return e===wt.BURN?a=$c(n):e===wt.DODGE?a=Zc(n):e===wt.SCREEN?a=Qc(n):e===wt.OVERLAY&&(a=Kc(n)),a}}wt.BURN="burn";wt.DODGE="dodge";wt.SCREEN="screen";wt.OVERLAY="overlay";const Jc=ce(wt,wt.BURN),eh=ce(wt,wt.DODGE),th=ce(wt,wt.OVERLAY),rh=ce(wt,wt.SCREEN);Z("burn",Jc);Z("dodge",eh);Z("overlay",th);Z("screen",rh);Ht("BlendModeNode",wt);var Gt,Vt,Ar,vn,Sr,Nt,Mr,mr,xn,kn,Gn,_a,wa,Wn,Fr,Si,zs,Mi,Us,Fi,ks,jn,Ea,Ci,Gs,Ri,Ws,Pi,js,Ni,Vs;class nh{constructor(){Ie(this,Si);Ie(this,Mi);Ie(this,Fi);Ie(this,jn);Ie(this,Ci);Ie(this,Ri);Ie(this,Pi);Ie(this,Ni);$t(this,"canvas",document.querySelector("#canvas"));$t(this,"gl");Ie(this,Gt,new Map);Ie(this,Vt,new Map);Ie(this,Ar,void 0);Ie(this,vn,void 0);Ie(this,Sr,void 0);Ie(this,Nt,new Uint8Array(600));Ie(this,Mr,void 0);Ie(this,mr,new Uint8Array(3*40));Ie(this,xn,void 0);Ie(this,kn,document.createTextNode("0"));Ie(this,Gn,document.createTextNode("1"));Ie(this,_a,0);Ie(this,wa,0);Ie(this,Wn,new Map);Ie(this,Fr,void 0);document.querySelector("#linesCleared").appendChild(le(this,kn)),document.querySelector("#speedLevel").appendChild(le(this,Gn)),console.log(document.styleSheets);const e=document.styleSheets;let t=!1;for(let g=0;g<e.length&&!t;g++)e[g].href.includes("WebTetris")&&(ct(this,Fr,e[g].cssRules),t=!0);console.log(le(this,Fr)),le(this,Gt).set(1,[255,0,0]),le(this,Gt).set(2,[0,255,0]),le(this,Gt).set(3,[255,255,0]),le(this,Gt).set(4,[0,0,255]),le(this,Gt).set(5,[180,90,246]),le(this,Gt).set(6,[0,255,255]),le(this,Gt).set(7,[255,140,40]),le(this,Vt).set("Z",1),le(this,Vt).set("S",2),le(this,Vt).set("O",3),le(this,Vt).set("J",4),le(this,Vt).set("T",5),le(this,Vt).set("I",6),le(this,Vt).set("L",7);let r=this.canvas.getContext("webgl");this.gl=r,r||document.body.appendChild(document.createTextNode("WebGL is not supported."));function n(g,_,b,R){return[g,_+R,g+b,_+R,g+b,_,g,_]}function a(g,_,b,R){let U=[g/2,g],ee=[],C=(300-U[1])/2,K=(400-U[0])/2;ee.push(...n(K,C,U[0],U[1])),ee.push(...n(K-_-R,C,R,R));for(let J=0;J<3;J++)ee.push(...n(K+_+U[0],C+J*(R+b),R,R));return ee}const h={a_Position:{numComponents:2,data:a(250,3,0,30)},a_GridPos:{numComponents:2,data:[0,0,10,0,10,20,0,20,0,0,4,0,4,4,0,4,0,0,4,0,4,4,0,4,0,0,4,0,4,4,0,4,0,0,4,0,4,4,0,4]},a_QueueID:{numComponents:1,data:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3]},a_ShaderID:{numComponents:1,data:[0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]},indices:{numComponents:3,data:[0,1,2,2,3,0,4,5,6,6,7,4,8,9,10,10,11,8,12,13,14,14,15,12,16,17,18,18,19,16]}};ct(this,vn,gr.createBufferInfoFromArrays(r,h));let i=document.querySelector("#vertex-shader-2d").text,u=document.querySelector("#fragment-shader-2d").text;ct(this,Ar,gr.createProgramInfo(r,[i,u]));let v={src:"textures/block.png",mag:r.LINEAR};ct(this,xn,gr.createTexture(this.gl,v)),ct(this,Sr,r.createTexture()),r.bindTexture(r.TEXTURE_2D,le(this,Sr)),r.pixelStorei(r.UNPACK_ALIGNMENT,1),r.texImage2D(r.TEXTURE_2D,0,r.RGB,10,20,0,r.RGB,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),ct(this,Mr,r.createTexture()),r.bindTexture(r.TEXTURE_2D,le(this,Mr)),r.pixelStorei(r.UNPACK_ALIGNMENT,1),r.texImage2D(r.TEXTURE_2D,0,r.RGB,4,2*5,0,r.RGB,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.useProgram(le(this,Ar).program),gr.setBuffersAndAttributes(r,le(this,Ar),le(this,vn));let d={u_Resolution:[this.gl.canvas.width,this.gl.canvas.height],u_GridData:le(this,Sr),u_QueueData:le(this,Mr),u_BlockTexture:le(this,xn)};gr.setUniforms(le(this,Ar),d),Je(this,Ri,Ws).call(this,"#gameSpace")}updateData(e){Je(this,Si,zs).call(this,e),Je(this,Fi,ks).call(this,e),Je(this,Ci,Gs).call(this,e)}renderGame(){gr.resizeCanvasToDisplaySize(this.gl.canvas),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),Je(this,Ni,Vs).call(this);let e={u_Resolution:[this.gl.canvas.width,this.gl.canvas.height],u_GridData:le(this,Sr),u_QueueData:le(this,Mr),u_BlockTexture:le(this,xn)};gr.setUniforms(le(this,Ar),e),gr.drawBufferInfo(this.gl,le(this,vn))}}Gt=new WeakMap,Vt=new WeakMap,Ar=new WeakMap,vn=new WeakMap,Sr=new WeakMap,Nt=new WeakMap,Mr=new WeakMap,mr=new WeakMap,xn=new WeakMap,kn=new WeakMap,Gn=new WeakMap,_a=new WeakMap,wa=new WeakMap,Wn=new WeakMap,Fr=new WeakMap,Si=new WeakSet,zs=function(e){for(let t=0;t<20;t++){let r=e.gridData[t];for(let n=0;n<10;n++){let a=Je(this,Mi,Us).call(this,r,n),h=3*(10*t+n);if(a!=0){let i=le(this,Gt).get(a);le(this,Nt)[h]=i[0],le(this,Nt)[h+1]=i[1],le(this,Nt)[h+2]=i[2]}else le(this,Nt)[h]=0,le(this,Nt)[h+1]=0,le(this,Nt)[h+2]=0}}if(e.playerPiece.active){let t=170;for(let n=0;n<4;n++){let a=3*(10*e.ghostBlocks[n][1]+e.ghostBlocks[n][0]);le(this,Nt)[a]=t,le(this,Nt)[a+1]=t,le(this,Nt)[a+2]=t}let r=e.playerPiece.shape;for(let n=0;n<4;n++){let a=le(this,Gt).get(le(this,Vt).get(r)),h=3*(10*e.playerPiece.blocks[n][1]+e.playerPiece.blocks[n][0]);le(this,Nt)[h]=a[0],le(this,Nt)[h+1]=a[1],le(this,Nt)[h+2]=a[2]}}this.gl.bindTexture(this.gl.TEXTURE_2D,le(this,Sr)),this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,0,0,10,20,this.gl.RGB,this.gl.UNSIGNED_BYTE,le(this,Nt))},Mi=new WeakSet,Us=function(e,t){const r=32-(3+3*t),n=7<<r;return(e&n)>>>r},Fi=new WeakSet,ks=function(e){for(let t=0;t<le(this,mr).length;t++)le(this,mr)[t]=0;e.heldPiece!=null&&Je(this,jn,Ea).call(this,e.heldPiece,0);for(let t=0;t<4;t++)Je(this,jn,Ea).call(this,e.pieceQueue[t],24*(1+t));this.gl.bindTexture(this.gl.TEXTURE_2D,le(this,Mr)),this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,0,0,4,10,this.gl.RGB,this.gl.UNSIGNED_BYTE,le(this,mr))},jn=new WeakSet,Ea=function(e,t){let r=_r.getBaseShape(e),n=le(this,Gt).get(le(this,Vt).get(e));for(let a=0;a<4;a++){let h=r[a],i=t+3*(h[1]*4+h[0]);le(this,mr)[i]=n[0],le(this,mr)[i+1]=n[1],le(this,mr)[i+2]=n[2]}},Ci=new WeakSet,Gs=function(e){le(this,kn).nodeValue=e.linesCleared,le(this,Gn).nodeValue=e.speedLevel==11?"MAX":e.speedLevel},Ri=new WeakSet,Ws=function(e){const t=document.querySelector(e),r=Je(this,Pi,js).call(this,e);r!=null&&le(this,Wn).set(t,r)},Pi=new WeakSet,js=function(e){let t=null;for(let r=0;r<le(this,Fr).length&&t==null;r++)le(this,Fr)[r].selectorText==e&&(t=le(this,Fr)[r].style);return t},Ni=new WeakSet,Vs=function(){const e=this.gl.canvas.width,t=this.gl.canvas.height,r=3*e>4*t;le(this,Wn).forEach(function(n,a,h){const i=n.left!="",u=n.top!="";let v=i?n.left:n.right,d=u?n.top:n.bottom,g=n.fontSize,_=n.width,b=n.height;v=Number(v.substring(0,v.length-2)),d=Number(d.substring(0,d.length-2)),_=Number(_.substring(0,_.length-2)),b=Number(b.substring(0,b.length-2)),g!=""&&(g=Number(g.substring(0,g.length-2))),r?(v=(4*t*(v-50)+150*e)/(3*e)+"vw",_=_*4*t/(3*e)+"vw",d=d+"vh",b=b+"vh"):(d=d*3*e/(4*t)+(100*t-75*e)/(2*t)+"vh",b=b*3*e/(4*t)+"vh",v=v+"vw",_=_+"vw",g!=""&&(g=g*3*e/(4*t))),g!=""&&(a.style.fontSize=g+"vh"),i?a.style.left=v:a.style.right=v,u?a.style.top=d:a.style.bottom=d,a.style.width=_,a.style.height=b})};function ih(){let l=document.createTextNode("");document.querySelector("#debug").appendChild(l);const e=document.querySelector("#startButton");let t=new $s;document.addEventListener("keydown",function(b){t.setInputState(b.key,!0)}),document.addEventListener("keyup",function(b){t.setInputState(b.key,!1)});let r=new fa,n=new nh;const a=document.querySelector("#titleScreen"),h=document.querySelector("#pauseScreen"),i=document.querySelector("#gameOverScreen");let u=!0,v=0,d=0;function g(b){let R=(b-d)*.001;d=b,v+=R,r.gameState.gameOver?u||i.classList.contains("hide")&&i.classList.remove("hide"):(v>=r.gameTickTime&&(v=Math.min(v-r.gameTickTime,r.gameTickTime),r.runTick(t),t.getCounter("Pause")==1&&(r.gameState.isPaused?(r.pauseGame(!1),h.classList.add("hide")):(r.pauseGame(!0),h.classList.remove("hide")))),r.isStateChanged&&n.updateData(r.gameState)),n.renderGame(),requestAnimationFrame(g)}function _(){r.startNewGame(),n.updateData(r.gameState),n.renderGame(),document.querySelector("#titleScreen").classList.add("hide"),document.querySelector("#gameGUI").classList.remove("hide"),requestAnimationFrame(g),u=!1}e.addEventListener("click",_),document.querySelector("#heldPieceOverlay").addEventListener("click",function(){r.startNewGame()}),document.querySelector("#unpauseButton").addEventListener("click",function(){r.gameState.isPaused=!1,h.classList.add("hide")}),document.querySelector("#replayButton").addEventListener("click",function(){r.startNewGame(),n.updateData(r.gameState),n.renderGame(),i.classList.add("hide")}),document.querySelector("#returnToTitleButton").addEventListener("click",function(){a.classList.remove("hide"),i.classList.add("hide"),u=!0}),requestAnimationFrame(g)}ih();
